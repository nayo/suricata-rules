# SSH
alert ssh any any -> any any (msg:"CUSTOM: Possbily SSH bruteforce (Dest victim)"; flow: established, to_client;content: "SSH-"; fast_pattern; threshold:type both, track by_dst, count 5, seconds 30; classtype: attempted-recon; sid: 30161020;metadata: created_by black5ugar;)
alert ssh any any -> any any (msg:"CUSTOM: Possbily SSH bruteforce (Source initiator)"; flow: established, to_server;content: "SSH-"; fast_pattern; threshold:type both, track by_src, count 5, seconds 30; classtype: attempted-recon; sid: 30161021;metadata: created_by black5ugar;)
# SMTP
alert smtp any any -> any any (msg:"CUSTOM: SMTP AUTH LOGON brute force attempt"; flow:from_server,established; content:"|35 33 35|"; depth: 3; content:"Authentication failed"; fast_pattern; nocase; threshold:type threshold, track by_dst, count 3, seconds 20; classtype:suspicious-login; sid:30161022; metadata: created_by black5ugar;)
# POP3
alert tcp any any -> any any (msg:"CUSTOM: Possbily POP3 brute force failed"; flow:established, to_client; content:"|2d|ERR|20 5b|Auth|5d 20|Authentication|20|failed"; nocase; fast_pattern; threshold: type threshold, track by_dst, count 5, seconds 30; classtype: suspicious-login; sid:30161024; metadata: created_by black5ugar;)
# IMAP
alert tcp any any -> any any (msg:"CUSTOM: Possbily IMAP brute force failed"; flow:established, to_client; content:"NO|20 5b|AUTHENTICATIONFAILED|5d 20|authentication|20|failed"; nocase; fast_pattern; threshold: type threshold, track by_dst, count 5, seconds 30; classtype: suspicious-login; sid:30161025; metadata: created_by black5ugar;)
# MYSQL
alert tcp $HOME_NET 3306 -> any any (msg:"ET SCAN Non-Allowed Host Tried to Connect to MySQL Server"; flow:from_server,established; content:"|6A 04|Host|20 27|"; depth:70; content:"|27 20|is not allowed to connect to this MySQL server"; distance:0; reference:url,www.cyberciti.biz/tips/how-do-i-enable-remote-access-to-mysql-database-server.html; reference:url,doc.emergingthreats.net/2010493; classtype:attempted-recon; sid:2010493; rev:2; metadata:created_at 2010_07_30, updated_at 2010_07_30;)
# RDP
alert tcp any any -> any any (msg:"CUSTOM: Possbily RDP bruteforce (Source initiator)"; flow:established, to_server; content:"|03 00 00|"; depth:3; content:"|e0 00 00 00 00 00|"; offset:5; depth:6; content:"Cookie|3a| mstshash="; fast_pattern; threshold:type threshold, track by_src, count 5, seconds 30; classtype: suspicious-login; sid: 30161018; metadata: created_by black5ugar;)
# REDIS
alert tcp any any -> any any (msg:"CUSTOM: Possbily REDIS bruteforce failed"; flow:established, to_client; content:"|2d|WRONGPASS|20|invalid|20|username|2d|password|20|pair"; fast_pattern; threshold:type threshold, track by_src, count 5, seconds 30; classtype: suspicious-login; sid: 30161026; metadata: created_by black5ugar;)
 
alert http any any -> any [40000:65535] (msg:"CUSTOM: Possible SunLogin RCE Attempt: Unauthorized access to get CID(session)"; http.uri; content:"/cgi-bin/rpc"; fast_pattern;nocase; http.request_body; content:"action=verify-haras"; classtype:attempted-user;sid:3001000;metadata:created_at 2022_02_18, update_at 2022_02_18, by black5ugar;) 
alert http any any -> any [40000:65535] (msg:"CUSTOM: Possible Sunlogin RCE Attempt: Unauthorized access to get CID(session)"; http.uri; content:"/cgi-bin/rpc"; fast_pattern; nocase; http.request_body; content:"login"; classtype:attempted-user; sid:3001001;metadata:created_at 2022_02_18, update_at 2022_02_18, by black5ugar;)
alert http any any -> any [40000:65535] (msg:"CUSTOM: Possible Sunlogin RCE Attempt: Unauthorized access to get CID(session)"; http.uri; content:"/cgi-bin/login.cgi"; fast_pattern; nocase; http.request_body; content:"login"; classtype:attempted-user; sid:3001002;metadata:created_at 2022_02_18, update_at 2022_02_18, by black5ugar;)
alert http any [40000:65535] -> any any (msg:"CUSTOM: Possible Sunlogin CID(session) leak"; http.response_body; pcre:"/verify_string\"\:\"[0-9a-zA-Z]{32}/"; classtype:attempted-user; sid:3001003;metadata:created_at 2022_02_18, update_at 2022_02_18, by black5ugar;) 
alert http any [40000:65535] -> any any (msg:"CUSTOM: Possible Sunlogin CID(session) leak"; http.response_body; pcre:"/CID=[0-9a-zA-Z]{32}/";  classtype:attempted-user; sid:3001004;metadata:created_at 2022_02_18, update_at 2022_02_18, by black5ugar;)
alert http any any -> any [40000:65535] (msg:"CUSTOM: Possible Sunlogin RCE Attempt: command Ping"; http.uri; content:"/check?cmd=ping"; fast_pattern; nocase; http.cookie; pcre:"/CID=[0-9a-zA-Z]{32}/"; classtype:attempted-user; sid:3001005;metadata:created_at 2022_02_18, update_at 2022_02_18, by black5ugar;)
alert tcp $EXTERNAL_NET any -> $HOME_NET any (msg: "CobaltStrike login server"; flow:established; content:"Cyberspace"; depth:200; content:"Somewhere"; distance:0; content:"cobaltstrike"; distance:0; content:"AdvancedPenTesting";distance:0; classtype:exploit-kit; sid:3016001; rev:1; metadata:by al0ne;)
alert http $HOME_NET any -> $EXTERNAL_NET any (msg: "CobaltStrike download.windowsupdate.com C2 Profile"; flow: established; content:"msdownload"; http_uri; pcre:"/\/c\/msdownload\/update\/others\/[\d]{4}/\d{2}/\d{7,8}_[\d\w-_]{50,}\.cab/UR"; reference:url,github.com/bluscreenofjeff/MalleableC2Profiles/blob/master/microsoftupdate_getonly.profile; classtype:exploit-kit; sid: 3016002; rev: 1; metadata:created_at 2018_09_25,by al0ne; )
alert http $EXTERNAL_NET any -> $HOME_NET any (msg: "CobaltStrike HTTP beacon response"; flow: established; content:"200"; http_stat_code; content:!"Server:"; http_header; content:"application/octet-stream"; http_header; distance:0;  content:"Content-Length: 0"; http_header; distance:0; threshold: type both, track by_src, count 5, seconds 60; classtype:exploit-kit; sid: 3016003; rev: 1; metadata:created_at 2018_11_15,by al0ne;)
alert http $HOME_NET any -> $EXTERNAL_NET any (msg: "CobaltStrike ARP Scan module"; flow:established; content:"POST"; http_method; content:"(ARP)"; http_client_body; content:"Scanner module is complete"; http_client_body; distance:0; classtype:exploit-kit; sid:3016004; rev:1; metadata:created_at 2018_11_15,by al0ne;)
#alert http any any -> any any (msg:"CobatlStrikt team servers 200 OK Space"; flow:from_server,established; content:"200"; http_stat_code; content:"HTTP/1.1 200 OK|20|"; threshold: type both, track by_src, count 3, seconds 60; reference:url,blog.fox-it.com/2019/02/26/identifying-cobalt-strike-team-servers-in-the-wild/;  sid:3016011; rev:1; metadata:created_at 2019_02_27,by al0ne;)
alert tcp any any -> any any (msg:"CobaltStrike C2 Server"; flow:to_client; content:"HTTP/1.1 200 OK |0d0a|"; fast_pattern; depth:18; content:"Date: "; pcre:"/^HTTP/1.1 200 OK \r\nContent-Type: [^\r\n]{0,100}\r\nDate: [^\r\n]{0,100} GMT\r\n(Content-Length: \d+\r\n)\r\n/"; threshold:type limit, track by_dst, count 1, seconds 600; classtype:exploit-kit; priority:2; sid:3016012; metadata:created_at 2019_08_05; rev:3;)
alert dns $HOME_NET any -> any any (msg:"Observed DNS Query to public CryptoMining pool Domain (pool.minergate.com)"; dns_query; content:"pool.minergate.com"; nocase; isdataat:!1,relative; classtype:coin-mining; sid:3017000; rev:1;)
alert udp $HOME_NET any -> any 53 (msg:"Observed DNS Query to public CryptoMining pool Domain (pool.minergate.com)"; content:"|01|"; offset:2; depth:1; content:"|00 01 00 00 00 00 00|"; distance:1; within:7; content:"|04|pool|09|minergate|03|com|00|"; nocase; distance:0; fast_pattern; classtype:coin-mining; sid:3017001; rev:1;)
alert dns $HOME_NET any -> any any (msg:"Observed DNS Query to public CryptoMining pool Domain (pool.minexmr.com)"; dns_query; content:"pool.minexmr.com"; nocase; isdataat:!1,relative; classtype:coin-mining; sid:3017002; rev:1;)
alert udp $HOME_NET any -> any 53 (msg:"Observed DNS Query to public CryptoMining pool Domain (pool.minexmr.com)"; content:"|01|"; offset:2; depth:1; content:"|00 01 00 00 00 00 00|"; distance:1; within:7; content:"|04|pool|07|minexmr|03|com|00|"; nocase; distance:0; fast_pattern; classtype:coin-mining; sid:301703; rev:1;)
alert dns $HOME_NET any -> any any (msg:"Observed DNS Query to public CryptoMining pool Domain (opmoner.com)"; dns_query; content:"opmoner.com"; nocase; isdataat:!1,relative; classtype:coin-mining; sid:3017004; rev:1;)
alert udp $HOME_NET any -> any 53 (msg:"Observed DNS Query to public CryptoMining pool Domain (opmoner.com)"; content:"|01|"; offset:2; depth:1; content:"|00 01 00 00 00 00 00|"; distance:1; within:7; content:"|07|opmoner|03|com|00|"; nocase; distance:0; fast_pattern; classtype:coin-mining; sid:3017005; rev:1;)
alert dns $HOME_NET any -> any any (msg:"Observed DNS Query to public CryptoMining pool Domain (crypto-pool.fr)"; dns_query; content:"crypto-pool.fr"; nocase; isdataat:!1,relative; classtype:coin-mining; sid:3017006; rev:1;)
alert udp $HOME_NET any -> any 53 (msg:"Observed DNS Query to public CryptoMining pool Domain (crypto-pool.fr)"; content:"|01|"; offset:2; depth:1; content:"|00 01 00 00 00 00 00|"; distance:1; within:7; content:"|0b|crypto-pool|02|fr|00|"; nocase; distance:0; fast_pattern; classtype:coin-mining; sid:3017007; rev:1;)
alert dns $HOME_NET any -> any any (msg:"Observed DNS Query to public CryptoMining pool Domain (backup-pool.com)"; dns_query; content:"backup-pool.com"; nocase; isdataat:!1,relative; classtype:coin-mining; sid:3017008; rev:1;)
alert udp $HOME_NET any -> any 53 (msg:"Observed DNS Query to public CryptoMining pool Domain (backup-pool.com)"; content:"|01|"; offset:2; depth:1; content:"|00 01 00 00 00 00 00|"; distance:1; within:7; content:"|0b|backup-pool|03|com|00|"; nocase; distance:0; fast_pattern; classtype:coin-mining; sid:3017009; rev:1;)
alert dns $HOME_NET any -> any any (msg:"Observed DNS Query to public CryptoMining pool Domain (monerohash.com)"; dns_query; content:"monerohash.com"; nocase; isdataat:!1,relative; classtype:coin-mining; sid:3017010; rev:1;)
alert udp $HOME_NET any -> any 53 (msg:"Observed DNS Query to public CryptoMining pool Domain (monerohash.com)"; content:"|01|"; offset:2; depth:1; content:"|00 01 00 00 00 00 00|"; distance:1; within:7; content:"|0a|monerohash|03|com|00|"; nocase; distance:0; fast_pattern; classtype:coin-mining; sid:3017011; rev:1;)
alert dns $HOME_NET any -> any any (msg:"Observed DNS Query to public CryptoMining pool Domain (poolto.be)"; dns_query; content:"poolto.be"; nocase; isdataat:!1,relative; classtype:coin-mining; sid:3017012; rev:1;)
alert udp $HOME_NET any -> any 53 (msg:"Observed DNS Query to public CryptoMining pool Domain (poolto.be)"; content:"|01|"; offset:2; depth:1; content:"|00 01 00 00 00 00 00|"; distance:1; within:7; content:"|06|poolto|02|be|00|"; nocase; distance:0; fast_pattern; classtype:coin-mining; sid:3017013; rev:1;)
alert dns $HOME_NET any -> any any (msg:"Observed DNS Query to public CryptoMining pool Domain (xminingpool.com)"; dns_query; content:"xminingpool.com"; nocase; isdataat:!1,relative; classtype:coin-mining; sid:3017014; rev:1;)
alert udp $HOME_NET any -> any 53 (msg:"Observed DNS Query to public CryptoMining pool Domain (xminingpool.com)"; content:"|01|"; offset:2; depth:1; content:"|00 01 00 00 00 00 00|"; distance:1; within:7; content:"|0b|xminingpool|03|com|00|"; nocase; distance:0; fast_pattern; classtype:coin-mining; sid:3017015; rev:1;)
alert dns $HOME_NET any -> any any (msg:"Observed DNS Query to public CryptoMining pool Domain (prohash.net)"; dns_query; content:"prohash.net"; nocase; isdataat:!1,relative; classtype:coin-mining; sid:3017016; rev:1;)
alert udp $HOME_NET any -> any 53 (msg:"Observed DNS Query to public CryptoMining pool Domain (prohash.net)"; content:"|01|"; offset:2; depth:1; content:"|00 01 00 00 00 00 00|"; distance:1; within:7; content:"|07|prohash|03|net|00|"; nocase; distance:0; fast_pattern; classtype:coin-mining; sid:3017017; rev:1;)
alert dns $HOME_NET any -> any any (msg:"Observed DNS Query to public CryptoMining pool Domain (dwarfpool.com)"; dns_query; content:"dwarfpool.com"; nocase; isdataat:!1,relative; classtype:coin-mining; sid:3017018; rev:1;)
alert udp $HOME_NET any -> any 53 (msg:"Observed DNS Query to public CryptoMining pool Domain (dwarfpool.com)"; content:"|01|"; offset:2; depth:1; content:"|00 01 00 00 00 00 00|"; distance:1; within:7; content:"|09|dwarfpool|03|com|00|"; nocase; distance:0; fast_pattern; classtype:coin-mining; sid:3017019; rev:1;)
alert dns $HOME_NET any -> any any (msg:"Observed DNS Query to public CryptoMining pool Domain (crypto-pools.org)"; dns_query; content:"crypto-pools.org"; nocase; isdataat:!1,relative; classtype:coin-mining; sid:3017020; rev:1;)
alert udp $HOME_NET any -> any 53 (msg:"Observed DNS Query to public CryptoMining pool Domain (crypto-pools.org)"; content:"|01|"; offset:2; depth:1; content:"|00 01 00 00 00 00 00|"; distance:1; within:7; content:"|0c|crypto-pools|03|org|00|"; nocase; distance:0; fast_pattern; classtype:coin-mining; sid:3017021; rev:1;)
alert dns $HOME_NET any -> any any (msg:"Observed DNS Query to public CryptoMining pool Domain (monero.net)"; dns_query; content:"monero.net"; nocase; isdataat:!1,relative; classtype:coin-mining; sid:3017022; rev:1;)
alert udp $HOME_NET any -> any 53 (msg:"Observed DNS Query to public CryptoMining pool Domain (monero.net)"; content:"|01|"; offset:2; depth:1; content:"|00 01 00 00 00 00 00|"; distance:1; within:7; content:"|06|monero|03|net|00|"; nocase; distance:0; fast_pattern; classtype:coin-mining; sid:3017023; rev:1;)
alert dns $HOME_NET any -> any any (msg:"Observed DNS Query to public CryptoMining pool Domain (hashinvest.net)"; dns_query; content:"hashinvest.net"; nocase; isdataat:!1,relative; classtype:coin-mining; sid:3017024; rev:1;)
alert udp $HOME_NET any -> any 53 (msg:"Observed DNS Query to public CryptoMining pool Domain (hashinvest.net)"; content:"|01|"; offset:2; depth:1; content:"|00 01 00 00 00 00 00|"; distance:1; within:7; content:"|0a|hashinvest|03|net|00|"; nocase; distance:0; fast_pattern; classtype:coin-mining; sid:3017025; rev:1;)
alert dns $HOME_NET any -> any any (msg:"Observed DNS Query to public CryptoMining pool Domain (moneropool.com)"; dns_query; content:"moneropool.com"; nocase; isdataat:!1,relative; classtype:coin-mining; sid:3017026; rev:1;)
alert udp $HOME_NET any -> any 53 (msg:"Observed DNS Query to public CryptoMining pool Domain (moneropool.com)"; content:"|01|"; offset:2; depth:1; content:"|00 01 00 00 00 00 00|"; distance:1; within:7; content:"|0a|moneropool|03|com|00|"; nocase; distance:0; fast_pattern; classtype:coin-mining; sid:3017027; rev:1;)
alert dns $HOME_NET any -> any any (msg:"Observed DNS Query to public CryptoMining pool Domain (xmrpool.eu)"; dns_query; content:"xmrpool.eu"; nocase; isdataat:!1,relative; classtype:coin-mining; sid:3017028; rev:1;)
alert udp $HOME_NET any -> any 53 (msg:"Observed DNS Query to public CryptoMining pool Domain (xmrpool.eu)"; content:"|01|"; offset:2; depth:1; content:"|00 01 00 00 00 00 00|"; distance:1; within:7; content:"|07|xmrpool|02|eu|00|"; nocase; distance:0; fast_pattern; classtype:coin-mining; sid:3017029; rev:1;)
alert dns $HOME_NET any -> any any (msg:"Observed DNS Query to public CryptoMining pool Domain (ppxxmr.com)"; dns_query; content:"ppxxmr.com"; nocase; isdataat:!1,relative; classtype:coin-mining; sid:3017030; rev:1;)
alert udp $HOME_NET any -> any 53 (msg:"Observed DNS Query to public CryptoMining pool Domain (ppxxmr.com)"; content:"|01|"; offset:2; depth:1; content:"|00 01 00 00 00 00 00|"; distance:1; within:7; content:"|06|ppxxmr|03|com|00|"; nocase; distance:0; fast_pattern; classtype:coin-mining; sid:3017031; rev:1;)
alert dns $HOME_NET any -> any any (msg:"Observed DNS Query to public CryptoMining pool Domain (alimabi.cn)"; dns_query; content:"alimabi.cn"; nocase; isdataat:!1,relative; classtype:coin-mining; sid:3017032; rev:1;)
alert udp $HOME_NET any -> any 53 (msg:"Observed DNS Query to public CryptoMining pool Domain (alimabi.cn)"; content:"|01|"; offset:2; depth:1; content:"|00 01 00 00 00 00 00|"; distance:1; within:7; content:"|07|alimabi|02|cn|00|"; nocase; distance:0; fast_pattern; classtype:coin-mining; sid:3017033; rev:1;)
alert dns $HOME_NET any -> any any (msg:"Observed DNS Query to public CryptoMining pool Domain (aeon-pool.com)"; dns_query; content:"aeon-pool.com"; nocase; isdataat:!1,relative; classtype:coin-mining; sid:3017034; rev:1;)
alert udp $HOME_NET any -> any 53 (msg:"Observed DNS Query to public CryptoMining pool Domain (aeon-pool.com)"; content:"|01|"; offset:2; depth:1; content:"|00 01 00 00 00 00 00|"; distance:1; within:7; content:"|09|aeon-pool|03|com|00|"; nocase; distance:0; fast_pattern; classtype:coin-mining; sid:3017035; rev:1;)
alert udp $HOME_NET any -> $EXTERNAL_NET 53 (msg:"Suspicious dns request"; flow:established,to_server; content:"|01 00|"; depth:4; pcre:"/\x00\x10\x00\x01|\x00\x0f\x00\x01|\x00\x05\x00\x01/"; dsize:>200; classtype:trojan-activity; sid:3011001; rev:1; metadata:created_at 2018_11_09,by al0ne;)
alert tcp $HOME_NET any -> $EXTERNAL_NET any (msg:"Cryptocurrency Miner Check By Submit"; flow:to_server,established; content:"|22|method|22 3a|"; fast_pattern; content:"|22|submit|22 2c|"; distance:0; within:10; content:"|22|params|22 3a 7b|"; distance:0; within:15; content:"result|22 3a|"; nocase; distance:0; classtype:trojan-activity; sid:3013015; rev:1; metadata:Detecting Mining Rules by Charmly;)
alert tcp $EXTERNAL_NET any -> $HOME_NET any (msg:"Pools Response Cryptocurrency Miner"; flow:to_client,established; content:"|22|method|22 3a|"; nocase; content:"|22|params|22 3a|"; nocase; content:"|22|blob|22 3a|"; nocase; content:"|22|job_id|22 3a|"; nocase; classtype:trojan-activity; sid:3013016; rev:1; metadata:Detecting Mining Rules by Charmly;)
alert tcp any any -> any any (msg: "Hacker backdoor or shell  Microsoft Corporation"; flow:to_server,established; content:"|20 4d 69 63 72 6f 73 6f 66 74 20 43 6f 72 70 6f 72 61 74 69 6f 6e|"; depth:200; content:"WHOIS database"; nocase; classtype:trojan-activity; sid:3003001; rev:2; metadata:created_at 2018_09_26,updated_at 2019_08_06,by al0ne;)
alert tcp any any -> any any (msg: "Hacker backdoor or shell Microsoft Windows"; flow:established; content:"|4D 69 63 72 6F 73 6F 66 74 20 57 69 6E 64 6F 77 73 20 5B|"; depth:200; classtype:trojan-activity; sid:3003002; rev:1; metadata:by al0ne;)
alert http any any -> any any (msg:"***Windows Powershell Request UserAgent***"; flow:established; content:"PowerShell"; http_user_agent; pcre:"/PowerShell|WindowsPowerShell/i"; classtype:trojan-activity; sid:3013001; rev:1; metadata:by al0ne;)
alert http any any -> any any (msg:"***Linux wget/curl download .sh script***"; flow:established,to_server; content:".sh"; http_uri;  pcre:"/curl|Wget|linux-gnu/Vi"; classtype:trojan-activity; sid:3013002; rev:1; metadata:by al0ne;)
alert http $EXTERNAL_NET any -> $HOME_NET any (msg: "Suspicious netstat command traffic"; flow: established,to_client; content:"Active Internet connections"; http_server_body; depth:28; content:"tcp"; http_server_body; distance:0; classtype:trojan-activity; sid: 3013003; rev: 1; metadata:created_at 2018_09_26,by al0ne;)
alert tcp $HOME_NET any -> any any (msg: "http GET data"; flow: established;  content:"|47 45 54|"; depth: 10; content:"|0d 0a 0d 0a|"; depth:500; pcre:"/\x0d\x0a\x0d\x0a[^GETPOSTPUTHEAD\{\<\-][\x00-\xff]{100,200}/"; classtype:trojan-activity; sid: 3013004; rev: 1; metadata:created_at 2018_10_17,by al0ne;)
alert http any any -> any any (msg:"msfconsole powershell response"; flow:established; content:!"<html>"; content:!"<script>"; content:"|70 6f 77 65 72 73 68 65 6c 6c 2e 65 78 65|"; http_server_body; content:"|46 72 6f 6d 42 61 73 65 36 34 53 74 72 69 6e 67|"; http_server_body; classtype:exploit-kit; sid:3016005; rev:1;)
alert tcp $HOME_NET any -> any 3306 (msg: "mysql general_log write file"; flow: established;  content:"|03|"; depth: 5; content:"|67 65 6e 65 72 61 6c 5f 6c 6f 67 5f 66 69 6c 65|"; distance:0; classtype:trojan-activity; sid: 3013005; rev: 1; metadata:created_at 2018_11_20,by al0ne;)
alert http $EXTERNAL_NET any -> $HOME_NET any (msg: "Weevely PHP Backdoor Response"; flow: established,to_client; content:"200"; http_stat_code; content:!"<html>"; pcre:"/<(\w+)>[a-zA-Z0-9+\/]{20,}(?:[a-zA-Z0-9+\/]{1}[a-zA-Z0-9+\/=]{1}|==)<\/\w+>/Q"; classtype:shellcode-detect; sid: 3016006; rev: 1; metadata:created_at 2018_09_03,by al0ne;)
alert http $HOME_NET any -> $EXTERNAL_NET any  (msg: "Powershell Empire HTTP Request "; flow: established, to_server; content:".php"; http_uri;  pcre:"/session=[a-zA-Z0-9+/]{20,300}([a-zA-Z0-9+/]{1}[a-zA-Z0-9+/=]{1}|==)/ACi"; flowbits:set,empire; classtype:shellcode-detect; sid: 3016007; rev: 1; metadata:created_at 2018_09_03,by al0ne;)
alert http $EXTERNAL_NET any -> $HOME_NET any (msg: "Powershell Empire HTTP Response "; flow: established,to_client; content:"200"; http_stat_code; flowbits: isset,empire; content:"Cache-Control: no-cache, no-store, must-revalidate"; http_header; content: "Server: Microsoft-IIS/7.5"; http_header; distance: 0; classtype:shellcode-detect; sid: 3016008; rev: 1; metadata:created_at 2018_09_03,by al0ne;)
alert http any any -> any any (msg:"webshell_caidao_php"; flow:established; content:"POST";http_method; content:".php"; http_uri; content:"base64_decode"; http_client_body; classtype:shellcode-detect; sid:3016009; rev:1; metadata:by al0ne;)
alert http $EXTERNAL_NET any -> $HOME_NET any (msg: "China hacker tools caidao response - column directory"; flow: established,to_client; content:"200"; http_stat_code; content:!"<html>"; http_server_body; content:"|2d 3e|"; http_server_body; depth:2; pcre:"/[\w\d]+\.\w{2,3}\s+\d{4}-\d{2}-\d{2}\s[\d:]{8}/RQ"; classtype:shellcode-detect; sid: 3016010; rev: 1; metadata:created_at 2018_09_13,by al0ne; )
alert http any any -> any any  (msg: "Behinder3 PHP HTTP Request"; flow: established, to_server; content:".php"; http_uri;  pcre:"/[a-zA-Z0-9+/]{1000,}=/i"; flowbits:set,behinder3;noalert; classtype:shellcode-detect; sid: 3016017; rev: 1; metadata:created_at 2020_08_17,by al0ne;)
alert http any any -> any any (msg: "Behinder3  PHP HTTP Response"; flow: established,to_client; content:"200"; http_stat_code; flowbits: isset,behinder3; pcre:"/[a-zA-Z0-9+/]{100,}=/i"; classtype:shellcode-detect; sid: 3016018; rev: 1; metadata:created_at 2020_08_17,by al0ne;)


alert udp any any -> 12.145.241.0/24 9999 (msg:"QUADRANT Ping Packet"; flow:to_server; content:"SOFTWINK-PING-PACKET";classtype: not-suspicious;sid:20000003; rev:1;)
alert icmp any any -> 12.145.241.0/24 any (msg:"QUADRANT Ping Packet [ICMP]"; content:"SOFTWINK-PING";classtype: not-suspicious;sid:20000004; rev:1;)

# Added 20160923 by srawls - check for http connections to .su, .ml, and .tk domains

alert tcp $HOME_NET any -> $EXTERNAL_NET $HTTP_PORTS  (msg: "[QUADRANT] Attempt to contact .tk domain"; content: "|2e|tk|0D 0A|"; nocase; http_header; content: "host|3a|"; nocase; http_header; classtype: bad-unknown ; reference: url,en.wikipedia.org/wiki/.tk ; sid: 9999068; rev:1;)
alert tcp $HOME_NET any -> $EXTERNAL_NET $HTTP_PORTS  (msg: "[QUADRANT] Attempt to contact .ml domain"; content: "|2e|ml|0D 0A|"; nocase; http_header; content: "host|3a|"; nocase; http_header; classtype: bad-unknown ; reference: url,en.wikipedia.org/wiki/.ml ; sid: 9999069; rev:1;)
alert tcp $HOME_NET any -> $EXTERNAL_NET $HTTP_PORTS  (msg: "[QUADRANT] Attempt to contact .su domain"; content: "|2e|su|0D 0A|"; nocase; http_header; content: "host|3a|"; nocase; http_header; classtype: bad-unknown ; reference: url,www.abuse.ch/?p=3581 ; sid: 9999070; rev:1;)
alert tcp $HOME_NET any -> $EXTERNAL_NET $HTTP_PORTS (msg: "[QUADRANT] Attempt to contact .top domain"; content: "|2e|top|0D 0A|"; nocase; http_header; content: "host|3a|"; nocase; http_header; pcre: "/Host: .*\.top/H"; content:!"www.frivgames.top"; classtype: bad-unknown ; reference: url,en.wikipedia.org/wiki/.top ; sid: 9999072; rev:2;)

alert tcp any [21,22,23,25,53,80,443,8080] -> any !3389 (msg:"[QUADRANT] RDP HANDSHAKE [Tunneled msts] - Possible RDP bypass attempt"; dsize:<65; content:"|03 00 00|"; depth:3; content:"|e0|"; distance:2; within:1; content:"Cookie: mstshash="; distance:5; within:17; reference:url,fireeye.com/blog/threat-research/2019/01/bypassing-network-restrictions-through-rdp-tunneling.html; classtype: attempted-user;sid:10000283; rev:1;)
alert tcp any [21,22,23,25,53,80,443,8080] -> any !3389 (msg:"[QUADRANT] RDP HANDSHAKE [Tunneled] - Possible RDP bypass attempt"; flow:established; content:"|c0 00|Duca"; depth:250; content:"rdpdr"; content:"cliprdr"; reference:url,fireeye.com/blog/threat-research/2019/01/bypassing-network-restrictions-through-rdp-tunneling.html; classtype: attempted-user; sid:10000284; rev:1;)

#added by jgrove 30jul2019 to replace sid 13586

alert tcp !$INTERNAL_NETWORK !22 -> $INTERNAL_NETWORK !22 (msg:"[QUADRANT] SSH server response detected on non-standard port from external server"; flow:to_client,established; content:"SSH-"; depth:4; nocase; pcre:"/^SSH-[12]\.\d+/smi"; metadata:policy max-detect-ips drop; threshold: type limit, track by_src, count 1, seconds 604800; reference:url,www.ietf.org/rfc/rfc4251.txt; classtype:non-standard-protocol; sid:10000285; rev:2;)
alert tcp $INTERNAL_NETWORK !22 -> !$INTERNAL_NETWORK !22 (msg:"[QUADRANT] SSH server response detected on non-standard port from internal server"; flow:to_client,established; content:"SSH-"; depth:4; nocase; pcre:"/^SSH-[12]\.\d+/smi"; metadata:policy max-detect-ips drop; threshold: type limit, track by_src, count 1, seconds 604800; reference:url,www.ietf.org/rfc/rfc4251.txt; classtype:non-standard-protocol; sid:10000286; rev:1;)

alert tcp $HOME_NET any -> $EXTERNAL_NET $HTTP_PORTS (msg: "[QUADRANT] Attempt to contact Utorrent domain (download-hr.utorrent.com)"; content: "download-hr.utorrent.com|0D 0A|"; nocase; http_header; content: "host|3a|"; nocase; http_header; classtype: bad-unknown ; sid: 10000287; rev:1;)
#APT34 APT 35 jgrove

# -- From Fireeye breach - 20201208

alert tcp any $HTTP_PORTS -> any any (msg:"[FIREEYE-IOC] Backdoor.HTTP.BEACON.[CSBundle USAToday Server]"; flow:from_server,established; content:"{\"navgd\":\"<div class=gnt_n_dd_ls_w><div class=gnt_n_dd_nt>ONLY AT USA TODAY:</div><div class=gnt_n_dd_ls><a class=gnt_n_dd_ls_a href=https://supportlocal.usatoday.com/"; reference:url,www.fireeye.com/blog/threat-research/2020/12/unauthorized-access-of-fireeye-red-team-tools.html; classtype:targeted-activity; sid:10000300; rev:1;)

alert tcp any $HTTP_PORTS -> any any (msg:"[FIREEYE-IOC] Backdoor.HTTP.BEACON.[CSBundle USAToday Server]"; content:"HTTP/1."; depth:7; content:"Connection: close"; content:"Content-Type: application/json\; charset=utf-8"; content:"Content-Security-Policy: upgrade-insecure-requests"; content:"Strict-Transport-Security: max-age=10890000"; content:"Cache-Control: public, immutable, max-age=315360000"; content:"Accept-Ranges: bytes"; content:"X-Cache: HIT, HIT"; content:"X-Timer: S1593010188.776402,VS0,VE1"; content:"Vary: X-AbVariant, X-AltUrl, Accept-Encoding"; reference:url,www.fireeye.com/blog/threat-research/2020/12/unauthorized-access-of-fireeye-red-team-tools.html; classtype:targeted-activity; sid:10000301; rev:1;)

alert tcp any $HTTP_PORTS -> any any (msg:"[FIREEYE-IOC] Backdoor.HTTP.BEACON.[CSBundle Original Server]"; content:"HTTP/1."; depth:7; content:"Content-Type: text/json|0d 0a|"; content:"Server: Microsoft-IIS/10.0|0d 0a|"; content:"X-Powered-By: ASP.NET|0d 0a|"; content:"Cache-Control: no-cache, no-store, max-age=0, must-revalidate|0d 0a|"; content:"Pragma: no-cache|0d 0a|"; content:"X-Frame-Options: SAMEORIGIN|0d 0a|"; content:"Connection: close|0d 0a|"; content:"{\"meta\":{},\"status\":\"OK\",\"saved\":\"1\",\"starttime\":17656184060,\"id\":\"\",\"vims\":{\"dtc\":"; reference:url,www.fireeye.com/blog/threat-research/2020/12/unauthorized-access-of-fireeye-red-team-tools.html; classtype:targeted-activity; sid:10000302; rev:1;)

alert tcp any any -> any $HTTP_PORTS (msg:"[FIREEYE-IOC] Backdoor.HTTP.BEACON.[CSBundle NYTIMES GET]"; content:"GET"; depth:3; content:"Accept: */*"; content:"Accept-Encoding: gzip, deflate, br"; content:"Accept-Language: en-US,en\;q=0.5"; content:"nyt-a="; content:"nyt-gdpr=0\;nyt-purr=cfh\;nyt-geo=US}"; fast_pattern; content:"|0d 0a|Cookie:"; pcre:"/^GET\s(?:\/ads\/google|\/vi-assets\/static-assets|\/v1\/preferences|\/idcta\/translations|\/v2\/preferences)/"; reference:url,www.fireeye.com/blog/threat-research/2020/12/unauthorized-access-of-fireeye-red-team-tools.html; classtype:targeted-activity; sid:10000303; rev:1;)

alert tcp any any -> any $HTTP_PORTS (msg:"[FIREEYE-IOC] Backdoor.HTTP.BEACON.[CSBundle Original Stager]"; content:"T "; offset:2; depth:3; content:"Accept: */*"; content:"Accept-Language: en-US"; content:"Accept-Encoding: gzip, deflate"; content:"Cookie: SIDCC=AN0-TYutOSq-fxZK6e4kagm70VyKACiG1susXcYRuxK08Y-rHysliq0LWklTqjtulAhQOPH8uA"; pcre:"/\/api\/v1\/user\/(?:512|124)\/avatar/"; reference:url,www.fireeye.com/blog/threat-research/2020/12/unauthorized-access-of-fireeye-red-team-tools.html; classtype:targeted-activity; sid:10000304; rev:1;)

alert tcp any any -> any any (msg:"[FIREEYE-IOC] Backdoor.HTTP.GORAT.[SID1]"; content:"GET"; depth:3; content:"|0d 0a|Cookie: SID1="; content:!"|0d 0a|Referer:"; content:!"|0d 0a|Accept"; reference:url,www.fireeye.com/blog/threat-research/2020/12/unauthorized-access-of-fireeye-red-team-tools.html; classtype:targeted-activity; sid:10000305; rev:1;)

alert tcp any $HTTP_PORTS -> any any (msg:"[FIREEYE-IOC] Backdoor.HTTP.BEACON.[CSBundle MSOffice Server]"; content:"HTTP/1."; depth:7; content:"{\"meta\":{},\"status\":\"OK\",\"saved\":\"1\",\"starttime\":17656184060,\"id\":\"\",\"vims\":{\"dtc\":\""; reference:url,www.fireeye.com/blog/threat-research/2020/12/unauthorized-access-of-fireeye-red-team-tools.html; classtype:targeted-activity; sid:10000306; rev:1;)

alert tcp any any -> any 443 (msg:"[FIREEYE-IOC] Backdoor.SSL.BEACON.[CSBundle Ajax]"; content:"|16 03|"; depth:2; content:"US"; content:"US"; distance:0; content:"ajax.microsoft.com"; content:"ajax.microsoft.com"; distance:0; content:"Seattle"; content:"Seattle"; distance:0; content:"Microsoft"; content:"Microsoft"; distance:0; content:"Information Technologies"; content:"Information Technologies"; distance:0; content:"WA"; content:"WA"; distance:0; reference:url,www.fireeye.com/blog/threat-research/2020/12/unauthorized-access-of-fireeye-red-team-tools.html; classtype:targeted-activity; sid:10000307; rev:1;)

alert tcp $HOME_NET any -> any $HTTP_PORTS (msg:"[FIREEYE-IOC] Backdoor.HTTP.BEACON.[Yelp GET]"; flow:to_server; content:"GET "; depth:4; content:"&parent_request_id="; distance:0; within:256; fast_pattern; content:" HTTP/1"; distance:0; within:1024; content:"|0d 0a|Sec-Fetch-Dest: empty|0d 0a|"; distance:0; within:256; content:"request_origin=user"; offset:0; depth:256; pcre:"/^GET [^\r\n]{0,256}&parent_request_id=(?:[A-Za-z0-9_\/\+\-%]{128,1024})={0,2}[^\r\n]{0,256} HTTP\/1\.[01]/"; reference:url,www.fireeye.com/blog/threat-research/2020/12/unauthorized-access-of-fireeye-red-team-tools.html; classtype:targeted-activity; sid:10000308; rev:1;)

alert udp any 53 -> any any (msg:"[FIREEYE-IOC] Backdoor.DNS.BEACON.[CSBundle DNS]"; content:"|00 01 00 01|"; offset:4; depth:4; content:"|0a|_domainkey"; distance:0; content:"|00 00 10 00 01 c0 0c 00 10 00 01 00 00 00 02 01 00 ff|v=DKIM1\; p="; distance:0; reference:url,www.fireeye.com/blog/threat-research/2020/12/unauthorized-access-of-fireeye-red-team-tools.html; classtype:targeted-activity; sid:10000309; rev:1;)

alert tcp any any -> any $HTTP_PORTS (msg:"[FIREEYE-IOC] Backdoor.HTTP.BEACON.[CSBundle CDN GET]"; content:"GET"; depth:3; content:"Accept: */*"; content:"Accept-Encoding: gzip, deflate, br"; content:"Accept-Language: en-US|0d 0a|"; content:"client-="; content:"\;auth=1}"; content:"Cookie:"; pcre:"/^GET\s(?:\/v1\/queue|\/v1\/profile|\/v1\/docs\/wsdl|\/v1\/pull)/"; reference:url,www.fireeye.com/blog/threat-research/2020/12/unauthorized-access-of-fireeye-red-team-tools.html; classtype:targeted-activity; sid:10000310; rev:1;)

alert tcp any any -> any $HTTP_PORTS (msg:"[FIREEYE-IOC] Backdoor.HTTP.BEACON.[CSBundle USAToday GET]"; content:"GET"; depth:3; content:"Connection: close|0d 0a|"; content:"Accept: */*|0d 0a|"; content:"gnt_ub=86\;gnt_sb=18\;usprivacy=1YNY\;DigiTrust.v1.identity="; content:"%3D\;GED_PLAYLIST_ACTIVITY=W3sidSI6IkZtTWUiLCJ0c2wiOjE1OTMwM\;"; content:"Cookie:"; pcre:"/^GET\s(?:\/USAT-GUP\/user\/|\/entertainment\/|\/entertainment\/navdd-q1a2z3Z6TET4gv2PNfXpaJAniOzOajK7M\.min\.json|\/global-q1a2z3C4M2nNlQYzWhCC0oMSEFjQbW1KA\.min\.json|\/life\/|\/news\/weather\/|\/opinion\/|\/sports\/|\/sports\/navdd-q1a2z3JHa8KzCRLOQAnDoVywVWF7UwxJs\.min\.json|\/tangstatic\/js\/main-q1a2z3b37df2b1\.min\.js|\/tangstatic\/js\/pbjsandwich-q1a2z300ab4198\.min\.js|\/tangstatic\/js\/pg-q1a2z3bbc110a4\.min\.js|\/tangsvc\/pg\/3221104001\/|\/tangsvc\/pg\/5059005002\/|\/tangsvc\/pg\/5066496002\/|\/tech\/|\/travel\/)/"; reference:url,www.fireeye.com/blog/threat-research/2020/12/unauthorized-access-of-fireeye-red-team-tools.html; classtype:targeted-activity; sid:10000311; rev:1;)

alert tcp any any -> any $HTTP_PORTS (msg:"[FIREEYE-IOC] Backdoor.HTTP.BEACON.[CSBundle Original POST]"; content:"POST"; depth:4; content:"Accept: */*|0d 0a|"; content:"Accept-Language: en-US|0d 0a|"; content:"Accept-Encoding: gzip, deflate|0d 0a|"; content:"{\"locale\":\"en\",\"channel\":\"prod\",\"addon\":\""; pcre:"/^POST\s(?:\/v4\/links\/check-activity\/check|\/v1\/stats|\/gql|\/api2\/json\/check\/ticket|\/1.5\/95648064\/storage\/history|\/1.5\/95648064\/storage\/tabs|\/u\/0\/_\/og\/botguard\/get|\/ev\/prd001001|\/ev\/ext001001|\/gp\/aw\/ybh\/handlers|\/v3\/links\/ping-beat\/check)/"; content:"ses-"; reference:url,www.fireeye.com/blog/threat-research/2020/12/unauthorized-access-of-fireeye-red-team-tools.html; classtype:targeted-activity; sid:10000312; rev:1;)

alert tcp any any -> any $HTTP_PORTS (msg:"[FIREEYE-IOC] Backdoor.HTTP.BEACON.[CSBundle MSOffice POST]"; content:"POST /v1/push"; depth:13; content:"Accept: */*"; content:"Accept-Encoding: gzip, deflate, br"; content:"Accept-Language: en-US|0d 0a|"; content:"{\"locale\":\"en\",\"channel\":\"prod\",\"addon\":\""; content:"cli"; content:"l-"; reference:url,www.fireeye.com/blog/threat-research/2020/12/unauthorized-access-of-fireeye-red-team-tools.html; classtype:targeted-activity; sid:10000313; rev:1;)

alert tcp any any -> any [139,445] (msg:"[FIREEYE-IOC] M.HackTool.SMB.Impacket-Obfuscation.[Service Names]"; content:"|ff 53 4d 42|"; offset:4; depth:4; pcre:"/(?:\x57\x00\x69\x00\x6e\x00\x64\x00\x6f\x00\x77\x00\x73\x00\x20\x00\x55\x00\x70\x00\x64\x00\x61\x00\x74\x00\x65\x00\x20\x00\x43\x00\x6f\x00\x6e\x00\x74\x00\x72\x00\x6f\x00\x6c\x00\x20\x00\x53\x00\x65\x00\x72\x00\x76\x00\x69\x00\x63\x00\x65|\x57\x00\x69\x00\x6e\x00\x64\x00\x6f\x00\x77\x00\x73\x00\x20\x00\x31\x00\x30\x00\x20\x00\x44\x00\x65\x00\x66\x00\x65\x00\x6e\x00\x64\x00\x65\x00\x72|\x57\x00\x69\x00\x6e\x00\x64\x00\x6f\x00\x77\x00\x73\x00\x20\x00\x4c\x00\x69\x00\x63\x00\x65\x00\x6e\x00\x73\x00\x65\x00\x20\x00\x4b\x00\x65\x00\x79\x00\x20\x00\x41\x00\x63\x00\x74\x00\x69\x00\x76\x00\x61\x00\x74\x00\x69\x00\x6f\x00\x6e|\x4f\x00\x66\x00\x66\x00\x69\x00\x63\x00\x65\x00\x20\x00\x33\x00\x36\x00\x35\x00\x20\x00\x50\x00\x72\x00\x6f\x00\x78\x00\x79|\x4d\x00\x69\x00\x63\x00\x72\x00\x6f\x00\x73\x00\x6f\x00\x66\x00\x74\x00\x20\x00\x53\x00\x65\x00\x63\x00\x75\x00\x72\x00\x69\x00\x74\x00\x79\x00\x20\x00\x43\x00\x65\x00\x6e\x00\x74\x00\x65\x00\x72|\x4f\x00\x6e\x00\x65\x00\x44\x00\x72\x00\x69\x00\x76\x00\x65\x00\x20\x00\x53\x00\x79\x00\x6e\x00\x63\x00\x20\x00\x43\x00\x65\x00\x6e\x00\x74\x00\x65\x00\x72|\x42\x00\x61\x00\x63\x00\x6b\x00\x67\x00\x72\x00\x6f\x00\x75\x00\x6e\x00\x64\x00\x20\x00\x41\x00\x63\x00\x74\x00\x69\x00\x6f\x00\x6e\x00\x20\x00\x4d\x00\x61\x00\x6e\x00\x61\x00\x67\x00\x65\x00\x72|\x53\x00\x65\x00\x63\x00\x75\x00\x72\x00\x65\x00\x20\x00\x54\x00\x6f\x00\x6b\x00\x65\x00\x6e\x00\x20\x00\x4d\x00\x65\x00\x73\x00\x73\x00\x61\x00\x67\x00\x69\x00\x6e\x00\x67\x00\x20\x00\x53\x00\x65\x00\x72\x00\x76\x00\x69\x00\x63\x00\x65|\x57\x00\x69\x00\x6e\x00\x64\x00\x6f\x00\x77\x00\x73\x00\x20\x00\x20\x00\x55\x00\x70\x00\x64\x00\x61\x00\x74\x00\x65)/R"; reference:url,www.fireeye.com/blog/threat-research/2020/12/unauthorized-access-of-fireeye-red-team-tools.html; classtype:targeted-activity; sid:10000314; rev:1;)

alert tcp any $HTTP_PORTS -> any any (msg:"[FIREEYE-IOC] Backdoor.HTTP.BEACON.[CSBundle Original Stager 2]"; content:"HTTP/1."; depth:7; content:"Content-Type: text/json|0d 0a|"; content:"Server: Microsoft-IIS/10.0|0d 0a|"; content:"X-Powered-By: ASP.NET|0d 0a|"; content:"Cache-Control: no-cache, no-store, max-age=0, must-revalidate|0d 0a|"; content:"Pragma: no-cache|0d 0a|"; content:"X-Frame-Options: SAMEORIGIN|0d 0a|"; content:"Connection: close|0d 0a|"; content:"Content-Type: image/gif"; content:"|01 00 01 00 00 02 01 44 00 3b|"; content:"|ff ff ff 21 f9 04 01 00 00 00 2c 00 00 00 00|"; content:"|47 49 46 38 39 61 01 00 01 00 80 00 00 00 00|"; reference:url,www.fireeye.com/blog/threat-research/2020/12/unauthorized-access-of-fireeye-red-team-tools.html; classtype:targeted-activity; sid:10000315; rev:1;)

alert tcp any any -> any $HTTP_PORTS (msg:"[FIREEYE-IOC] Backdoor.HTTP.BEACON.[CSBundle NYTIMES POST]"; content:"POST"; depth:4; content:"Accept: */*"; content:"Accept-Encoding: gzip, deflate, br"; content:"Accept-Language: en-US,en\;q=0.5"; content:"id-"; content:"{\"locale\":\"en\",\"channel\":\"prod\",\"addon\":\""; pcre:"/^POST\s(?:\/track|\/api\/v1\/survey\/embed|\/svc\/weather\/v2)/"; reference:url,www.fireeye.com/blog/threat-research/2020/12/unauthorized-access-of-fireeye-red-team-tools.html; classtype:targeted-activity; sid:10000316; rev:1;)

alert tcp $HOME_NET any -> any 88 (msg:"[FIREEYE-IOC] HackTool.TCP.Rubeus.[nonce 2]"; content:"|a7 06 02 04 6C 69 6C 00|"; reference:url,www.fireeye.com/blog/threat-research/2020/12/unauthorized-access-of-fireeye-red-team-tools.html; classtype:targeted-activity; sid:10000317; rev:1;)

alert tcp $HOME_NET any -> any $HTTP_PORTS (msg:"[FIREEYE-IOC] Backdoor.HTTP.BEACON.[Yelp Request]"; flow:to_server; content:"T "; depth:5; content:" HTTP/1"; distance:0; within:256; content:"Cookie: hl=en|3b|bse="; distance:0; within:256; fast_pattern; content:"|3b|_gat_global=1|3b|recent_locations|3b|_gat_www=1|3b||0d 0a|"; pcre:"/Cookie: hl=en\x3bbse=(?:[A-Za-z0-9_\/\+\-]{128,1024})={0,2}\x3b_gat_global=1\x3brecent_locations\x3b_gat_www=1\x3b\r\n/"; reference:url,www.fireeye.com/blog/threat-research/2020/12/unauthorized-access-of-fireeye-red-team-tools.html; classtype:targeted-activity; sid:10000318; rev:1;)

alert tcp any any -> any $HTTP_PORTS (msg:"[FIREEYE-IOC] Backdoor.HTTP.BEACON.[CSBundle MSOffice GET]"; content:"GET"; depth:3; content:"Accept: */*"; content:"Accept-Encoding: gzip, deflate, br"; content:"Accept-Language: en-US|0d 0a|"; content:"sess-="; content:"auth=0\;loc=US}"; content:"Cookie:"; pcre:"/^GET\s(?:\/updates|\/license\/eula|\/docs\/office|\/software-activation)/"; reference:url,www.fireeye.com/blog/threat-research/2020/12/unauthorized-access-of-fireeye-red-team-tools.html; classtype:targeted-activity; sid:10000319; rev:1;)

alert tcp any $HTTP_PORTS -> any any (msg:"[FIREEYE-IOC] Backdoor.HTTP.BEACON.[CSBundle Original Server 2]"; content:"{\"meta\":{},\"status\":\"OK\",\"saved\":\"1\",\"starttime\":17656184060,\"id\":\"\",\"vims\":{\"dtc\":"; reference:url,www.fireeye.com/blog/threat-research/2020/12/unauthorized-access-of-fireeye-red-team-tools.html; classtype:targeted-activity; sid:10000320; rev:1;)

alert tcp any any -> any $HTTP_PORTS (msg:"[FIREEYE-IOC] Backdoor.HTTP.BEACON.[CSBundle MSOffice POST]"; content:"POST /notification"; depth:18; content:"Accept: */*"; content:"Accept-Encoding: gzip, deflate, br"; content:"Accept-Language: en-US|0d 0a|"; content:"{\"locale\":\"en\",\"channel\":\"prod\",\"addon\":\""; content:"nid"; content:"msg-"; reference:url,www.fireeye.com/blog/threat-research/2020/12/unauthorized-access-of-fireeye-red-team-tools.html; classtype:targeted-activity; sid:10000321; rev:1;)

alert tcp any any -> any $HTTP_PORTS (msg:"[FIREEYE-IOC] Backdoor.HTTP.BEACON.[CSBundle Original GET]"; content:"GET"; depth:3; content:"Accept: */*|0d 0a|"; content:"Accept-Language: en-US|0d 0a|"; content:"Accept-Encoding: gzip, deflate|0d 0a|"; content:"Cookie:"; content:"display-culture=en\;check=true\;lbcs=0\;sess-id="; distance:0; content:"\;SIDCC=AN0-TY21iJHH32j2m\;FHBv3=B"; pcre:"/^GET\s(?:\/api2\/json\/access\/ticket|\/api2\/json\/cluster\/resources|\/api2\/json\/cluster\/tasks|\/en-us\/p\/onerf\/MeSilentPassport|\/en-us\/p\/book-2\/8MCPZJJCC98C|\/en-us\/store\/api\/checkproductinwishlist|\/gp\/cerberus\/gv|\/gp\/aj\/private\/reviewsGallery\/get-application-resources|\/gp\/aj\/private\/reviewsGallery\/get-image-gallery-assets|\/v1\/buckets\/default\/ext-5dkJ19tFufpMZjVJbsWCiqDcclDw\/records|\/v3\/links\/ping-centre|\/v4\/links\/activity-stream|\/wp-content\/themes\/am43-6\/dist\/records|\/wp-content\/themes\/am43-6\/dist\/records|\/wp-includes\/js\/script\/indigo-migrate)/"; reference:url,www.fireeye.com/blog/threat-research/2020/12/unauthorized-access-of-fireeye-red-team-tools.html; classtype:targeted-activity; sid:10000322; rev:1;)

alert tcp any $HTTP_PORTS -> any any (msg:"[FIREEYE-IOC] Backdoor.HTTP.BEACON.[CSBundle MSOffice Server]"; flow:from_server,established; content:"{\"meta\":{},\"status\":\"OK\",\"saved\":\"1\",\"starttime\":17656184060,\"id\":\"\",\"vims\":{\"dtc\":\""; reference:url,www.fireeye.com/blog/threat-research/2020/12/unauthorized-access-of-fireeye-red-team-tools.html; classtype:targeted-activity; sid:10000323; rev:1;)

alert tcp any $HTTP_PORTS -> any any (msg:"[FIREEYE-IOC] Backdoor.HTTP.BEACON.[CSBundle NYTIMES Server]"; flow:from_server,established; content:"{\"meta\":{},\"status\":\"OK\",\"saved\":\"1\",\"starttime\":17656184060,\"id\":\"\",\"vims\":{\"dtc\":\""; reference:url,www.fireeye.com/blog/threat-research/2020/12/unauthorized-access-of-fireeye-red-team-tools.html; classtype:targeted-activity; sid:10000324; rev:1;)

alert udp any any -> any 88 (msg:"[FIREEYE-IOC] HackTool.UDP.Rubeus.[nonce 2]"; content:"|a7 06 02 04 6C 69 6C 00|"; reference:url,www.fireeye.com/blog/threat-research/2020/12/unauthorized-access-of-fireeye-red-team-tools.html; classtype:targeted-activity; sid:10000325; rev:1;)

alert udp any 53 -> any any (msg:"[FIREEYE-IOC] Backdoor.DNS.BEACON.[CSBundle DNS]"; content:"|00 01 00 01|"; offset:4; depth:4; content:"|03|"; within:15; content:"|0a|_domainkey"; distance:3; within:11; content:"|00 00 10 00 01 c0 0c 00 10 00 01 00 00 00 02 01 00 ff|v=DKIM1\; p="; reference:url,www.fireeye.com/blog/threat-research/2020/12/unauthorized-access-of-fireeye-red-team-tools.html; classtype:targeted-activity; sid:10000326; rev:1;)

alert tcp any any -> any 88 (msg:"[FIREEYE-IOC] HackTool.TCP.Rubeus.[nonce]"; content:"|05|"; depth:30; content:"|0a|"; distance:4; within:1; content:"Z"; content:"|6C 69 6C 00|"; within:25; reference:url,www.fireeye.com/blog/threat-research/2020/12/unauthorized-access-of-fireeye-red-team-tools.html; classtype:targeted-activity; sid:10000327; rev:1;)

alert tcp any $HTTP_PORTS -> any any (msg:"[FIREEYE-IOC] Backdoor.HTTP.BEACON.[CSBundle NYTIMES Server]"; content:"HTTP/1."; depth:7; content:"Accept-Ranges: bytes"; content:"Age: 5806"; content:"Cache-Control: public,max-age=31536000"; content:"Content-Encoding: gzip"; content:"Content-Length: 256398"; content:"Content-Type: application/javascript"; content:"Server: UploadServer"; content:"Vary: Accept-Encoding, Fastly-SSL"; content:"x-api-version: F-X"; content:"x-cache: HIT"; content:"x-Firefox-Spdy: h2"; content:"x-nyt-route: vi-assets"; content:"x-served-by: cache-mdw17344-MDW"; content:"x-timer: S1580937960.346550,VS0,VE0"; reference:url,www.fireeye.com/blog/threat-research/2020/12/unauthorized-access-of-fireeye-red-team-tools.html; classtype:targeted-activity; sid:10000328; rev:1;)

alert tcp any $HTTP_PORTS -> any any (msg:"[FIREEYE-IOC] Backdoor.HTTP.BEACON.[CSBundle Original Server 3]"; content:"{\"alias\":\"apx\",\"prefix\":\"\",\"suffix\":null,\"suggestions\":[],\"responseId\":\"15QE9JX9CKE2P\",\"addon\": \""; content:"\",\"shuffled\":false}"; reference:url,www.fireeye.com/blog/threat-research/2020/12/unauthorized-access-of-fireeye-red-team-tools.html; classtype:targeted-activity; sid:10000329; rev:1;)

alert udp any any -> any 88 (msg:"[FIREEYE-IOC] HackTool.UDP.Rubeus.[nonce]"; content:"|05|"; depth:30; content:"|0a|"; distance:4; within:1; content:"Z"; content:"|6C 69 6C 00|"; within:25; reference:url,www.fireeye.com/blog/threat-research/2020/12/unauthorized-access-of-fireeye-red-team-tools.html; classtype:targeted-activity; sid:10000330; rev:1;)

alert tcp any any -> any any (msg:"[FIREEYE-IOC] Backdoor.HTTP.GORAT.[POST]"; content:"POST / HTTP/1.1"; depth:15; content:"Connection: upgrade"; content:"|0d 0a|Upgrade: tcp/1|0d 0a|"; content:!"|0d 0a|Referer:"; content:!"|0d 0a|Accept"; content:!"|0d 0a|Cookie:"; reference:url,www.fireeye.com/blog/threat-research/2020/12/unauthorized-access-of-fireeye-red-team-tools.html; classtype:targeted-activity; sid:10000331; rev:1;)

# This rule cause loopback & noise issues - Champ Clark III / 20201208
#
# alert tcp any any -> any any (msg:"[FIREEYE-IOC] HackTool.TCP.Rubeus.[User32LogonProcesss]"; flow:to_server; content:"User32LogonProcesss"; reference:url,www.fireeye.com/blog/threat-research/2020/12/unauthorized-access-of-fireeye-red-team-tools.html; classtype:targeted-activity; sid:10000332; rev:1;)

alert tcp any any -> any any (msg:"[FIREEYE-IOC] Backdoor.HTTP.GORAT.[Build ID]"; content:"aqlKZ7wjzg0iKM00E1WB/jq9_RA46w91EKl9A02Dv/nbNdZiLsB1ci8Ph0fb64/9Ks1YxAE86iz9A0dUiDl"; reference:url,www.fireeye.com/blog/threat-research/2020/12/unauthorized-access-of-fireeye-red-team-tools.html; classtype:targeted-activity; sid:10000333; rev:1;)

## --- FireEye "Sunburst" modified rules - 20201214 (https://github.com/quadrantsec/fireeye-sunburst)

# https://github.com/fireeye/sunburst_countermeasures/blob/main/LICENSE.txt
# Modified by Champ Clark III @ Quadrant Information Security ( 12/14/2020 )

alert tcp $HOME_NET any -> any any (msg:"[FireEye SUNBURST] Backdoor.SUNBURST"; content:"T "; offset:2; depth:3; content:"/swip/Events HTTP/1"; within:100; content:"Host: "; content:!".solarwinds.com"; within:100; classtype:trojan-activity; reference: url,www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html; sid:10000334; rev:1;)

alert tcp $HOME_NET any -> any any (msg:"[FireEye SUNBURST] Backdoor.SUNBURST"; content:"T "; offset:2; depth:3; content:"/swip/upd/SolarWinds.CortexPlugin.Components.xml"; distance:0; content:"Host: "; content:!".solarwinds.com"; within:100; classtype:trojan-activity; reference: url,www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html; sid:10000335; rev:1;)

alert tcp any any -> any any (msg:"[FireEye SUNBURST] Backdoor.SUNBURST"; content:"T "; offset:2; depth:3; content:"Host:"; content:".avsvmcloud.com"; distance:0; classtype:trojan-activity; reference: url,www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html; sid:10000336; rev:1;)

alert tcp $HOME_NET any -> any any (msg:"[FireEye SUNBURST] Backdoor.SUNBURST"; content:"T "; offset:2; depth:3; content:"swip/Upload.ashx HTTP/1"; within:100; content:"Host: "; content:!".solarwinds.com"; within:100; classtype:trojan-activity; reference: url,www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html; sid:10000337; rev:1;)

alert tcp $HOME_NET any -> any any (msg:"[FireEye SUNBURST] Backdoor.SUNBURST"; content:"T "; offset:2; depth:3; content:"/swip/upd/"; within:75; content:" HTTP/1."; distance:0; content:"Host: "; content:!".solarwinds.com"; within:100; classtype:trojan-activity; reference: url,www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html; sid:10000338; rev:1;)

alert tcp any any <> any 443 (msg:"[FireEye SUNBURST] Backdoor.SUNBURST"; content:"|16 03|"; depth:2; content:"avsvmcloud.com"; distance:0; classtype:trojan-activity; reference: url,www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html; sid:10000358; rev:1;)

alert tcp any any <> any 443 (msg:"[FireEye SUNBURST] Backdoor.SUNBURST"; content:"|16 03|"; depth:2; content:"|55 04 03|"; distance:0; content:"digitalcollege.org"; within:50; classtype:trojan-activity; reference: url,www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html; sid:10000339; rev:1;)

alert tcp any any <> any 443 (msg:"[FireEye SUNBURST] Backdoor.SUNBURST"; content:"|16 03|"; depth:2; content:"|55 04 03|"; distance:0; content:"freescanonline.com"; within:50; classtype:trojan-activity; reference: url,www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html; sid:10000359; rev:1;)

alert tcp any any <> any 443 (msg:"[FireEye SUNBURST] Backdoor.SUNBURST"; content:"|16 03|"; depth:2; content:"|55 04 03|"; distance:0; content:"deftsecurity.com"; within:50; classtype:trojan-activity; reference: url,www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html; sid:10000340; rev:1;)

alert tcp any any <> any 443 (msg:"[FireEye SUNBURST] Backdoor.SUNBURST"; content:"|16 03|"; depth:2; content:"|55 04 03|"; distance:0; content:"thedoccloud.com"; within:50; classtype:trojan-activity; reference: url,www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html; sid:10000341; rev:1;)

alert tcp any any <> any 443 (msg:"[FireEye SUNBURST] Backdoor.SUNBURST"; content:"|16 03|"; depth:2; content:"|55 04 03|"; distance:0; content:"virtualdataserver.com"; within:50; classtype:trojan-activity; reference: url,www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html; sid:10000342; rev:1;)

alert tcp any any -> any any (msg:"[FireEye SUNBURST] Backdoor.SUNBURST"; content:"T "; offset:2; depth:3; content:"Host:"; content:"digitalcollege.org"; within:100; classtype:trojan-activity; reference: url,www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html; sid:10000343; rev:1;)

alert tcp any any -> any any (msg:"[FireEye SUNBURST] Backdoor.SUNBURST"; content:"T "; offset:2; depth:3; content:"Host:"; content:"freescanonline.com"; within:100; classtype:trojan-activity; reference: url,www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html; sid:10000344; rev:1;)

alert tcp any any -> any any (msg:"[FireEye SUNBURST] Backdoor.SUNBURST"; content:"T "; offset:2; depth:3; content:"Host:"; content:"deftsecurity.com"; within:100; classtype:trojan-activity; reference: url,www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html; sid:10000345; rev:1;)

alert tcp any any -> any any (msg:"[FireEye SUNBURST] Backdoor.SUNBURST"; content:"T "; offset:2; depth:3; content:"Host:"; content:"thedoccloud.com"; within:100; classtype:trojan-activity; reference: url,www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html; sid:10000346; rev:1;)

alert tcp any any -> any any (msg:"[FireEye SUNBURST] Backdoor.SUNBURST"; content:"T "; offset:2; depth:3; content:"Host:"; content:"virtualdataserver.com"; within:100; classtype:trojan-activity; reference: url,www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html; sid:10000347; rev:1;)

alert tcp $HOME_NET any -> any 443 (msg:"[FireEye SUNBURST] Backdoor.BEACON"; content:"|16 03 03|"; depth:3; content:"incomeupdate.com"; classtype:trojan-activity; reference: url,www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html; sid:10000348; rev:1;)

alert tcp $HOME_NET any -> any 443 (msg:"[FireEye SUNBURST] Backdoor.BEACON"; content:"|16 03 03|"; depth:3; content:"zupertech.com"; classtype:trojan-activity; reference: url,www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html; sid:10000349; rev:1;)

alert tcp $HOME_NET any -> any 443 (msg:"[FireEye SUNBURST] Backdoor.BEACON"; content:"|16 03 03|"; depth:3; content:"databasegalore.com"; classtype:trojan-activity; reference: url,www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html; sid:10000350; rev:1;)

alert tcp $HOME_NET any -> any 443 (msg:"[FireEye SUNBURST] Backdoor.BEACON"; content:"|16 03 03|"; depth:3; content:"panhardware.com"; classtype:trojan-activity; reference: url,www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html; sid:10000351; rev:1;)

alert tcp $HOME_NET any -> any any (msg:"[FireEye SUNBURST] Backdoor.BEACON"; content:"POST"; depth:4; content:"|0d 0a 0d 0a|name=\""; content:"\"\;filename=\""; content:"\"|0a|Content-Type:"; classtype:trojan-activity; reference: url,www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html; sid:10000352; rev:1;)

alert tcp any any -> $HOME_NET any (msg:"[FireEye SUNBURST] Backdoor.BEACON"; content:"HTTP/1."; depth:7; content:"Server: nginx/1.14.0 (Ubuntu)"; distance:0; content:"Connection: close"; distance:0; content:"Cache-Control: max-age=300, must-revalidate"; distance:0; content:"X-Content-Type-Options: nosniff"; distance:0; content:"X-AspNetMvc-Version: 3.0"; distance:0; content:"X-AspNet-Version: 4.0.30319"; distance:0; content:"X-Powered-By: ASP.NET"; distance:0; content:"Content-Length: "; content:"|0d 0a|"; distance:6; within:4; classtype:trojan-activity; reference: url,www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html; sid:10000353; rev:1;)

alert tcp any any -> $HOME_NET any (msg:"[FireEye SUNBURST] Backdoor.BEACON"; flow:from_server; content:"<title>Woman-Five-How-To-Why-Your-Celebrating-Learn-Brand</title>"; classtype:trojan-activity; reference: url,www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html; sid:10000354; rev:1;)

alert tcp any any -> $HOME_NET any (msg:"[FireEye SUNBURST] Backdoor.BEACON"; flow:from_server; content:"<p>Companies-Best-Man-Vendors-Best</p>"; classtype:trojan-activity; reference: url,www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html; sid:10000355; rev:1;)

alert tcp any any -> $HOME_NET any (msg:"[FireEye SUNBURST] Backdoor.BEACON"; flow:from_server; content:"<meta name=\"msvalidate.01\" content=\"ECEE9516DDABFC7CCBBF1EACC04CAC20\">"; content:"<meta name=\"google-site-verification\" content=\"CD5EF1FCB54FE29C838ABCBBE0FA57AE\">"; classtype:trojan-activity; reference: url,www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html; sid:10000356; rev:1;)

alert tcp any any -> $HOME_NET any (msg:"[FireEye SUNBURST] Backdoor.BEACON"; flow:from_server; content:"<p>Million-Support-Years-Week-Agents</p>"; classtype:trojan-activity; reference: url,www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html; sid:10000357; rev:1;)

# Created by Steven Drenning @ Quadrant Information Security

alert dns $HOME_NET any -> any 53 (msg:"[DevilsTongue] DNS Query"; dns.query; content:"noc-service-streamer.com"; nocase; reference:url,microsoft.com/security/blog/2021/07/15/protecting-customers-from-a-private-sector-offensive-actor-using-0-day-exploits-and-devilstongue-malware/; classtype:trojan-activity; sid:10000360; rev:1;)
alert dns $HOME_NET any -> any 53 (msg:"[DevilsTongue] DNS Query"; dns.query; content:"fbcdnads.live"; nocase; reference:url,microsoft.com/security/blog/2021/07/15/protecting-customers-from-a-private-sector-offensive-actor-using-0-day-exploits-and-devilstongue-malware/; classtype:trojan-activity; sid:10000361; rev:1;)
alert dns $HOME_NET any -> any 53 (msg:"[DevilsTongue] DNS Query"; dns.query; content:"hilocake.info"; nocase; reference:url,microsoft.com/security/blog/2021/07/15/protecting-customers-from-a-private-sector-offensive-actor-using-0-day-exploits-and-devilstongue-malware/; classtype:trojan-activity; sid:10000362; rev:1;)
alert dns $HOME_NET any -> any 53 (msg:"[DevilsTongue] DNS Query"; dns.query; content:"backxercise.com"; nocase; reference:url,microsoft.com/security/blog/2021/07/15/protecting-customers-from-a-private-sector-offensive-actor-using-0-day-exploits-and-devilstongue-malware/; classtype:trojan-activity; sid:10000363; rev:1;)
alert dns $HOME_NET any -> any 53 (msg:"[DevilsTongue] DNS Query"; dns.query; content:"winmslaf.xyz"; nocase; reference:url,microsoft.com/security/blog/2021/07/15/protecting-customers-from-a-private-sector-offensive-actor-using-0-day-exploits-and-devilstongue-malware/; classtype:trojan-activity; sid:10000364; rev:1;)
alert dns $HOME_NET any -> any 53 (msg:"[DevilsTongue] DNS Query"; dns.query; content:"service-deamon.com"; nocase; reference:url,microsoft.com/security/blog/2021/07/15/protecting-customers-from-a-private-sector-offensive-actor-using-0-day-exploits-and-devilstongue-malware/; classtype:trojan-activity; sid:10000365; rev:1;)
alert dns $HOME_NET any -> any 53 (msg:"[DevilsTongue] DNS Query"; dns.query; content:"online-affiliate-mon.com"; nocase; reference:url,microsoft.com/security/blog/2021/07/15/protecting-customers-from-a-private-sector-offensive-actor-using-0-day-exploits-and-devilstongue-malware/; classtype:trojan-activity; sid:10000366; rev:1;)
alert dns $HOME_NET any -> any 53 (msg:"[DevilsTongue] DNS Query"; dns.query; content:"codeingasmylife.com"; nocase; reference:url,microsoft.com/security/blog/2021/07/15/protecting-customers-from-a-private-sector-offensive-actor-using-0-day-exploits-and-devilstongue-malware/; classtype:trojan-activity; sid:10000367; rev:1;)
alert dns $HOME_NET any -> any 53 (msg:"[DevilsTongue] DNS Query"; dns.query; content:"kenoratravels.com"; nocase; reference:url,microsoft.com/security/blog/2021/07/15/protecting-customers-from-a-private-sector-offensive-actor-using-0-day-exploits-and-devilstongue-malware/; classtype:trojan-activity; sid:10000368; rev:1;)
alert dns $HOME_NET any -> any 53 (msg:"[DevilsTongue] DNS Query"; dns.query; content:"weathercheck.digital"; nocase; reference:url,microsoft.com/security/blog/2021/07/15/protecting-customers-from-a-private-sector-offensive-actor-using-0-day-exploits-and-devilstongue-malware/; classtype:trojan-activity; sid:10000369; rev:1;)
alert dns $HOME_NET any -> any 53 (msg:"[DevilsTongue] DNS Query"; dns.query; content:"colorpallatess.com"; nocase; reference:url,microsoft.com/security/blog/2021/07/15/protecting-customers-from-a-private-sector-offensive-actor-using-0-day-exploits-and-devilstongue-malware/; classtype:trojan-activity; sid:10000370; rev:1;)
alert dns $HOME_NET any -> any 53 (msg:"[DevilsTongue] DNS Query"; dns.query; content:"library-update.com"; nocase; reference:url,microsoft.com/security/blog/2021/07/15/protecting-customers-from-a-private-sector-offensive-actor-using-0-day-exploits-and-devilstongue-malware/; classtype:trojan-activity; sid:10000371; rev:1;)
alert dns $HOME_NET any -> any 53 (msg:"[DevilsTongue] DNS Query"; dns.query; content:"online-source-validate.com"; nocase; reference:url,microsoft.com/security/blog/2021/07/15/protecting-customers-from-a-private-sector-offensive-actor-using-0-day-exploits-and-devilstongue-malware/; classtype:trojan-activity; sid:10000372; rev:1;)
alert dns $HOME_NET any -> any 53 (msg:"[DevilsTongue] DNS Query"; dns.query; content:"grayhornet.com"; nocase; reference:url,microsoft.com/security/blog/2021/07/15/protecting-customers-from-a-private-sector-offensive-actor-using-0-day-exploits-and-devilstongue-malware/; classtype:trojan-activity; sid:10000373; rev:1;)
alert dns $HOME_NET any -> any 53 (msg:"[DevilsTongue] DNS Query"; dns.query; content:"johnshopkin.net"; nocase; reference:url,microsoft.com/security/blog/2021/07/15/protecting-customers-from-a-private-sector-offensive-actor-using-0-day-exploits-and-devilstongue-malware/; classtype:trojan-activity; sid:10000374; rev:1;)
alert dns $HOME_NET any -> any 53 (msg:"[DevilsTongue] DNS Query"; dns.query; content:"eulenformacion.com "; nocase; reference:url,microsoft.com/security/blog/2021/07/15/protecting-customers-from-a-private-sector-offensive-actor-using-0-day-exploits-and-devilstongue-malware/; classtype:trojan-activity; sid:10000375; rev:1;)
alert dns $HOME_NET any -> any 53 (msg:"[DevilsTongue] DNS Query"; dns.query; content:"pochtarossiy.info"; nocase; reference:url,microsoft.com/security/blog/2021/07/15/protecting-customers-from-a-private-sector-offensive-actor-using-0-day-exploits-and-devilstongue-malware/; classtype:trojan-activity; sid:10000376; rev:1;)
alert tcp any any -> $HOME_NET any (msg:"[DevilsTongue] FileHash For Physmem.sys Detected"; content:"event_type|22 3a 22|fileinfo"; content:"c299063e3eae8ddc15839767e83b9808fd43418dc5a1af7e4f44b97ba53fbd3d"; reference:url,microsoft.com/security/blog/2021/07/15/protecting-customers-from-a-private-sector-offensive-actor-using-0-day-exploits-and-devilstongue-malware; classtype:trojan-activity; sid:10000377; rev:1;)
alert tcp any any -> $HOME_NET any (msg:"[DevilsTongue] File "WimBootConfigurations.ini" Detected"; content:"event_type|22 3a 22|fileinfo"; content:"WimBootConfigurations.ini";nocase; reference:url,microsoft.com/security/blog/2021/07/15/protecting-customers-from-a-private-sector-offensive-actor-using-0-day-exploits-and-devilstongue-malware; classtype:trojan-activity; sid:10000378; rev:1;)


alert icmp $HOME_NET any -> any any (msg:"ET MALWARE Pingback cmd Command Issued"; dsize:>787; itype:8; content:"cmd"; depth:10; reference:url,www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/backdoor-at-the-end-of-the-icmp-tunnel/; reference:md5,264c2ede235dc7232d673d4748437969; classtype:trojan-activity; sid:1000379; rev:1; metadata:attack_target Client_Endpoint, created_at 2021_05_10, deployment Perimeter, former_category MALWARE, performance_impact Low, signature_severity Major, updated_at 2021_14_10;)

# More Log4j stuff.  Rule by S. Desorbo,  add by Champ Clark [2021/12/12]


alert ip any any -> any any (msg:"[QUADRANT] Apache log4j RCE Attempt with String Blocking Avoidance (CVE-2021-44228)"; flow:established,to_server; content:"|24 7b 6a 6e 64 69 3a 24 7b|"; nocase; fast_pattern; xbits:set, log4j, track ip_src, expire 3600; threshold: type limit, track by_both, seconds 3600, count 1; reference:url,lunasec.io/docs/blog/log4j-zero-day/; reference:cve,2021-44228; classtype:attempted-admin; sid:1000380; rev:2; metadata:attack_target Server, created_at 2021_12_10, cve CVE_2021_44228, deployment Perimeter, deployment Internal, former_category EXPLOIT, signature_severity Major, tag Exploit, updated_at 2021_12_12;)

#alert http any any -> any any (msg:"[QUADRANT] log4j .class FILE DOWNLOAD (CVE-2021-44228) CRITICAL AND CALL"; flow:established,to_server; http.method; content:"GET"; nocase; http.uri; content:".Class"; nocase; content:!".Classic"; nocase; threshold: type limit, track by_both, seconds 3600, count 1; reference:url,lunasec.io/docs/blog/log4j-zero-day/; classtype:attempted-admin; sid:1000381; rev:1;)

#SID 1000382 tracks any outbound connection to an IP seen performing log4j activity via an xbit defined as "log4j" -S. DeSorbo 2021/12/15

# Causing legit traffic to be blocked

##alert ip any any -> any any (msg:"[QUADRANT] CORRELATED Log4j: Possible outbound log4j response detected. (CVE-2021-44228)"; flow:established,to_server; xbits:isset, log4j, track ip_dst, expire 20; threshold: type limit, track by_both, seconds 3600, count 1; reference:url,lunasec.io/docs/blog/log4j-zero-day/; reference:cve,2021-44228; classtype:attempted-admin; sid:1000382; rev:1; metadata:attack_target Server, created_at 2021_12_10, cve CVE_2021_44228, deployment Perimeter, deployment Internal, former_category EXPLOIT, signature_severity Major, tag Exploit, updated_at 2021_12_13;)


#========================================================================================================
#Emerging Threats References
#	https://rules.emergingthreatspro.com/open/
#	https://community.emergingthreats.net/
#========================================================================================================
pass http any any ->any any (msg:"[QUADRANT] Apache log4j RCE Attempt (http ldap) (CVE-2021-44228)"; flow:established,to_server; content:"|24 7b|jndi|3a|ldap|3a 2f 2f|"; nocase; fast_pattern; threshold: type limit, track by_src, seconds 3600, count 1; xbits:set, log4j, track ip_src, expire 3600; reference:url,lunasec.io/docs/blog/log4j-zero-day/; reference:cve,2021-44228; reference:url,rules.emergingthreatspro.com/open/; reference:url,community.emergingthreats.net; classtype:attempted-admin; sid:1000383; rev:1; metadata:attack_target Server, created_at 2021_12_10, cve CVE_2021_44228, deployment Perimeter, deployment Internal, former_category EXPLOIT, signature_severity Major, tag Exploit, updated_at 2021_12_10;)

pass http any any ->any any (msg:"[QUADRANT] Apache log4j RCE Attempt (http rmi) (CVE-2021-44228)"; flow:established,to_server; content:"|24 7b|jndi|3a|rmi|3a 2f 2f|"; nocase; fast_pattern; threshold: type limit, track by_src, seconds 3600, count 1; xbits:set, log4j, track ip_src, expire 3600; reference:url,lunasec.io/docs/blog/log4j-zero-day/; reference:cve,2021-44228; reference:url,rules.emergingthreatspro.com/open/; reference:url,community.emergingthreats.net; classtype:attempted-admin; sid:1000384; rev:1; metadata:attack_target Server, created_at 2021_12_10, cve CVE_2021_44228, deployment Perimeter, deployment Internal, former_category EXPLOIT, signature_severity Major, tag Exploit, updated_at 2021_12_10;)

pass tcp any any ->any any (msg:"[QUADRANT] Apache log4j RCE Attempt (tcp ldap) (CVE-2021-44228)"; flow:established,to_server; content:"|24 7b|jndi|3a|ldap|3a 2f 2f|"; nocase; fast_pattern; threshold: type limit, track by_src, seconds 3600, count 1; xbits:set, log4j, track ip_src, expire 3600; reference:url,lunasec.io/docs/blog/log4j-zero-day/; reference:cve,2021-44228; reference:url,rules.emergingthreatspro.com/open/; reference:url,community.emergingthreats.net; classtype:attempted-admin; sid:1000385; rev:1; metadata:attack_target Server, created_at 2021_12_10, cve CVE_2021_44228, deployment Perimeter, deployment Internal, former_category EXPLOIT, signature_severity Major, tag Exploit, updated_at 2021_12_10;)

pass tcp any any ->any any (msg:"[QUADRANT] Apache log4j RCE Attempt (tcp rmi) (CVE-2021-44228)"; flow:established,to_server; content:"|24 7b|jndi|3a|rmi|3a 2f 2f|"; nocase; fast_pattern; threshold: type limit, track by_src, seconds 3600, count 1; xbits:set, log4j, track ip_src, expire 3600; reference:url,lunasec.io/docs/blog/log4j-zero-day/; reference:cve,2021-44228; reference:url,rules.emergingthreatspro.com/open/; reference:url,community.emergingthreats.net; classtype:attempted-admin; sid:1000386; rev:1; metadata:attack_target Server, created_at 2021_12_10, cve CVE_2021_44228, deployment Perimeter, deployment Internal, former_category EXPLOIT, signature_severity Major, tag Exploit, updated_at 2021_12_10;)

pass udp any any ->any any (msg:"[QUADRANT] Apache log4j RCE Attempt (udp ldap) (CVE-2021-44228)"; content:"|24 7b|jndi|3a|ldap|3a 2f 2f|"; nocase; fast_pattern; threshold: type limit, track by_src, seconds 3600, count 1; xbits:set, log4j, track ip_src, expire 3600; reference:url,lunasec.io/docs/blog/log4j-zero-day/; reference:cve,2021-44228; reference:url,rules.emergingthreatspro.com/open/; reference:url,community.emergingthreats.net; classtype:attempted-admin; sid:1000387; rev:2; metadata:attack_target Server, created_at 2021_12_10, cve CVE_2021_44228, deployment Perimeter, deployment Internal, former_category EXPLOIT, signature_severity Major, tag Exploit, updated_at 2021_12_10;)

pass udp any any ->any any (msg:"[QUADRANT] Apache log4j RCE Attempt (udp rmi) (CVE-2021-44228)"; content:"|24 7b|jndi|3a|rmi|3a 2f 2f|"; nocase; fast_pattern; threshold: type limit, track by_src, seconds 3600, count 1; xbits:set, log4j, track ip_src, expire 3600; reference:url,lunasec.io/docs/blog/log4j-zero-day/; reference:cve,2021-44228; reference:url,rules.emergingthreatspro.com/open/; reference:url,community.emergingthreats.net; classtype:attempted-admin; sid:1000388; rev:2; metadata:attack_target Server, created_at 2021_12_10, cve CVE_2021_44228, deployment Perimeter, deployment Internal, former_category EXPLOIT, signature_severity Major, tag Exploit, updated_at 2021_12_10;)

pass udp any any ->any any (msg:"[QUADRANT] Apache log4j RCE Attempt (udp dns) (CVE-2021-44228)"; content:"|24 7b|jndi|3a|dns|3a 2f 2f|"; nocase; fast_pattern; threshold: type limit, track by_src, seconds 3600, count 1; xbits:set, log4j, track ip_src, expire 3600; reference:url,lunasec.io/docs/blog/log4j-zero-day/; reference:cve,2021-44228; reference:url,rules.emergingthreatspro.com/open/; reference:url,community.emergingthreats.net; classtype:attempted-admin; sid:1000389; rev:2; metadata:attack_target Server, created_at 2021_12_10, cve CVE_2021_44228, deployment Perimeter, deployment Internal, former_category EXPLOIT, signature_severity Major, tag Exploit, updated_at 2021_12_10;)

pass tcp any any ->any any (msg:"[QUADRANT] Apache log4j RCE Attempt (tcp dns) (CVE-2021-44228)"; flow:established,to_server; content:"|24 7b|jndi|3a|dns|3a 2f 2f|"; nocase; fast_pattern; threshold: type limit, track by_src, seconds 3600, count 1; xbits:set, log4j, track ip_src, expire 3600; reference:url,lunasec.io/docs/blog/log4j-zero-day/; reference:cve,2021-44228; reference:url,rules.emergingthreatspro.com/open/; reference:url,community.emergingthreats.net; classtype:attempted-admin; sid:1000390; rev:2; metadata:attack_target Server, created_at 2021_12_10, cve CVE_2021_44228, deployment Perimeter, deployment Internal, former_category EXPLOIT, signature_severity Major, tag Exploit, updated_at 2021_12_10;)

pass http any any ->any any (msg:"[QUADRANT] Apache log4j RCE Attempt (http dns) (CVE-2021-44228)"; flow:established,to_server; content:"|24 7b|jndi|3a|dns|3a 2f 2f|"; nocase; fast_pattern; threshold: type limit, track by_src, seconds 3600, count 1; xbits:set, log4j, track ip_src, expire 3600; reference:url,lunasec.io/docs/blog/log4j-zero-day/; reference:cve,2021-44228; reference:url,rules.emergingthreatspro.com/open/; reference:url,community.emergingthreats.net; classtype:attempted-admin; sid:1000391; rev:2; metadata:attack_target Server, created_at 2021_12_10, cve CVE_2021_44228, deployment Perimeter, deployment Internal, former_category EXPLOIT, signature_severity Major, tag Exploit, updated_at 2021_12_10;)

pass udp any any ->any any (msg:"[QUADRANT] Apache log4j RCE Attempt (udp ldaps) (CVE-2021-44228)"; content:"|24 7b|jndi|3a|ldaps|3a 2f 2f|"; nocase; fast_pattern; threshold: type limit, track by_src, seconds 3600, count 1; xbits:set, log4j, track ip_src, expire 3600; reference:url,lunasec.io/docs/blog/log4j-zero-day/; reference:cve,2021-44228; reference:url,rules.emergingthreatspro.com/open/; reference:url,community.emergingthreats.net; classtype:attempted-admin; sid:1000392; rev:2; metadata:attack_target Server, created_at 2021_12_10, cve CVE_2021_44228, deployment Perimeter, deployment Internal, former_category EXPLOIT, signature_severity Major, tag Exploit, updated_at 2021_12_10;)

pass tcp any any ->any any (msg:"[QUADRANT] Apache log4j RCE Attempt (tcp ldaps) (CVE-2021-44228)"; flow:established,to_server; content:"|24 7b|jndi|3a|ldaps|3a 2f 2f|"; nocase; fast_pattern; threshold: type limit, track by_src, seconds 3600, count 1; xbits:set, log4j, track ip_src, expire 3600; reference:url,lunasec.io/docs/blog/log4j-zero-day/; reference:cve,2021-44228; reference:url,rules.emergingthreatspro.com/open/; reference:url,community.emergingthreats.net; classtype:attempted-admin; sid:1000393; rev:2; metadata:attack_target Server, created_at 2021_12_10, cve CVE_2021_44228, deployment Perimeter, deployment Internal, former_category EXPLOIT, signature_severity Major, tag Exploit, updated_at 2021_12_10;)

pass http any any ->any any (msg:"[QUADRANT] Apache log4j RCE Attempt (http ldaps) (CVE-2021-44228)"; flow:established,to_server; content:"|24 7b|jndi|3a|ldaps|3a 2f 2f|"; nocase; fast_pattern; threshold: type limit, track by_src, seconds 3600, count 1; xbits:set, log4j, track ip_src, expire 3600; reference:url,lunasec.io/docs/blog/log4j-zero-day/; reference:cve,2021-44228; reference:url,rules.emergingthreatspro.com/open/; reference:url,community.emergingthreats.net; classtype:attempted-admin; sid:1000394; rev:2; metadata:attack_target Server, created_at 2021_12_10, cve CVE_2021_44228, deployment Perimeter, deployment Internal, former_category EXPLOIT, signature_severity Major, tag Exploit, updated_at 2021_12_10;)

pass udp any any ->any any (msg:"[QUADRANT] Apache log4j RCE Attempt (udp iiop) (CVE-2021-44228)"; content:"|24 7b|jndi|3a|iiop|3a 2f 2f|"; nocase; fast_pattern; threshold: type limit, track by_src, seconds 3600, count 1; xbits:set, log4j, track ip_src, expire 3600; reference:url,lunasec.io/docs/blog/log4j-zero-day/; reference:cve,202 -44228; reference:url,rules.emergingthreatspro.com/open/; reference:url,community.emergingthreats.net; classtype:attempted-admin; sid:1000395; rev:2; metadata:attack_target Server, created_at 2021_12_11, cve CVE_2021_44228, deployment Perimeter, deployment Internal, former_category EXPLOIT, signature_severity Major, tag Exploit, updated_at 2021_12_11;)

pass tcp any any ->any any (msg:"[QUADRANT] Apache log4j RCE Attempt (tcp iiop) (CVE-2021-44228)"; flow:established,to_server; content:"|24 7b|jndi|3a|iiop|3a 2f 2f|"; nocase; fast_pattern; threshold: type limit, track by_src, seconds 3600, count 1; xbits:set, log4j, track ip_src, expire 3600; reference:url,lunasec.io/docs/blog/log4j-zero-day/; reference:cve,2021-44228; reference:url,rules.emergingthreatspro.com/open/; reference:url,community.emergingthreats.net; classtype:attempted-admin; sid:1000396; rev:2; metadata:attack_target Server, created_at 2021_12_11, cve CVE_2021_44228, deployment Perimeter, deployment Internal, former_category EXPLOIT, signature_severity Major, tag Exploit, updated_at 2021_12_11;)

pass tcp any any ->any any (msg:"[QUADRANT] Apache log4j RCE Attempt - lower/upper TCP Bypass M1 (CVE-2021-44228)"; flow:established,to_server; content:"%7bjndi%3a"; nocase; fast_pattern; pcre:"/^(l|r|d|(\x24|%24)(\x7b|%7b)(lower|upper)(\x3a|%3a)(l|r|d)(\x7d|%7d))(d|n|m|(\x24|%24)(\x7b|%24)(lower|upper)(\x3a|%3a)(d|n|m)(\x7d|%7d))(a|i|s|(\x24|%24)(\x7b|%7b)(lower|upper)(\x3a|%3a)(a|i|s)(\x7d|%7d))(p|(\x24|%24)(\x7b|%7b)(lower|upper)(\x3a|%3a)p(\x7d|%7d))/Ri"; xbits:set, log4j, track ip_src, expire 3600; reference:cve,2021-44228; reference:url,rules.emergingthreatspro.com/open/; reference:url,community.emergingthreats.net; classtype:attempted-admin; sid:1000397; rev:2; metadata:attack_target Server, created_at 2021_12_11, cve CVE_2021_44228, deployment Perimeter, deployment Internal, former_category EXPLOIT, signature_severity Major, tag Exploit, updated_at 2021_12_14;)

pass tcp any any ->any any (msg:"[QUADRANT] Possible Apache log4j RCE Attempt - 2021/12/12 Obfuscation Observed M2 (CVE-2021-44228)"; flow:established,to_server; content:"|24 7b|"; content:"|24 7b 3a 3a|"; distance:0; within:300; fast_pattern; xbits:set, log4j, track ip_src, expire 3600; reference:cve,2021-44228; reference:url,rules.emergingthreatspro.com/open/; reference:url,community.emergingthreats.net; classtype:attempted-admin; sid:1000398; rev:1; metadata:attack_target Server, created_at 2021_12_12, cve CVE_2021_44228, deployment Perimeter, deployment Internal, former_category EXPLOIT, signature_severity Major, tag Exploit, updated_at 2021_12_12;)

pass udp any any ->any any (msg:"[QUADRANT] Possible Apache log4j RCE Attempt - 2021/12/12 Obfuscation Observed M2 (CVE-2021-44228)"; content:"|24 7b|"; content:"|24 7b 3a 3a|"; distance:0; within:300; fast_pattern; xbits:set, log4j, track ip_src, expire 3600; reference:cve,2021-44228; reference:url,rules.emergingthreatspro.com/open/; reference:url,community.emergingthreats.net; classtype:attempted-admin; sid:1000399; rev:1; metadata:attack_target Server, created_at 2021_12_12, cve CVE_2021_44228, deployment Perimeter, deployment Internal, former_category EXPLOIT, signature_severity Major, tag Exploit, updated_at 2021_12_12;)

pass tcp any any ->any any (msg:"[QUADRANT] Possible Apache log4j RCE Attempt - 2021/12/13 Obfuscation Observed (CVE-2021-44228)"; flow:established,to_server; content:"|24 7b|"; pcre:"/^(j|\x24\x7b(lower|upper)\x3aj\x7d|\x24\x7b\x3a\x3a\-j\x7d)(n|\x24\x7b(lower|upper)\x3an\x7d|\x24\x7b\x3a\x3a\-n\x7d)/Ri"; content:"|3a|"; distance:0; content:"|24 7b|env|3a|"; distance:0; xbits:set, log4j, track ip_src, expire 3600; reference:cve,2021-44228; reference:url,rules.emergingthreatspro.com/open/; reference:url,community.emergingthreats.net; classtype:attempted-admin; sid:1000400; rev:1; metadata:attack_target Server, created_at 2021_12_13, cve CVE_2021_44228, deployment Perimeter, deployment Internal, former_category EXPLOIT, signature_severity Major, tag Exploit, updated_at 2021_12_13;)

pass tcp any any ->any any (msg:"[QUADRANT] Apache log4j RCE Attempt - AWS Access Key Disclosure (CVE-2021-44228)"; flow:established,to_server; content:"|24 7b|"; pcre:"/^(j|\x24\x7b(lower|upper)\x3aj\x7d|\x24\x7b\x3a\x3a\-j\x7d)(n|\x24\x7b(lower|upper)\x3an\x7d|\x24\x7b\x3a\x3a\-n\x7d)/Ri"; content:"|3a|"; distance:0; content:"|24 7b|env|3a|AWS_ACCESS_KEY_ID"; distance:0; xbits:set, log4j, track ip_src, expire 3600; reference:cve,2021-44228; reference:url,rules.emergingthreatspro.com/open/; reference:url,community.emergingthreats.net; classtype:attempted-admin; sid:1000401; rev:1; metadata:attack_target Server, created_at 2021_12_14, cve CVE_2021_44228, deployment Perimeter, deployment Internal, former_category EXPLOIT, signature_severity Major, tag Exploit, updated_at 2021_12_14;)

pass tcp any any ->any any (msg:"[QUADRANT] Apache log4j RCE Attempt - lower/upper TCP Bypass M2 (CVE-2021-44228)"; flow:established,to_server; content:"|24 7b|jndi|3a|"; nocase; fast_pattern; pcre:"/^(l|r|d|\x24\x7b(lower|upper)\x3a(l|r|d)\x7d)(d|n|m|\x24\x7b(lower|upper)\x3a(d|n|m)\x7d)(a|i|s|\x24\x7b(lower|upper)\x3a(a|i|s)\x7d)(p|\x24\x7b(lower|upper)\x3a(p)\x7d)/Ri"; content:"|3a 2f 2f|"; distance:0; xbits:set, log4j, track ip_src, expire 3600; reference:cve,2021-44228; reference:url,rules.emergingthreatspro.com/open/; reference:url,community.emergingthreats.net; classtype:attempted-admin; sid:1000402; rev:1; metadata:attack_target Server, created_at 2021_12_14, cve CVE_2021_44228, deployment Perimeter, deployment Internal, former_category EXPLOIT, signature_severity Major, tag Exploit, updated_at 2021_12_14;)

pass udp any any ->any any (msg:"[QUADRANT] Apache log4j RCE Attempt - lower/upper UDP Bypass M2 (CVE-2021-44228)"; content:"|24 7b|jndi|3a|"; nocase; fast_pattern; pcre:"/^(l|r|d|\x24\x7b(lower|upper)\x3a(l|r|d)\x7d)(d|n|m|\x24\x7b(lower|upper)\x3a(d|n|m)\x7d)(a|i|s|\x24\x7b(lower|upper)\x3a(a|i|s)\x7d)(p|\x24\x7b(lower|upper)\x3a(p)\x7d)/Ri"; content:"|3a 2f 2f|"; distance:0; xbits:set, log4j, track ip_src, expire 3600; reference:cve,2021-44228; reference:url,rules.emergingthreatspro.com/open/; reference:url,community.emergingthreats.net; classtype:attempted-admin; sid:1000403; rev:1; metadata:attack_target Server, created_at 2021_12_14, cve CVE_2021_44228, deployment Perimeter, deployment Internal, former_category EXPLOIT, signature_severity Major, tag Exploit, updated_at 2021_12_14;)

pass tcp any any ->any any (msg:"[QUADRANT] Apache log4j RCE Attempt - Nested lower (tcp) (CVE-2021-44228)"; flow:established,to_server; content:"|24 7b 24 7b|lower|3a 24 7b|lower|3a|jndi"; fast_pattern; xbits:set, log4j, track ip_src, expire 3600; reference:cve,2021-44228; reference:url,rules.emergingthreatspro.com/open/; reference:url,community.emergingthreats.net; classtype:attempted-admin; sid:1000404; rev:1; metadata:attack_target Server, created_at 2021_12_14, cve CVE_2021_44228, deployment Perimeter, deployment Internal, former_category EXPLOIT, signature_severity Major, tag Exploit, updated_at 2021_12_14;)

pass udp any any ->any any (msg:"[QUADRANT] Apache log4j RCE Attempt - Nested lower (udp) (CVE-2021-44228)"; content:"|24 7b 24 7b|lower|3a 24 7b|lower|3a|jndi"; fast_pattern; xbits:set, log4j, track ip_src, expire 3600; reference:cve,2021-44228; reference:url,rules.emergingthreatspro.com/open/; reference:url,community.emergingthreats.net; classtype:attempted-admin; sid:1000405; rev:1; metadata:attack_target Server, created_at 2021_12_14, cve CVE_2021_44228, deployment Perimeter, deployment Internal, former_category EXPLOIT, signature_severity Major, tag Exploit, updated_at 2021_12_14;)

pass tcp any any ->any any (msg:"[QUADRANT] Apache log4j RCE Attempt - Nested upper (tcp) (CVE-2021-44228)"; flow:established,to_server; content:"|24 7b 24 7b|upper|3a 24 7b|upper|3a|jndi"; fast_pattern; xbits:set, log4j, track ip_src, expire 3600; reference:cve,2021-44228; reference:url,rules.emergingthreatspro.com/open/; reference:url,community.emergingthreats.net; classtype:attempted-admin; sid:1000406; rev:1; metadata:attack_target Server, created_at 2021_12_14, cve CVE_2021_44228, deployment Perimeter, deployment Internal, former_category EXPLOIT, signature_severity Major, tag Exploit, updated_at 2021_12_14;)

pass udp any any ->any any (msg:"[QUADRANT] Apache log4j RCE Attempt - Nested upper (udp) (CVE-2021-44228)"; content:"|24 7b 24 7b|upper|3a 24 7b|upper|3a|jndi"; fast_pattern; xbits:set, log4j, track ip_src, expire 3600; reference:cve,2021-44228; reference:url,rules.emergingthreatspro.com/open/; reference:url,community.emergingthreats.net; classtype:attempted-admin; sid:1000407; rev:1; metadata:attack_target Server, created_at 2021_12_14, cve CVE_2021_44228, deployment Perimeter, deployment Internal, former_category EXPLOIT, signature_severity Major, tag Exploit, updated_at 2021_12_14;)

pass tcp any any ->any any (msg:"[QUADRANT] Possible Apache log4j RCE Attempt (tcp nis) (CVE-2021-44228)"; flow:established,to_server; content:"|24 7b|jndi|3a|nis|3a|"; fast_pattern; xbits:set, log4j, track ip_src, expire 3600; reference:cve,2021-44228; reference:url,rules.emergingthreatspro.com/open/; reference:url,community.emergingthreats.net; classtype:attempted-admin; sid:1000408; rev:1; metadata:attack_target Server, created_at 2021_12_14, cve CVE_2021_44228, deployment Perimeter, deployment Internal, former_category EXPLOIT, signature_severity Major, tag Exploit, updated_at 2021_12_14;)

pass udp any any ->any any (msg:"[QUADRANT] Possible Apache log4j RCE Attempt (udp nis) (CVE-2021-44228)"; content:"|24 7b|jndi|3a|nis|3a|"; fast_pattern; xbits:set, log4j, track ip_src, expire 3600; reference:cve,2021-44228; reference:url,rules.emergingthreatspro.com/open/; reference:url,community.emergingthreats.net; classtype:attempted-admin; sid:1000409; rev:1; metadata:attack_target Server, created_at 2021_12_14, cve CVE_2021_44228, deployment Perimeter, deployment Internal, former_category EXPLOIT, signature_severity Major, tag Exploit, updated_at 2021_12_14;)

pass tcp any any ->any any (msg:"[QUADRANT] Possible Apache log4j RCE Attempt (tcp nds) (CVE-2021-44228)"; flow:established,to_server; content:"|24 7b|jndi|3a|nds|3a|"; fast_pattern; xbits:set, log4j, track ip_src, expire 3600; reference:cve,2021-44228; reference:url,rules.emergingthreatspro.com/open/; reference:url,community.emergingthreats.net; classtype:attempted-admin; sid:1000410; rev:1; metadata:attack_target Server, created_at 2021_12_14, cve CVE_2021_44228, deployment Perimeter, deployment Internal, former_category EXPLOIT, signature_severity Major, tag Exploit, updated_at 2021_12_14;)

pass udp any any ->any any (msg:"[QUADRANT] Possible Apache log4j RCE Attempt (udp nds) (CVE-2021-44228)"; content:"|24 7b|jndi|3a|nds|3a|"; fast_pattern; xbits:set, log4j, track ip_src, expire 3600; reference:cve,2021-44228; reference:url,rules.emergingthreatspro.com/open/; reference:url,community.emergingthreats.net; classtype:attempted-admin; sid:1000411; rev:1; metadata:attack_target Server, created_at 2021_12_14, cve CVE_2021_44228, deployment Perimeter, deployment Internal, former_category EXPLOIT, signature_severity Major, tag Exploit, updated_at 2021_12_14;)

pass tcp any any ->any any (msg:"[QUADRANT] Possible Apache log4j RCE Attempt (tcp corba) (CVE-2021-44228)"; flow:established,to_server; content:"|24 7b|jndi|3a|corba|3a|"; fast_pattern; xbits:set, log4j, track ip_src, expire 3600; reference:cve,2021-44228; reference:url,rules.emergingthreatspro.com/open/; reference:url,community.emergingthreats.net; classtype:attempted-admin; sid:1000412; rev:1; metadata:attack_target Server, created_at 2021_12_14, cve CVE_2021_44228, deployment Perimeter, deployment Internal, former_category EXPLOIT, signature_severity Major, tag Exploit, updated_at 2021_12_14;)

pass udp any any ->any any (msg:"[QUADRANT] Possible Apache log4j RCE Attempt (udp corba) (CVE-2021-44228)"; content:"|24 7b|jndi|3a|corba|3a|"; fast_pattern; xbits:set, log4j, track ip_src, expire 3600; reference:cve,2021-44228; reference:url,rules.emergingthreatspro.com/open/; reference:url,community.emergingthreats.net; classtype:attempted-admin; sid:1000413; rev:1; metadata:attack_target Server, created_at 2021_12_14, cve CVE_2021_44228, deployment Perimeter, deployment Internal, former_category EXPLOIT, signature_severity Major, tag Exploit, updated_at 2021_12_14;)

pass tcp any any ->any any (msg:"[QUADRANT] Possible Apache log4j RCE Attempt - Base64 jndi (CVE-2021-44228)"; flow:established,to_server; content:"|24 7b|base64|3a|JHtqbmRp"; fast_pattern; xbits:set, log4j, track ip_src, expire 3600; reference:cve,2021-44228; reference:url,rules.emergingthreatspro.com/open/; reference:url,community.emergingthreats.net; classtype:attempted-admin; sid:1000414; rev:1; metadata:attack_target Server, created_at 2021_12_14, cve CVE_2021_44228, deployment Perimeter, deployment Internal, former_category EXPLOIT, signature_severity Major, tag Exploit, updated_at 2021_12_14;)

pass udp any any ->any any (msg:"[QUADRANT] Possible Apache log4j RCE Attempt - Base64 jndi (CVE-2021-44228)"; content:"|24 7b|base64|3a|JHtqbmRp"; fast_pattern; xbits:set, log4j, track ip_src, expire 3600; reference:cve,2021-44228; reference:url,rules.emergingthreatspro.com/open/; reference:url,community.emergingthreats.net; classtype:attempted-admin; sid:1000415; rev:1; metadata:attack_target Server, created_at 2021_12_14, cve CVE_2021_44228, deployment Perimeter, deployment Internal, former_category EXPLOIT, signature_severity Major, tag Exploit, updated_at 2021_12_14;)

pass tcp any any ->any any (msg:"[QUADRANT] Possible Apache log4j RCE Attempt - Any Protocol (CVE-2021-44228)"; flow:established,to_server; content:"|24 7b|jndi|3a|"; nocase; fast_pattern; content:"|3a 2f 2f|"; distance:0; within:20; xbits:set, log4j, track ip_src, expire 3600; reference:cve,2021-44228; reference:url,rules.emergingthreatspro.com/open/; reference:url,community.emergingthreats.net; classtype:misc-activity; sid:1000416; rev:1; metadata:created_at 2021_12_11, cve CVE_2021_44228, former_category HUNTING, updated_at 2021_12_11;)

pass udp any any ->any any (msg:"[QUADRANT] Possible Apache log4j RCE Attempt - Any Protocol (CVE-2021-44228)"; content:"|24 7b|jndi|3a|"; nocase; fast_pattern; content:"|3a 2f 2f|"; distance:0; within:20; xbits:set, log4j, track ip_src, expire 3600; reference:cve,2021-44228; reference:url,rules.emergingthreatspro.com/open/; reference:url,community.emergingthreats.net; classtype:misc-activity; sid:1000417; rev:2; metadata:created_at 2021_12_11, cve CVE_2021_44228, former_category HUNTING, updated_at 2021_12_11;)

pass tcp any any ->any any (msg:"[QUADRANT] Possible Apache log4j RCE Attempt - Any Protocol upper Bypass (CVE-2021-44228)"; flow:established,to_server; content:"|24 7b|jndi|3a|"; nocase; fast_pattern; content:"|24 7b|upper|3a|"; distance:0; xbits:set, log4j, track ip_src, expire 3600; reference:cve,2021-44228; reference:url,rules.emergingthreatspro.com/open/; reference:url,community.emergingthreats.net; classtype:misc-activity; sid:1000418; rev:1; metadata:created_at 2021_12_11, cve CVE_2021_44228, former_category HUNTING, updated_at 2021_12_11;)

pass udp any any ->any any (msg:"[QUADRANT] Possible Apache log4j RCE Attempt - Any Protocol upper Bypass (CVE-2021-44228)"; content:"|24 7b|jndi|3a|"; nocase; fast_pattern; content:"|24 7b|upper|3a|"; distance:0; xbits:set, log4j, track ip_src, expire 3600; reference:cve,2021-44228; reference:url,rules.emergingthreatspro.com/open/; reference:url,community.emergingthreats.net; classtype:misc-activity; sid:1000419; rev:1; metadata:created_at 2021_12_11, cve CVE_2021_44228, former_category HUNTING, updated_at 2021_12_11;)

pass tcp any any ->any any (msg:"[QUADRANT] Possible Apache log4j RCE Attempt - Any Protocol lower Bypass (CVE-2021-44228)"; flow:established,to_server; content:"|24 7b|jndi|3a|"; nocase; fast_pattern; content:"|24 7b|lower|3a|"; distance:0; xbits:set, log4j, track ip_src, expire 3600; reference:cve,2021-44228; reference:url,rules.emergingthreatspro.com/open/; reference:url,community.emergingthreats.net; classtype:misc-activity; sid:1000420; rev:1; metadata:created_at 2021_12_11, cve CVE_2021_44228, former_category HUNTING, updated_at 2021_12_11;)
#========================================================================================================


alert tcp any any -> any any (msg:"[QUADRANT] LDAP Bind Request NO ALERT"; flow:established,to_server; content:"|30 0c 02 01 01 60|"; depth:6; flowbits:set,ldap.bind; flowbits:noalert; classtype:protocol-command-decode; metadata:created_at 2021_12_16, updated_at 2021_12_16; sid:1000423; rev:1;)

alert tcp any any -> any any (msg:"[QUADRANT] Java class download over LDAP (CVE-2021-44228)"; flow:established,to_client; flowbits:isset,ldap.bind; content:"javaClassName"; nocase; reference:cve,2021-44228; metadata:created_at 2021_12_16, updated_at 2021_12_16; classtype:attempted-admin; sid:1000424; rev:1;)

#Alerts specifically on OUTBOUND bind request attempts, does not set flowbit as the "NO ALERT" rule would have already done this.



alert tcp any any -> any any (msg: "[QUADRANT] MSDT PCWDiagnostic Call to PowerShell Command Detected (CVE-2022-30190)"; content: "ms-msd|3a 2f|id"; nocase; content: "PCWDiagnostic"; nocase; content: "Invoke"; nocase; classtype: shellcode-detect; reference: url,www.huntress.com/blog/microsoft-office-remote-code-execution-follina-msdt-bug; sid:1000426; rev: 1;)

alert tcp any any -> any any (msg: "[QUADRANT] MSDT PCWDiagnostic Call to PowerShell Detected (CVE-2022-30190)"; content: "ms-msd|3a 2f|id"; nocase; content: "PCWDiagnostic"; nocase; content: "IEX"; nocase; classtype: shellcode-detect; reference: url,www.huntress.com/blog/microsoft-office-remote-code-execution-follina-msdt-bug; sid:1000427; rev: 1;)

alert tcp any any -> any any (msg: "[QUADRANT] MSDT PCWDiagnostic Call to Suspicious Command Detected (CVE-2022-30190)"; content: "ms-msd|3a 2f|id"; nocase; content: "PCWDiagnostic"; nocase; content: "IT_RebrowseForFile"; nocase; classtype: shellcode-detect; reference: url,www.huntress.com/blog/microsoft-office-remote-code-execution-follina-msdt-bug; sid:1000428; rev: 1;)

alert tcp any any -> any any (msg: "[QUADRANT] MSDT PCWDiagnostic Call to Suspicious Command Detected (CVE-2022-30190)"; content: "ms-msd|3a 2f|id"; nocase; content: "PCWDiagnostic"; nocase; content: "IT_LaunchMethod"; nocase; classtype: shellcode-detect; reference: url,www.huntress.com/blog/microsoft-office-remote-code-execution-follina-msdt-bug; sid:1000429; rev: 1;)

alert tcp any any -> any any (msg: "[QUADRANT] MSDT PCWDiagnostic Call to Suspicious Command Detected (CVE-2022-30190)"; content: "ms-msd|3a 2f|id"; nocase; content: "PCWDiagnostic"; nocase; content: "IT_SelectProgram"; nocase; classtype: shellcode-detect; reference: url,www.huntress.com/blog/microsoft-office-remote-code-execution-follina-msdt-bug; sid:1000430; rev: 1;)

alert icmp $HOME_NET any -> any any (msg:" ET MALWARE Pingback lock Command Issued"; dsize:>787; itype:8; content:"lock"; depth:10; reference:url,www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/backdoor-at-the-end-of-the-icmp-tunnel/; reference:md5,264c2ede235dc7232d673d4748437969; classtype:trojan-activity; sid:10000431; rev:1; metadata:attack_target Client_Endpoint, created_at 2021_05_10, deployment Perimeter, former_category MALWARE, performance_impact Low, signature_severity Major, updated_at 2021_14_10;)

alert icmp $HOME_NET any -> any any (msg:"ET MALWARE Pingback Filename Observed"; dsize:>787; itype:8; content:"PingBack"; depth:10; reference:url,www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/backdoor-at-the-end-of-the-icmp-tunnel/; reference:md5,264c2ede235dc7232d673d4748437969; classtype:trojan-activity; sid:10000432; rev:1; metadata:attack_target Client_Endpoint, created_at 2021_05_10, deployment Perimeter, former_category MALWARE, performance_impact Low, signature_severity Major, updated_at 2021_14_10;)

#Added 11/04/2022 for OpenSSL 0-day detection by SDeSorbo and Bryant Smith
alert tls any any -> any any (msg:"[QUADRANT] Possible SpookySSL Certificate Observed (CVE-2022-3602)(Fox-IT)"; flow:established,from_server; content:"|2b 06 01 05 05 07 08 09|"; fast_pattern; content:"|06 03 55 1d 1e|"; content:"xn--"; content:!"|81|"; distance:-6; within:1; byte_test:2,>=,500,-6,relative; classtype:attempted-user; threshold:type limit,track by_src, count 1,seconds 3600; reference:url,www.openssl.org/news/secadv/20221101.txt; reference:url,https://github.com/fox-it/spookyssl-pcaps; sid:21004268; rev:3;)

#========================================================================================================
# 		New Suricata signatures go here.  SID range 81000000-81999999
#========================================================================================================

#alert ftp any any -> any any (msg:"[QUADRANT] External FTP Connection Established"; flow:established,to_server; classtype:policy-violation; sid:81000000; rev:1;)

alert ftp any any -> any any (msg:"[QUADRANT] Possible data exfil via FTP"; flow:established,to_server; content:"STOR"; offset:0; depth:4; threshold:type both,track by_both, count 50, seconds 300; classtype:trojan-activity; sid:81000001; rev:1;)

alert ftp any any -> any any (msg:"[QUADRANT] Multiple directory listing via LIST command"; flow:established,to_server; content:"LIST"; offset:0; depth:4; threshold:type both,track by_both, count 50, seconds 300; classtype:trojan-activity; sid:81000002; rev:1;)

alert ftp any any -> any any (msg:"[QUADRANT] Multiple directories created via MKD command"; flow:established,to_server; content:"MKD"; offset:0; depth:3; threshold:type both,track by_both, count 50, seconds 300; classtype:trojan-activity; sid:81000003; rev:1;)

alert http any any -> any any (msg:"[QUADRANT] OpenSSL Critical version found m1"; flow:established,from_server; http.header; content:"OpenSSL|2f|3.0."; nocase; content:!"OpenSSL/3.0.7"; nocase; threshold:type both, track by_src, count 1, seconds 3600; reference:url,www.zdnet.com/article/openssl-warns-of-critical-security-vulnerability-with-upcoming-patch/; reference:cve,2022-2274; classtype:misc-activity; sid:81000004; rev:1;)

alert http any any -> any any (msg:"[QUADRANT] OpenSSL Critical version found m2"; flow:established,to_server; http.header; content:"OpenSSL|2f|3.0."; nocase; content:!"OpenSSL|2f|3.0.7"; nocase; threshold:type both, track by_src, count 1, seconds 3600; reference:url,www.zdnet.com/article/openssl-warns-of-critical-security-vulnerability-with-upcoming-patch/; reference:cve,2022-2274; classtype:misc-activity; sid:81000005; rev:1;)

#alert tcp any any -> any 389 (msg:"[QUADRANT] Possible ADFind objectcategory=computer request"; flow:established,to_server; content:"DC="; content:"|0a 01 02 0a 01|"; distance:0; content:"|0e|objectcategory"; nocase; content:"|08|computer|30|"; nocase; distance:1; within:10; reference:url,thedfirreport.com/2020/05/08/adfind-recon/; reference:url,www.ietf.org/rfc/rfc2251.txt; sid:81000006; rev:1;)

alert tcp any any -> any 389 (msg:"[QUADRANT] Possible ADFind objectcategory=users request"; flow:established,to_server; content:"DC="; content:"|0a 01 02 0a 01|"; distance:0; content:"|0e|objectcategory"; nocase; content:"|06|person|30|"; nocase; distance:1; within:10; reference:url,thedfirreport.com/2020/05/08/adfind-recon/; reference:url,www.ietf.org/rfc/rfc2251.txt; sid:81000007; rev:1;)

alert tcp any any -> any 389 (msg:"[QUADRANT] Possible ADFind User Access Control Password Not Required Request"; flow:established,to_server; content:"DC="; content:"|0a 01 02 0a 01|"; distance:0; content:"|0e|objectcategory"; nocase; content:"|09|computers"; nocase; distance:1; within:10; content:"1.2.840.113556.1.4.803"; distance:1; content:"useraccountcontrol"; distance:0; content:"|33|"; distance:2; within:1; reference:url,thedfirreport.com/2020/05/08/adfind-recon/; reference:url,www.ietf.org/rfc/rfc2251.txt; sid:81000008; rev:1;)

alert tcp any any -> any 389 (msg:"[QUADRANT] Possible ADFind objectcategory=trustdmp request"; flow:established,to_server; content:"DC="; content:"|0a 01 02 0a 01|"; distance:0; content:"|0e|objectcategory"; nocase; content:"|0d|trustedDomain|30|"; nocase; distance:1; within:15; reference:url,thedfirreport.com/2020/05/08/adfind-recon/; reference:url,www.ietf.org/rfc/rfc2251.txt; sid:81000009; rev:1;)

alert tcp any any -> any 389 (msg:"[QUADRANT] Possible ADFind objectcategory=subnet request"; flow:established,to_server; content:"DC="; content:"|0a 01 02 0a 01|"; distance:0; content:"|0e|objectcategory"; nocase; content:"|06|subnet|30|"; nocase; reference:url,thedfirreport.com/2020/05/08/adfind-recon/; reference:url,www.ietf.org/rfc/rfc2251.txt; sid:81000010; rev:1;)

alert tcp any any -> any 389 (msg:"[QUADRANT] Possible ADFind objectcategory=group request"; flow:established,to_server; content:"DC="; content:"|0a 01 02 0a 01|"; distance:0; content:"|0e|objectcategory"; nocase; content:"|05|group|30|"; nocase; reference:url,thedfirreport.com/2020/05/08/adfind-recon/; reference:url,www.ietf.org/rfc/rfc2251.txt; sid:81000011; rev:1;)

alert tcp any any -> any 389 (msg:"[QUADRANT] Possible ADFind objectcategory=organizationalUnit request"; flow:established,to_server; content:"DC="; content:"|0a 01 02 0a 01|"; distance:0; content:"|0e|objectcategory"; nocase; content:"|12|organizationalUnit|30|"; nocase; reference:url,thedfirreport.com/2020/05/08/adfind-recon/; reference:url,www.ietf.org/rfc/rfc2251.txt; sid:81000012; rev:1;)

alert tcp any any -> any 389 (msg:"[QUADRANT] Possible ADFind administrators list"; flow:established,to_server; content:"DC="; content:"|0a 01 02 0a 01|"; distance:0; content:"|04|name"; nocase; distance:0; content:"|0e|administrators|30|"; nocase; distance:1; within:16; content:"member"; distance:0; reference:url,thedfirreport.com/2020/05/08/adfind-recon/; reference:url,www.ietf.org/rfc/rfc2251.txt; sid:81000013; rev:2;)

alert tcp any any -> any 389 (msg:"[QUADRANT] Possible ADFind objectcategory=dcmode"; flow:established,to_server; content:"DC="; content:"|0a 01 02 0a 01|"; distance:0; content:"|0e|objectcategory"; nocase; distance:0; content:"|07|ntdsdsa|30|"; nocase; distance:1; within:9; reference:url,thedfirreport.com/2020/05/08/adfind-recon/; reference:url,www.ietf.org/rfc/rfc2251.txt; sid:81000014; rev:1;)

alert tls any any -> any any (msg:"[QUADRANT] downloads.rclone.org TLS SNI Detected"; flow:established,to_server; tls.sni; content:"downloads.rclone.org"; nocase; classtype:trojan-activity; sid:81000015; rev:1; metadata:deployment Perimeter,affected_product NONE,affected_version NONE,mitigation NONE,deprecation_reason NONE,tag NONE, created_at 2023_02_07, updated_at 2023_02_07, mitre_tactic_id TA0010, mitre_technique_id T1567.002;)

alert http any any -> any any (msg:"[QUADRANT] Rclone User-Agent Detected - Possible Exfil"; flow:established,to_server; http.user_agent; content:"rclone"; classtype:trojan-activity; sid:81000016; rev:1; metadata:deployment Perimeter,affected_product NONE,affected_version NONE,mitigation NONE,deprecation_reason NONE,tag NONE, created_at 2023_02_07, updated_at 2023_02_07, mitre_tactic_id TA0010, mitre_technique_id T1567.002;)

alert http any any -> any any (msg:"[QUADRANT] Rclone User-Agent POST to Mega - Possible Exfil"; flow:established,to_server; http.method; content:"POST"; http.host; content:".userstorage.mega."; http.user_agent; content:"rclone"; classtype:trojan-activity; sid:81000017; rev:1; metadata:deployment Perimeter,affected_product NONE,affected_version NONE,mitigation NONE,deprecation_reason NONE,tag NONE, created_at 2023_02_07, updated_at 2023_02_07, mitre_tactic_id TA0010, mitre_technique_id T1567.002;)

alert dns any any -> any any (msg:"[QUADRANT] DNS Query for userstorage.mega. - Possible Exfil"; dns.query; content:"userstorage.mega."; classtype:trojan-activity; sid:81000018; rev:1; metadata:deployment Perimeter,affected_product NONE,affected_version NONE,mitigation NONE,deprecation_reason NONE,tag NONE, created_at 2023_02_07, updated_at 2023_02_07, mitre_tactic_id TA0010, mitre_technique_id T1567.002;)


# sid range 2610000-2619999
# tar czvf hunting.rules.tar.gz hunting.rules && md5sum hunting.rules.tar.gz > hunting.rules.tar.gz.md5

## vulntesting domains
alert dns $HOME_NET any -> any any (msg:"TGI HUNT VulnTesting Domain (scannermcscanface-edgescan.com in DNS Lookup)"; dns_query; content:"scannermcscanface-edgescan.com"; isdataat:!1,relative; reference:url,gist.github.com/travisbgreen/3f7ddcd5841d802e536d5854e2218e8c; classtype:trojan-activity; sid:2610178; rev:1;)
alert tls $HOME_NET any -> $EXTERNAL_NET any (msg:"TGI HUNT VulnTesting Domain (scannermcscanface-edgescan .com in TLS SNI)"; flow:established,to_server; tls_sni; content:"scannermcscanface-edgescan.com"; isdataat:!1,relative; nocase; reference:url,gist.github.com/travisbgreen/3f7ddcd5841d802e536d5854e2218e8c; classtype:trojan-activity; sid:2610180; rev:1;)
alert dns $HOME_NET any -> any any (msg:"TGI HUNT VulnTesting Domain (w.nessus.org in DNS Lookup)"; dns_query; content:"w.nessus.org"; isdataat:!1,relative; reference:url,gist.github.com/travisbgreen/3f7ddcd5841d802e536d5854e2218e8c; classtype:trojan-activity; sid:2610182; rev:1;)
alert tls $HOME_NET any -> $EXTERNAL_NET any (msg:"TGI HUNT VulnTesting Domain (w .nessus .org in TLS SNI)"; flow:established,to_server; tls_sni; content:"w.nessus.org"; isdataat:!1,relative; nocase; reference:url,gist.github.com/travisbgreen/3f7ddcd5841d802e536d5854e2218e8c; classtype:trojan-activity; sid:2610184; rev:1;)
alert dns $HOME_NET any -> any any (msg:"TGI HUNT VulnTesting Domain (notburpcollaborator.net in DNS Lookup)"; dns_query; content:"notburpcollaborator.net"; isdataat:!1,relative; reference:url,gist.github.com/travisbgreen/3f7ddcd5841d802e536d5854e2218e8c; classtype:trojan-activity; sid:2610186; rev:1;)
alert tls $HOME_NET any -> $EXTERNAL_NET any (msg:"TGI HUNT VulnTesting Domain (notburpcollaborator .net in TLS SNI)"; flow:established,to_server; tls_sni; content:"notburpcollaborator.net"; isdataat:!1,relative; nocase; reference:url,gist.github.com/travisbgreen/3f7ddcd5841d802e536d5854e2218e8c; classtype:trojan-activity; sid:2610188; rev:1;)
alert dns $HOME_NET any -> any any (msg:"TGI HUNT VulnTesting Domain (pwn.af in DNS Lookup)"; dns_query; content:"pwn.af"; isdataat:!1,relative; reference:url,gist.github.com/travisbgreen/3f7ddcd5841d802e536d5854e2218e8c; classtype:trojan-activity; sid:2610190; rev:1;)
alert tls $HOME_NET any -> $EXTERNAL_NET any (msg:"TGI HUNT VulnTesting Domain (pwn .af in TLS SNI)"; flow:established,to_server; tls_sni; content:"pwn.af"; isdataat:!1,relative; nocase; reference:url,gist.github.com/travisbgreen/3f7ddcd5841d802e536d5854e2218e8c; classtype:trojan-activity; sid:2610192; rev:1;)
alert dns $HOME_NET any -> any any (msg:"TGI HUNT VulnTesting Domain (leakix.net in DNS Lookup)"; dns_query; content:"leakix.net"; isdataat:!1,relative; reference:url,gist.github.com/travisbgreen/3f7ddcd5841d802e536d5854e2218e8c; classtype:trojan-activity; sid:2610194; rev:1;)
alert tls $HOME_NET any -> $EXTERNAL_NET any (msg:"TGI HUNT VulnTesting Domain (leakix .net in TLS SNI)"; flow:established,to_server; tls_sni; content:"leakix.net"; isdataat:!1,relative; nocase; reference:url,gist.github.com/travisbgreen/3f7ddcd5841d802e536d5854e2218e8c; classtype:trojan-activity; sid:2610196; rev:1;)
alert dns $HOME_NET any -> any any (msg:"TGI HUNT VulnTesting Domain (interactsh.com in DNS Lookup)"; dns_query; content:"interactsh.com"; isdataat:!1,relative; reference:url,gist.github.com/travisbgreen/3f7ddcd5841d802e536d5854e2218e8c; classtype:trojan-activity; sid:2610198; rev:1;)
alert tls $HOME_NET any -> $EXTERNAL_NET any (msg:"TGI HUNT VulnTesting Domain (interactsh .com in TLS SNI)"; flow:established,to_server; tls_sni; content:"interactsh.com"; isdataat:!1,relative; nocase; reference:url,gist.github.com/travisbgreen/3f7ddcd5841d802e536d5854e2218e8c; classtype:trojan-activity; sid:2610200; rev:1;)
alert dns $HOME_NET any -> any any (msg:"TGI HUNT VulnTesting Domain (interact.sh in DNS Lookup)"; dns_query; content:"interact.sh"; isdataat:!1,relative; reference:url,gist.github.com/travisbgreen/3f7ddcd5841d802e536d5854e2218e8c; classtype:trojan-activity; sid:2610202; rev:1;)
alert tls $HOME_NET any -> $EXTERNAL_NET any (msg:"TGI HUNT VulnTesting Domain (interact .sh in TLS SNI)"; flow:established,to_server; tls_sni; content:"interact.sh"; isdataat:!1,relative; nocase; reference:url,gist.github.com/travisbgreen/3f7ddcd5841d802e536d5854e2218e8c; classtype:trojan-activity; sid:2610204; rev:1;)
alert dns $HOME_NET any -> any any (msg:"TGI HUNT VulnTesting Domain (burpcollaborator.net in DNS Lookup)"; dns_query; content:"burpcollaborator.net"; isdataat:!1,relative; reference:url,gist.github.com/travisbgreen/3f7ddcd5841d802e536d5854e2218e8c; classtype:trojan-activity; sid:2610206; rev:1;)
alert tls $HOME_NET any -> $EXTERNAL_NET any (msg:"TGI HUNT VulnTesting Domain (burpcollaborator .net in TLS SNI)"; flow:established,to_server; tls_sni; content:"burpcollaborator.net"; isdataat:!1,relative; nocase; reference:url,gist.github.com/travisbgreen/3f7ddcd5841d802e536d5854e2218e8c; classtype:trojan-activity; sid:2610208; rev:1;)
alert dns $HOME_NET any -> any any (msg:"TGI HUNT VulnTesting Domain (canarytokens.com in DNS Lookup)"; dns_query; content:"canarytokens.com"; isdataat:!1,relative; reference:url,gist.github.com/travisbgreen/3f7ddcd5841d802e536d5854e2218e8c; classtype:trojan-activity; sid:2610210; rev:1;)
alert tls $HOME_NET any -> $EXTERNAL_NET any (msg:"TGI HUNT VulnTesting Domain (canarytokens .com in TLS SNI)"; flow:established,to_server; tls_sni; content:"canarytokens.com"; isdataat:!1,relative; nocase; reference:url,gist.github.com/travisbgreen/3f7ddcd5841d802e536d5854e2218e8c; classtype:trojan-activity; sid:2610212; rev:1;)
alert dns $HOME_NET any -> any any (msg:"TGI HUNT VulnTesting Domain (kryptoslogic-cve-2021-44228.com in DNS Lookup)"; dns_query; content:"kryptoslogic-cve-2021-44228.com"; isdataat:!1,relative; reference:url,gist.github.com/travisbgreen/3f7ddcd5841d802e536d5854e2218e8c; classtype:trojan-activity; sid:2610214; rev:1;)
alert tls $HOME_NET any -> $EXTERNAL_NET any (msg:"TGI HUNT VulnTesting Domain (kryptoslogic-cve-2021-44228 .com in TLS SNI)"; flow:established,to_server; tls_sni; content:"kryptoslogic-cve-2021-44228.com"; isdataat:!1,relative; nocase; reference:url,gist.github.com/travisbgreen/3f7ddcd5841d802e536d5854e2218e8c; classtype:trojan-activity; sid:2610216; rev:1;)
alert dns $HOME_NET any -> any any (msg:"TGI HUNT VulnTesting Domain (http80path.kryptoslogic-cve-2021-44228.com in DNS Lookup)"; dns_query; content:"http80path.kryptoslogic-cve-2021-44228.com"; isdataat:!1,relative; reference:url,gist.github.com/travisbgreen/3f7ddcd5841d802e536d5854e2218e8c; classtype:trojan-activity; sid:2610218; rev:1;)
alert tls $HOME_NET any -> $EXTERNAL_NET any (msg:"TGI HUNT VulnTesting Domain (http80path .kryptoslogic-cve-2021-44228 .com in TLS SNI)"; flow:established,to_server; tls_sni; content:"http80path.kryptoslogic-cve-2021-44228.com"; isdataat:!1,relative; nocase; reference:url,gist.github.com/travisbgreen/3f7ddcd5841d802e536d5854e2218e8c; classtype:trojan-activity; sid:2610220; rev:1;)
alert dns $HOME_NET any -> any any (msg:"TGI HUNT VulnTesting Domain (dnslog.cn in DNS Lookup)"; dns_query; content:"dnslog.cn"; isdataat:!1,relative; reference:url,gist.github.com/travisbgreen/3f7ddcd5841d802e536d5854e2218e8c; classtype:trojan-activity; sid:2610222; rev:1;)
alert tls $HOME_NET any -> $EXTERNAL_NET any (msg:"TGI HUNT VulnTesting Domain (dnslog .cn in TLS SNI)"; flow:established,to_server; tls_sni; content:"dnslog.cn"; isdataat:!1,relative; nocase; reference:url,gist.github.com/travisbgreen/3f7ddcd5841d802e536d5854e2218e8c; classtype:trojan-activity; sid:2610224; rev:1;)
alert dns $HOME_NET any -> any any (msg:"TGI HUNT VulnTesting Domain (world443.log4j.binaryedge.io in DNS Lookup)"; dns_query; content:"world443.log4j.binaryedge.io"; isdataat:!1,relative; reference:url,gist.github.com/travisbgreen/3f7ddcd5841d802e536d5854e2218e8c; classtype:trojan-activity; sid:2610226; rev:1;)
alert tls $HOME_NET any -> $EXTERNAL_NET any (msg:"TGI HUNT VulnTesting Domain (world443 .log4j .binaryedge .io in TLS SNI)"; flow:established,to_server; tls_sni; content:"world443.log4j.binaryedge.io"; isdataat:!1,relative; nocase; reference:url,gist.github.com/travisbgreen/3f7ddcd5841d802e536d5854e2218e8c; classtype:trojan-activity; sid:2610228; rev:1;)
alert dns $HOME_NET any -> any any (msg:"TGI HUNT VulnTesting Domain (world80.log4j.binaryedge.io in DNS Lookup)"; dns_query; content:"world80.log4j.binaryedge.io"; isdataat:!1,relative; reference:url,gist.github.com/travisbgreen/3f7ddcd5841d802e536d5854e2218e8c; classtype:trojan-activity; sid:2610230; rev:1;)
alert tls $HOME_NET any -> $EXTERNAL_NET any (msg:"TGI HUNT VulnTesting Domain (world80 .log4j .binaryedge .io in TLS SNI)"; flow:established,to_server; tls_sni; content:"world80.log4j.binaryedge.io"; isdataat:!1,relative; nocase; reference:url,gist.github.com/travisbgreen/3f7ddcd5841d802e536d5854e2218e8c; classtype:trojan-activity; sid:2610232; rev:1;)
alert dns $HOME_NET any -> any any (msg:"TGI HUNT VulnTesting Domain (scanworld.net in DNS Lookup)"; dns_query; content:"scanworld.net"; isdataat:!1,relative; reference:url,gist.github.com/travisbgreen/3f7ddcd5841d802e536d5854e2218e8c; classtype:trojan-activity; sid:2610234; rev:1;)
alert tls $HOME_NET any -> $EXTERNAL_NET any (msg:"TGI HUNT VulnTesting Domain (scanworld .net in TLS SNI)"; flow:established,to_server; tls_sni; content:"scanworld.net"; isdataat:!1,relative; nocase; reference:url,gist.github.com/travisbgreen/3f7ddcd5841d802e536d5854e2218e8c; classtype:trojan-activity; sid:2610236; rev:1;)
alert dns $HOME_NET any -> any any (msg:"TGI HUNT VulnTesting Domain (oob.li in DNS Lookup)"; dns_query; content:"oob.li"; isdataat:!1,relative; reference:url,gist.github.com/travisbgreen/3f7ddcd5841d802e536d5854e2218e8c; classtype:trojan-activity; sid:2610238; rev:1;)
alert tls $HOME_NET any -> $EXTERNAL_NET any (msg:"TGI HUNT VulnTesting Domain (oob .li in TLS SNI)"; flow:established,to_server; tls_sni; content:"oob.li"; isdataat:!1,relative; nocase; reference:url,gist.github.com/travisbgreen/3f7ddcd5841d802e536d5854e2218e8c; classtype:trojan-activity; sid:2610240; rev:1;)
alert dns $HOME_NET any -> any any (msg:"TGI HUNT VulnTesting Domain (bingsearchlib.com in DNS Lookup)"; dns_query; content:"bingsearchlib.com"; isdataat:!1,relative; reference:url,gist.github.com/travisbgreen/3f7ddcd5841d802e536d5854e2218e8c; classtype:trojan-activity; sid:2610242; rev:1;)
alert tls $HOME_NET any -> $EXTERNAL_NET any (msg:"TGI HUNT VulnTesting Domain (bingsearchlib .com in TLS SNI)"; flow:established,to_server; tls_sni; content:"bingsearchlib.com"; isdataat:!1,relative; nocase; reference:url,gist.github.com/travisbgreen/3f7ddcd5841d802e536d5854e2218e8c; classtype:trojan-activity; sid:2610244; rev:1;)
alert dns $HOME_NET any -> any any (msg:"TGI HUNT VulnTesting Domain (requestbin.net in DNS Lookup)"; dns_query; content:"requestbin.net"; isdataat:!1,relative; reference:url,gist.github.com/travisbgreen/3f7ddcd5841d802e536d5854e2218e8c; classtype:trojan-activity; sid:2610246; rev:1;)
alert tls $HOME_NET any -> $EXTERNAL_NET any (msg:"TGI HUNT VulnTesting Domain (requestbin .net in TLS SNI)"; flow:established,to_server; tls_sni; content:"requestbin.net"; isdataat:!1,relative; nocase; reference:url,gist.github.com/travisbgreen/3f7ddcd5841d802e536d5854e2218e8c; classtype:trojan-activity; sid:2610248; rev:1;)
alert dns $HOME_NET any -> any any (msg:"TGI HUNT VulnTesting Domain (rce.ee in DNS Lookup)"; dns_query; content:"rce.ee"; isdataat:!1,relative; reference:url,gist.github.com/travisbgreen/3f7ddcd5841d802e536d5854e2218e8c; classtype:trojan-activity; sid:2610250; rev:1;)
alert tls $HOME_NET any -> $EXTERNAL_NET any (msg:"TGI HUNT VulnTesting Domain (rce .ee in TLS SNI)"; flow:established,to_server; tls_sni; content:"rce.ee"; isdataat:!1,relative; nocase; reference:url,gist.github.com/travisbgreen/3f7ddcd5841d802e536d5854e2218e8c; classtype:trojan-activity; sid:2610252; rev:1;)
alert dns $HOME_NET any -> any any (msg:"TGI HUNT VulnTesting Domain (ceye.io in DNS Lookup)"; dns_query; content:"ceye.io"; isdataat:!1,relative; reference:url,gist.github.com/travisbgreen/3f7ddcd5841d802e536d5854e2218e8c; classtype:trojan-activity; sid:2610254; rev:1;)
alert tls $HOME_NET any -> $EXTERNAL_NET any (msg:"TGI HUNT VulnTesting Domain (ceye .io in TLS SNI)"; flow:established,to_server; tls_sni; content:"ceye.io"; isdataat:!1,relative; nocase; reference:url,gist.github.com/travisbgreen/3f7ddcd5841d802e536d5854e2218e8c; classtype:trojan-activity; sid:2610256; rev:1;)
alert dns $HOME_NET any -> any any (msg:"TGI HUNT VulnTesting Domain (log4shell.huntress.com in DNS Lookup)"; dns_query; content:"log4shell.huntress.com"; isdataat:!1,relative; reference:url,gist.github.com/travisbgreen/3f7ddcd5841d802e536d5854e2218e8c; classtype:trojan-activity; sid:2610258; rev:1;)
alert tls $HOME_NET any -> $EXTERNAL_NET any (msg:"TGI HUNT VulnTesting Domain (log4shell .huntress .com in TLS SNI)"; flow:established,to_server; tls_sni; content:"log4shell.huntress.com"; isdataat:!1,relative; nocase; reference:url,gist.github.com/travisbgreen/3f7ddcd5841d802e536d5854e2218e8c; classtype:trojan-activity; sid:2610260; rev:1;)
alert dns $HOME_NET any -> any any (msg:"TGI HUNT VulnTesting Domain (dns.cyberwar.nl in DNS Lookup)"; dns_query; content:"dns.cyberwar.nl"; isdataat:!1,relative; reference:url,gist.github.com/travisbgreen/3f7ddcd5841d802e536d5854e2218e8c; classtype:trojan-activity; sid:2610262; rev:1;)
alert tls $HOME_NET any -> $EXTERNAL_NET any (msg:"TGI HUNT VulnTesting Domain (dns .cyberwar .nl in TLS SNI)"; flow:established,to_server; tls_sni; content:"dns.cyberwar.nl"; isdataat:!1,relative; nocase; reference:url,gist.github.com/travisbgreen/3f7ddcd5841d802e536d5854e2218e8c; classtype:trojan-activity; sid:2610264; rev:1;)
alert dns $HOME_NET any -> any any (msg:"TGI HUNT VulnTesting Domain (log.exposedbotnets.ru in DNS Lookup)"; dns_query; content:"log.exposedbotnets.ru"; isdataat:!1,relative; reference:url,gist.github.com/travisbgreen/3f7ddcd5841d802e536d5854e2218e8c; classtype:trojan-activity; sid:2610266; rev:1;)
alert tls $HOME_NET any -> $EXTERNAL_NET any (msg:"TGI HUNT VulnTesting Domain (log .exposedbotnets .ru in TLS SNI)"; flow:established,to_server; tls_sni; content:"log.exposedbotnets.ru"; isdataat:!1,relative; nocase; reference:url,gist.github.com/travisbgreen/3f7ddcd5841d802e536d5854e2218e8c; classtype:trojan-activity; sid:2610268; rev:1;)
alert dns $HOME_NET any -> any any (msg:"TGI HUNT VulnTesting Domain (service.exfil.site in DNS Lookup)"; dns_query; content:"service.exfil.site"; isdataat:!1,relative; reference:url,gist.github.com/travisbgreen/3f7ddcd5841d802e536d5854e2218e8c; classtype:trojan-activity; sid:2610270; rev:1;)
alert tls $HOME_NET any -> $EXTERNAL_NET any (msg:"TGI HUNT VulnTesting Domain (service .exfil .site in TLS SNI)"; flow:established,to_server; tls_sni; content:"service.exfil.site"; isdataat:!1,relative; nocase; reference:url,gist.github.com/travisbgreen/3f7ddcd5841d802e536d5854e2218e8c; classtype:trojan-activity; sid:2610272; rev:1;)

## hunting / hueristic rules
alert http any any -> any any (msg:"TGI HUNT unknown command 610cker"; flow:to_server,established; content:"POST"; http_method; content:"/command.php"; http_uri; content:"cmd="; http_client_body; depth:4; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2610278; rev:1;)
alert http any any -> any any (msg:"TGI HUNT unknown etherium server probe"; flow:to_server,established; content:"POST"; http_method; urilen:1; content:"method|22 3a 22|eth_accounts"; http_client_body; http_content_type; content:"application/json"; reference:url,github.com/ethereum/wiki/wiki/JSON-RPC; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2610280; rev:1;)
alert http any any -> any any (msg:"TGI HUNT Graves Accent (backtick) in HTTP Header"; flow:established,to_server; content:"`"; http_header; content:!"`"; http_client_body; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2610282; rev:2;)
alert http any any -> any any (msg:"TGI HUNT Content-Type jpeg serving PE likely hostile"; flow:established,from_server; content:"200"; http_stat_code; content:"Content-Type|3a 20|image/jpeg"; http_header; file_data; content:"MZ"; depth:2; byte_jump:4,58,relative,little; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2610284; rev:1;)
alert http any any -> any any (msg:"TGI HUNT directory traversal in Zip"; flow:established; content:"PK"; content:"|2e 2e 5c|"; distance:28; within:3; fast_pattern; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2610286; rev:1;)
alert http any any -> any any (msg:"TGI HUNT unsafe PHP function in HTTP POST"; flow:established; content:"shell_exec("; http_client_body; fast_pattern; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2610288; rev:1;)
alert http any any -> any any (msg:"TGI HUNT unsafe PHP function in HTTP"; flow:established; content:"eval("; http_client_body; fast_pattern; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2610290; rev:1;)
#alert http any any -> any any (msg:"TGI HUNT two %25 in HTTP URI"; flow:to_server,established; content:"%25"; http_raw_uri; content:"%25"; http_raw_uri; distance:0; within:4; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2610292; rev:1;)
#alert http any any -> any any (msg:"TGI HUNT Double Encoded Characters in HTTP POST"; flow:to_server,established; content:"%2525"; nocase; http_client_body; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2610294; rev:1;)
alert http any any -> any any (msg:"TGI HUNT Serialized PHP inbound"; flow:established,to_server; content:"O|3a|"; pcre:"/\bO\x3a\d+\x3a[^\r\n]*?\{/i"; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2610296; rev:1;)
#alert http any any -> any any (msg:"TGI HUNT Double Encoded Characters in URI <>"; flow:to_server,established; content:"%253C"; nocase; http_raw_uri; content:"%253E"; nocase; http_raw_uri; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2610298; rev:1;)
#alert http any any -> any any (msg:"TGI HUNT Double Encoded Characters in URI x28 x29"; flow:to_server,established; content:"%2528"; nocase; http_raw_uri; content:"%2529"; nocase; http_raw_uri;threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2610300; rev:1;)
#alert http any any -> any any (msg:"TGI HUNT Double Encoded Characters in URI x3a"; flow:to_server,established; content:"%253A"; nocase; http_raw_uri; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2610302; rev:1;)
#alert http any any -> any any (msg:"TGI HUNT Double Encoded Characters in URI x3b"; flow:to_server,established; content:"%253B"; nocase; http_raw_uri; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2610304; rev:1;)
#alert http any any -> any any (msg:"TGI HUNT Suspicous HTTP URI and Referer are the same"; flow:established,to_server; content:"GET "; depth:4; pcre:"/^\/(.+) HTTP.*Referer[^\r\n]+\1\r\n/Rs"; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2610306; rev:1;)
alert http any any -> any any (msg:"TGI HUNT Double Transfer-Encoding Header (possible evasion)"; flow:established,to_server; content:"Transfer-Encoding|3a 20|"; http_header; fast_pattern; content:"Transfer-Encoding|3a 20|"; http_header; distance:0; reference:url,noxxi.de/research/http-evader-explained-3-chunked.html; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2610308; rev:1;)
alert http any any -> any any (msg:"TGI HUNT HTTP/1.0 and Transfer-Encoding Header (possible evasion)"; flow:established,to_server; content:"Transfer-Encoding|3a 20|"; http_header; fast_pattern; content:"HTTP/1.0"; depth:8; reference:url,noxxi.de/research/http-evader-explained-3-chunked.html; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2610310; rev:1;)
alert http any any -> any any (msg:"TGI HUNT HTTP POST to wp-.* without referer"; flow:established,to_server; content:"POST"; http_method; content:"/wp-"; http_uri; http_header_names; content:!"Referer"; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown;sid:2610312; rev:1;)
#alert tcp $EXTERNAL_NET any -> any any (msg:"TGI HUNT Oracle Server Probe"; flow:to_server,established; content:"(DESCRIPTION=(CONNECT_DATA=(SID=";threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2610314; rev:1;)
alert tls any any -> any any (msg:"TGI HUNT BurpSuite string in TLS"; flow:established; content:"|0b|PortSwigger"; distance:1; within:12; reference:url,portswigger.net/burp/proxy.html; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2610316; rev:1;)
alert tcp any any -> any [25,587] (msg:"TGI HUNT suspicious x-library Indy"; flow:established,to_server; content:"|0d 0a|X-Library|3a| Indy|20|"; nocase; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2610318; rev:6;)
# alert tcp any any -> any [25,587] (msg:"TGI HUNT suspicious x-mailer MS CDO"; flow:established; content:"X-Mailer|3a 20|Microsoft CDO for Windows"; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2610320; rev:6;)
alert tcp any any -> any [25,587] (msg:"TGI HUNT suspicious x-mailer Blat"; flow:established; content:"X-Mailer|3a 20|Blat v"; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2610322; rev:6;)
#alert tcp-pkt any any -> any any (msg:"TGI HUNT Too many \x41"; flow:established; content:"|41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41|"; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2610324; rev:1;)
#alert tcp-pkt any any -> any any (msg:"TGI HUNT Too many \x90"; flow:established; content:"|90 90 90 90 90 90 90 90 90 90 90 90 90 90 90 90 90 90 90 90 90 90 90 90 90 90 90 90 90 90 90 90|"; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2610326; rev:1;)
#alert dns any any -> any any (msg:"TGI HUNT WPAD Request"; dns_query; content:"wpad"; nocase; startswith; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2610328; rev:1;)
alert tcp any any -> any any (msg:"TGI HUNT netsh firewall"; flow:established; content:"netsh firewall"; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2610330; rev:1;)
alert tcp any any -> any any (msg:"TGI HUNT netsh advfirewall"; flow:established; content:"netsh advfirewall"; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2610332; rev:1;)

alert tcp any any -> any any (msg:"TGI HUNT WMIC Prompt"; flow:established; content:"wmic|3a|root|5c|cli>"; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2610336; rev:1;)
alert tcp any any -> any any (msg:"TGI HUNT sc output"; flow:established; content:"SERVICE_NAME|3a|"; content:"TYPE"; distance:0; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2610338; rev:1;)
alert tcp any any -> any any (msg:"TGI HUNT Unknown Login Attempt"; flow:established; content:"Action|3a 20|Login"; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2610340; rev:1;)
#alert http any any -> any any (msg:"TGI HUNT non printable char in HTTP Header"; flow:established,to_server; pcre:"/^[\x20-\x7e\r\n]{0,20}[^\x20-\x7e\r\n]/H"; http_content_type; content:!"application/ocsp-response"; threshold:type limit, track by_src, seconds 180, count 1; classtype:bad-unknown; sid:2610342; rev:1;)
#alert http any any -> any any (msg:"TGI HUNT fromcharcode in HTTP"; flow:established; content:!"jQuery Foundation, Inc"; content:"fromcharcode"; nocase; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2610344; rev:1;)
alert http any any -> any any (msg:"TGI HUNT PHP magic bytes in HTTP response"; flow:established,to_client; content:"<?php"; nocase; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2610346; rev:1;)
alert http any any -> any any (msg:"TGI HUNT SQL verb in HTTP"; flow:established,to_server; content:"DELETE"; http_header; content:"FROM"; http_header; distance:0; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2610348; rev:1;)
alert http any any -> any any (msg:"TGI HUNT SQL verb in HTTP"; flow:established,to_server; content:"EXEC"; http_header; content:"FROM"; http_header; distance:0; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2610350; rev:1;)
alert http any any -> any any (msg:"TGI HUNT SQL verb in HTTP"; flow:established,to_server; content:"INSERT"; http_header; content:"INTO"; http_header; distance:0; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2610352; rev:1;)
alert http any any -> any any (msg:"TGI HUNT SQL verb in HTTP"; flow:established,to_server; content:"SELECT"; http_header; pcre:"/\b(?:INTO|FROM|USER|UPPER|LOWER|CONCAT)\b/RH";threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2610354; rev:1;)
alert http any any -> any any (msg:"TGI HUNT SQL verb in HTTP"; flow:established,to_server; content:"SHOW"; http_header;  pcre:"/\b(?:CHAR|CUR|TABLE|VAR)/RH";threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2610356; rev:1;)
alert http any any -> any any (msg:"TGI HUNT SQL verb in HTTP"; flow:established,to_server; content:"UNION"; http_header; content:"SELECT"; http_header; distance:0; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2610358; rev:1;)
alert http any any -> any any (msg:"TGI HUNT SQL verb in HTTP"; flow:established,to_server; content:"UPDATE"; http_header; content:"SET"; http_header; distance:0; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2610360; rev:1;)
#alert http any any -> !$HOME_NET any (msg:"TGI HUNT HTTP uncommon version Request"; flow:established,to_server; content:"|20|HTTP/"; content:!"1.1"; within:3; content:!"1.0"; within:3; flowbits:isnotset,hunt.entrust_entelligence; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2610362; rev:1;)
#alert http any any -> any any (msg:"TGI HUNT HTTP suspicious UA"; flow:established; content:"bot"; nocase; http_user_agent; content:!"YandexBot/"; http_user_agent; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2610364; rev:1;)
#alert http any any -> any any (msg:"TGI HUNT HTTP uncommon version Response"; flow:established,to_client; content:"HTTP/"; depth:5; content:!"1.1"; within:3; content:!"1.0"; within:3; flowbits:isnotset,hunt.entrust_entelligence; content:!"BigIP"; http_header; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2610366; rev:1;)
alert http any any -> any any (msg:"TGI HUNT WScript.Shell Inbound"; flow:established,to_client; file_data; content:"WScript.Shell"; nocase; classtype:bad-unknown; sid:2610368; rev:1;)
alert http any any -> any any (msg:"TGI HUNT .bin HTTP download missing headers"; flow:established,to_server; content:".bin"; http_uri; endswith; http_header_names; content:"|0d 0a|Host|0d 0a|Connection|0d 0a 0d 0a|"; classtype:bad-unknown; sid:2610370; rev:1;)
alert tcp any any -> any any (msg:"TGI HUNT wmic process call create"; flow:established; content:"wmic process call create"; classtype:bad-unknown; sid:2610372; rev:1;)
alert tcp any any -> any any (msg:"IBM WebSphere Application Server probe"; flow:established; content:"SOAPAction: urn:AdminService|0d 0a|"; http_header; reference:url,github.com/breenmachine/JavaUnserializeExploits/blob/master/websphere-soap-exploit.request; classtype:bad-unknown; sid:2610374; rev:1;)
#alert ftp any any -> any any (msg:"TGI HUNT FTP STOR Command"; flow:established; content:"STOR|20|"; classtype:bad-unknown; sid:2610376; rev:1;)
alert http any any -> any any (msg:"TGI HUNT PHP Magic Bytes in HTTP Request"; flow:established,to_server; content:"<?php"; nocase; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2610378; rev:1;)
#alert http any any -> any any (msg:"TGI HUNT POST Without Referer Header"; flow:established,to_server; content:"POST"; http_method; http_header_names; content:!"Referer"; threshold:type limit, track by_src, seconds 180, count 1; http_content_type; content:!"application/ocsp-response"; classtype:bad-unknown; sid:2610380; rev:1;)
alert ip any any -> any any (msg:"TGI HUNT sameip Keyword Test Rule"; flow:established,to_server; sameip; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2610382; rev:1;)
#alert tls any any -> any any (msg:"TGI HUNT TLS Suspicious facebook.com"; tls_cert_subject; content:"facebook.com"; tls_cert_fingerprint; content:!"98:e4:dd:9d:21:83:d5:29:9e:80:43:73:ff:f2:a7:e1:c4:87:9f:5e"; classtype:bad-unknown; sid:2610384; rev:1;)
alert http any any -> any any (msg:"TGI HUNT Content-Type jpeg Serving Zip"; flow:established,from_server; content:"200"; http_stat_code; content:"Content-Type|3a 20|image/jpeg"; http_header; file_data; content:"PK"; depth:2; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2610386; rev:1;)
alert http any any -> any any (msg:"TGI HUNT Suspicious vbs Function Inbound"; flow:established,from_server; content:"200"; http_stat_code; file_data; content:"new-object -com|20|"; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2610388; rev:1;)
alert udp $HOME_NET any -> any 53 (msg:"TGI HUNT Large DNS Query not TCP"; content:"|01 00 00 01 00 00 00 00 00 00|"; fast_pattern; depth:10; offset:2; dsize:>512; classtype:bad-unknown; sid:2610390; rev:8;)
# turns out double encoded characters are quite common in redirect urls
#alert http any any -> any any (msg:"TGI HUNT Double Encoded Characters in HTTP URI"; flow:to_server,established; content:"%2525"; http_uri; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2610394; rev:1;)
alert http any any -> any any (msg:"TGI HUNT Suspicious HTTP Path"; flow:to_server,established; content:"/Panel/"; http_uri; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2610396; rev:1;)
alert http any any -> any any (msg:"TGI HUNT Suspicious HTTP Server Response (localhost)"; flow:to_client,established; content:"Server|3a 20|localhost|0d 0a|"; http_header; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2610398; rev:1;)
#alert ip any any -> any any (msg:"TGI HUNT non-DiffServ aware TOS setting"; flow:established,to_server; tos:!0; tos:!8; tos:!16; tos:!24; tos:!32; tos:!40; tos:!48; tos:!56; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2610400; rev:1;)
alert http any any -> any any (msg:"TGI HUNT MimiKatz String in HTTP Response"; flow:to_client,established; file_data; content:"There's been an awakening... have you felt it?"; threshold:type limit,track by_src,seconds 60,count 1; classtype:bad-unknown; sid:2610402; rev:1;)
alert http any any -> any any (msg:"TGI HUNT MimiKatz String in HTTP Response x86 1"; flow:to_client,established; file_data; content:"|89 71 04 89|"; content:"|30 8d 04 bd|"; within:8; threshold:type limit,track by_src,seconds 60,count 1; reference:url,github.com/gentilkiwi/mimikatz/releases; classtype:bad-unknown; sid:2610404; rev:1;)
alert http any any -> any any (msg:"TGI HUNT MimiKatz String in HTTP Response x86 2"; flow:to_client,established; file_data; content:"|8b 4d|"; content:"|8b 45 f4 89 75|"; within:6; content:"|89 01 85 ff 74|"; within:6; threshold:type limit,track by_src,seconds 60,count 1; reference:url,github.com/gentilkiwi/mimikatz/releases; classtype:bad-unknown; sid:2610406; rev:1;)
alert http any any -> any any (msg:"TGI HUNT MimiKatz String in HTTP Response x64 1"; flow:to_client,established; file_data; content:"|33 ff|"; content:"|89 37|"; within:3; content:"|8b f3 45 85|"; within:5; content:"|74|"; within:2; threshold:type limit,track by_src,seconds 60,count 1; reference:url,github.com/gentilkiwi/mimikatz/releases; classtype:bad-unknown; sid:2610408; rev:1;)
alert http any any -> any any (msg:"TGI HUNT MimiKatz String in HTTP Response x64 2"; flow:to_client,established; file_data; content:"|4c 8b df 49|"; content:"|c1 e3 04 48|"; within:8; content:"|8b cb 4c 03|"; within:8; content:"|d8|"; within:2; threshold:type limit,track by_src,seconds 60,count 1; reference:url,github.com/gentilkiwi/mimikatz/releases; classtype:bad-unknown; sid:2610410; rev:1;)
alert http any any -> any any (msg:"TGI HUNT LaZagne Artifact in HTTP POST"; flow:to_server,established; content:"LaZagne Project"; http_client_body; classtype:bad-unknown; sid:2610412; rev:1;)
alert http any any -> any any (msg:"TGI HUNT LaZagne Artifact in HTTP POST 2"; flow:to_server,established; content:"|20|passwords -----------------"; http_client_body; classtype:bad-unknown; sid:2610414; rev:1;)
#alert tls any any -> any any (msg:"TGI HUNT DNS over TLS JA3 SSL-Client Fingerprint Detected (Stubby)"; ja3_hash; content:"c369db2c355ad05c76f5660af3179b01"; reference:url,www.linuxbabe.com/ubuntu/ubuntu-stubby-dns-over-tls; sid:2610416; rev:1;)
# too common to be useful
#alert tls any any -> any any (msg:"TGI HUNT JA3 SSL-Client Fingerprint Detected (Emotet/AutoIt/Ursnif)"; ja3_hash; content:"4d7a28d6f2263ed61de88ca66eb011e3"; reference:url,engineering.salesforce.com/tls-fingerprinting-with-ja3-and-ja3s-247362855967; sid:2610420; rev:1;)
#alert tls any any -> any any (msg:"TGI HUNT JA3 SSL-Client Fingerprint Detected (Trickbot)"; ja3_hash; content:"6734f37431670b3ab4292b8f60f29984"; reference:url,engineering.salesforce.com/tls-fingerprinting-with-ja3-and-ja3s-247362855967; sid:2610422; rev:1;)
#alert tls any any -> any any (msg:"TGI HUNT JA3 SSL-Client Fingerprint Detected (Trickbot)"; ja3_hash; content:"e7d705a3286e19ea42f587b344ee6865"; reference:url,engineering.salesforce.com/tls-fingerprinting-with-ja3-and-ja3s-247362855967; sid:2610424; rev:1;)
alert http any any -> any any (msg:"TGI HUNT mimikatz Artifacts in HTTP POST"; flow:to_server,established; content:"S-1-5-21-"; fast_pattern; nocase; http_client_body; content:"Username"; nocase; http_client_body; content:"Domain"; nocase; http_client_body; content:"NTLM"; nocase; http_client_body; content:"SHA1"; nocase; http_client_body; classtype:bad-unknown; sid:2610426; rev:2;)
alert http any any -> any any (msg:"TGI HUNT Invoke-ReflectivePEInjection Likely Malicious PS Inbound"; flow:from_server,established; content:"Write-BytesToMemory"; content:"Invoke-CreateRemoteThread"; content:"VirtualAllocEx"; content:"WriteProcessMemory"; classtype:bad-unknown; sid:2610428; rev:1;)
alert http any any -> any any (msg:"TGI HUNT Non Browser HTTP to Pastebin"; flow:to_server,established; content:"pastebin.com"; http_host; content:!"Mozilla"; nocase; http_user_agent; classtype:bad-unknown; sid:2610430; rev:1;)
# too common to be useful
#alert tls any any -> any any (msg:"TGI HUNT JA3 SSL-Client Fingerprint Detected (IcedID/Orcus/.net WebClient().DownloadString()/js.griffon/WinHttpConnect)"; ja3_hash; content:"1d095e68489d3c535297cd8dffb06cb9"; reference:md5,de3ea56487dd2ebfcc5cb4d430aa51a9; sid:2610434; rev:1;)
#alert tls any any -> any any (msg:"TGI HUNT JA3 SSL-Client Fingerprint Detected (GoldenAxe Ransomware)"; ja3_hash; content:"5001b4c2a48c94b76ca1f0199345fe60"; reference:md5,87c1b3e2b788dd54d196fb67ba0da6dc; sid:2610436; rev:1;)
alert http any any -> any any (msg:"TGI HUNT directory traversal chars in HTTP Request Header"; flow:established,to_server; content:"|2e 2e 5c|"; http_header; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2610438; rev:1;)
alert http any any -> any any (msg:"TGI HUNT directory traversal chars in HTTP Request Header"; flow:established,to_server; content:"|2e 2e 2f|"; http_header; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2610440; rev:1;)
alert ftp-data $HOME_NET any -> $EXTERNAL_NET any (msg:"TGI HUNT Password Artifact Outbound in FTP"; flow:established,to_server; content:"Password"; fast_pattern; pcre:"/\bPassword\b/"; reference:url,github.com/AlessandroZ/LaZagne; classtype:trojan-activity; sid:2610442; rev:1;)
alert ftp $HOME_NET any -> $EXTERNAL_NET any (msg:"TGI HUNT Cookie STOR Outbound in FTP"; flow:established,to_server; content:"STOR|20|"; depth:5; content:"cookies"; nocase; distance:0; fast_pattern; pcre:"/\bcookies\b/i"; classtype:trojan-activity; sid:2610444; rev:1;)
alert ftp $HOME_NET any -> $EXTERNAL_NET any (msg:"TGI HUNT log STOR Outbound in FTP"; flow:established,to_server; content:"STOR|20|"; depth:5; content:"log"; nocase; distance:0; fast_pattern; pcre:"/\blog\b/i"; classtype:trojan-activity; sid:2610446; rev:1;)
alert dns $HOME_NET any -> $EXTERNAL_NET any (msg:"TGI HUNT CobaltStrike Artifact in DNS"; flow:established,to_server; dns_query; content:".stage.123456."; reference:url,threatexpress.com/blogs/2018/a-deep-dive-into-cobalt-strike-malleable-c2/; classtype:trojan-activity; sid:2610448; rev:1;)
alert dns $HOME_NET any -> $EXTERNAL_NET any (msg:"TGI HUNT CobaltStrike Artifact in DNS"; flow:established,to_server; dns_query; content:".resources.123456."; reference:url,threatexpress.com/blogs/2018/a-deep-dive-into-cobalt-strike-malleable-c2/; classtype:trojan-activity; sid:2610450; rev:1;)
alert dns $HOME_NET any -> $EXTERNAL_NET any (msg:"TGI HUNT CobaltStrike Artifact in DNS"; flow:established,to_server; dns_query; content:".feeds.123456."; reference:url,threatexpress.com/blogs/2018/a-deep-dive-into-cobalt-strike-malleable-c2/; classtype:trojan-activity; sid:2610452; rev:1;)
alert udp $HOME_NET any -> $EXTERNAL_NET any (msg:"TGI HUNT Anomalous DNS >512 bytes over UDP"; dsize:>512; prefilter; content:"|01 00 00 01 00 00 00 00 00 00|"; offset:2; depth:10; reference:url,tools.ietf.org/html/rfc5966; classtype:trojan-activity; sid:2610454; rev:1;)
alert tcp-pkt any any -> any any (msg:"TGI HUNT abnormally long STOR in FTP"; flow:established,to_server; content:"STOR|20|"; depth:5; isdataat:256,relative; classtype:bad-unknown; sid:2610456; rev:1;)
alert ftp any any -> any any (msg:"TGI HUNT abnormally long SIZE in FTP"; flow:established,to_server; content:"SIZE"; depth:4; isdataat:256,relative; classtype:bad-unknown; sid:2610458; rev:1;)
alert http any any -> any any (msg:"TGI HUNT Frequently Abused Java Invocation in HTTP POST Body"; flow:established,to_server; content:"java.lang.ProcessBuilder"; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; reference:url,blog.talosintelligence.com/2019/04/sodinokibi-ransomware-exploits-weblogic.html; sid:2610460; rev:1;)
alert http any any -> any any (msg:"TGI HUNT Suspicious Filename Powershell Download"; flow:established,to_server; content:"GET"; http_method; content:".ps1"; http_uri; endswith; fast_pattern; pcre:"/(?:keylogger|rat|stealer|remote)[^/]*\.ps1$/Ui"; http_header_names; content:!"Referer"; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2610462; rev:1;)
alert http any any -> any any (msg:"TGI HUNT .hta File in Referer"; flow:established,to_server; http_referer; content:".hta"; endswith; fast_pattern; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2610464; rev:1;)
alert ip any any -> $HOME_NET any (msg:"TGI HUNT PowerShell Execution String Base64 Encoded Invoke-Command (52b2tlLUNvbW1hbm)"; flow:established; content:"52b2tlLUNvbW1hbm"; reference:url,github.com/no0be/DNSlivery; threshold:type limit, track by_src, seconds 60, count 1; classtype:attempted-admin; sid:2610466; rev:2;)
alert ip any any -> $HOME_NET any (msg:"TGI HUNT PowerShell Execution String Base64 Encoded Invoke-Command (52b2tlLUNvbW1)"; flow:established; content:"52b2tlLUNvbW1"; reference:url,github.com/no0be/DNSlivery; threshold:type limit, track by_src, seconds 60, count 1; classtype:attempted-admin; sid:2610468; rev:2;)
alert ip any any -> $HOME_NET any (msg:"TGI HUNT PowerShell Execution String Base64 Encoded Invoke-Command (dm9rZS1Db21)"; flow:established; content:"dm9rZS1Db21";reference:url,github.com/no0be/DNSlivery; threshold:type limit, track by_src, seconds 60, count 1; classtype:attempted-admin; sid:2610470; rev:1;)
alert ip any any -> $HOME_NET any (msg:"TGI HUNT PowerShell Execution String Base64 Encoded Invoke-Command (dm9rZS1Db21tYW)"; flow:established; content:"dm9rZS1Db21tYW";reference:url,github.com/no0be/DNSlivery; threshold:type limit, track by_src, seconds 60, count 1; classtype:attempted-admin; sid:2610472; rev:1;)
alert ip any any -> $HOME_NET any (msg:"TGI HUNT PowerShell Execution String Base64 Encoded Invoke-Command (nZva2UtQ29tbW)"; flow:established; content:"nZva2UtQ29tbW";reference:url,github.com/no0be/DNSlivery; threshold:type limit, track by_src, seconds 60, count 1; classtype:attempted-admin; sid:2610474; rev:1;)
alert ip any any -> $HOME_NET any (msg:"TGI HUNT PowerShell Execution String Base64 Encoded Invoke-Command (Zva2UtQ29)"; flow:established; content:"Zva2UtQ29";reference:url,github.com/no0be/DNSlivery; threshold:type limit, track by_src, seconds 60, count 1; classtype:attempted-admin; sid:2610476; rev:1;)
alert ip any any -> $HOME_NET any (msg:"TGI HUNT PowerShell Execution String Base64 Encoded Invoke-WmiMethod (52b2tlLVdtaU1)"; flow:established; content:"52b2tlLVdtaU1";reference:url,github.com/no0be/DNSlivery; threshold:type limit, track by_src, seconds 60, count 1; classtype:attempted-admin; sid:2610478; rev:1;)
alert ip any any -> $HOME_NET any (msg:"TGI HUNT PowerShell Execution String Base64 Encoded Invoke-WmiMethod (52b2tlLVdtaU1ldG)"; flow:established; content:"52b2tlLVdtaU1ldG";reference:url,github.com/no0be/DNSlivery; threshold:type limit, track by_src, seconds 60, count 1; classtype:attempted-admin; sid:2610480; rev:1;)
alert ip any any -> $HOME_NET any (msg:"TGI HUNT PowerShell Execution String Base64 Encoded Invoke-WmiMethod (dm9rZS1XbWlNZXR)"; flow:established; content:"dm9rZS1XbWlNZXR";reference:url,github.com/no0be/DNSlivery; threshold:type limit, track by_src, seconds 60, count 1; classtype:attempted-admin; sid:2610482; rev:1;)
alert ip any any -> $HOME_NET any (msg:"TGI HUNT PowerShell Execution String Base64 Encoded Invoke-WmiMethod (dm9rZS1XbWlNZXRob2)"; flow:established; content:"dm9rZS1XbWlNZXRob2";reference:url,github.com/no0be/DNSlivery; threshold:type limit, track by_src, seconds 60, count 1; classtype:attempted-admin; sid:2610484; rev:1;)
alert ip any any -> $HOME_NET any (msg:"TGI HUNT PowerShell Execution String Base64 Encoded Invoke-WmiMethod (nZva2UtV21pTWV0aG)"; flow:established; content:"nZva2UtV21pTWV0aG";reference:url,github.com/no0be/DNSlivery; threshold:type limit, track by_src, seconds 60, count 1; classtype:attempted-admin; sid:2610486; rev:1;)
alert ip any any -> $HOME_NET any (msg:"TGI HUNT PowerShell Execution String Base64 Encoded Invoke-WmiMethod (Zva2UtV21pTWV)"; flow:established; content:"Zva2UtV21pTWV";reference:url,github.com/no0be/DNSlivery; threshold:type limit, track by_src, seconds 60, count 1; classtype:attempted-admin; sid:2610488; rev:1;)
alert ip any any -> $HOME_NET any (msg:"TGI HUNT PowerShell Execution String Base64 Encoded New-Object (ctT2J)"; flow:established; content:"ctT2J"; distance:0; reference:url,github.com/no0be/DNSlivery; threshold:type limit, track by_src, seconds 60, count 1; classtype:attempted-admin; sid:2610490; rev:1;)
alert ip any any -> $HOME_NET any (msg:"TGI HUNT PowerShell Execution String Base64 Encoded New-Object (dy1PYmp)"; flow:established; content:"dy1PYmp"; distance:0; reference:url,github.com/no0be/DNSlivery; threshold:type limit, track by_src, seconds 60, count 1; classtype:attempted-admin; sid:2610492; rev:1;)
alert ip any any -> $HOME_NET any (msg:"TGI HUNT PowerShell Execution String Base64 Encoded New-Object (dy1PYmplY3)"; flow:established; content:"dy1PYmplY3";reference:url,github.com/no0be/DNSlivery; threshold:type limit, track by_src, seconds 60, count 1; classtype:attempted-admin; sid:2610494; rev:1;)
alert ip any any -> $HOME_NET any (msg:"TGI HUNT PowerShell Execution String Base64 Encoded New-Object (V3LU9iam)"; flow:established; content:"V3LU9iam"; distance:0; reference:url,github.com/no0be/DNSlivery; threshold:type limit, track by_src, seconds 60, count 1; classtype:attempted-admin; sid:2610496; rev:1;)
alert ip any any -> $HOME_NET any (msg:"TGI HUNT PowerShell Execution String Base64 Encoded New-Object (V3LU9)"; flow:established; content:"V3LU9"; distance:0; reference:url,github.com/no0be/DNSlivery; threshold:type limit, track by_src, seconds 60, count 1; classtype:attempted-admin; sid:2610498; rev:1;)
alert ip any any -> $HOME_NET any (msg:"TGI HUNT PowerShell Execution String Base64 Encoded New-Object (XctT2JqZW)"; flow:established; content:"XctT2JqZW"; distance:0; reference:url,github.com/no0be/DNSlivery; threshold:type limit, track by_src, seconds 60, count 1; classtype:attempted-admin; sid:2610500; rev:1;)
alert ip any any -> $HOME_NET any (msg:"TGI HUNT PowerShell Execution String Base64 Encoded Start-Process (FydC1Qcm9)"; flow:established; content:"FydC1Qcm9";reference:url,github.com/no0be/DNSlivery; threshold:type limit, track by_src, seconds 60, count 1; classtype:attempted-admin; sid:2610502; rev:1;)
alert ip any any -> $HOME_NET any (msg:"TGI HUNT PowerShell Execution String Base64 Encoded Start-Process (GFydC1Qcm9jZX)"; flow:established; content:"GFydC1Qcm9jZX";reference:url,github.com/no0be/DNSlivery; threshold:type limit, track by_src, seconds 60, count 1; classtype:attempted-admin; sid:2610504; rev:1;)
alert ip any any -> $HOME_NET any (msg:"TGI HUNT PowerShell Execution String Base64 Encoded Start-Process (RhcnQtUHJ)"; flow:established; content:"RhcnQtUHJ";reference:url,github.com/no0be/DNSlivery; threshold:type limit, track by_src, seconds 60, count 1; classtype:attempted-admin; sid:2610506; rev:2; metadata:attack_target Client_Endpoint, deployment Perimeter, signature_severity Major, created_at 2019_02_19, malware_family DNSlivery, updated_at 2019_02_19;)
alert ip any any -> $HOME_NET any (msg:"TGI HUNT PowerShell Execution String Base64 Encoded Start-Process (RhcnQtUHJvY2)"; flow:established; content:"RhcnQtUHJvY2";reference:url,github.com/no0be/DNSlivery; threshold:type limit, track by_src, seconds 60, count 1; classtype:attempted-admin; sid:2610508; rev:1;)
alert ip any any -> $HOME_NET any (msg:"TGI HUNT PowerShell Execution String Base64 Encoded Start-Process (YXJ0LVByb2N)"; flow:established; content:"YXJ0LVByb2N";reference:url,github.com/no0be/DNSlivery; threshold:type limit, track by_src, seconds 60, count 1; classtype:attempted-admin; sid:2610510; rev:1;)
alert ip any any -> $HOME_NET any (msg:"TGI HUNT PowerShell Execution String Base64 Encoded Start-Process (YXJ0LVByb2Nlc3)"; flow:established; content:"YXJ0LVByb2Nlc3";reference:url,github.com/no0be/DNSlivery; threshold:type limit, track by_src, seconds 60, count 1; classtype:attempted-admin; sid:2610512; rev:1;)
alert tcp any any -> $HOME_NET 3389 (msg:"TGI HUNT Likely MSF BlueKeep Auxilliary Scan Inbound"; flow:established; content:"|03 00 00|"; depth:3; content:"Cookie="; distance:0; content:"|0d 0a|"; distance:5; within:2; content:"|00 00 00 00|"; distance:5; endswith; reference:url,medium.com/@bromiley/what-happens-before-hello-ce9f29fa0cef; threshold:type limit, track by_src, seconds 60, count 1; classtype:attempted-admin; sid:2610514; rev:1;)
alert tcp any any -> $HOME_NET 3389 (msg:"TGI HUNT Likely RDPScan Scan Inbound"; flow:established; content:"|03 00 00|"; depth:3; content:"Cookie="; distance:0; content:"|0d 0a|"; distance:8; within:2; content:"|01 00 00 00|"; distance:5; endswith; reference:url,medium.com/@bromiley/what-happens-before-hello-ce9f29fa0cef; threshold:type limit, track by_src, seconds 60, count 1; classtype:attempted-admin; sid:2610516; rev:1;)
alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"TGI HUNT Possible Cobalt Strike Malleable C2 Null Response (Flowbit Set)"; flow:established,to_server; content:"!microsoft.com"; http_host; endswith; http_header_names; content:!"Referer"; content:"Cookie"; flowbits:set,hunt.cs_null_response; flowbits:noalert; threshold:type limit, track by_src, seconds 60, count 1; classtype:trojan-activity; sid:2610518; rev:1;)
alert http $EXTERNAL_NET any -> $HOME_NET any (msg:"TGI HUNT Possible Cobalt Strike Malleable C2 Null Response"; flow:established,to_client; content:"200"; http_stat_code; depth:3; content:"Content-Length:|20|0|0d 0a|"; fast_pattern; flowbits:isset,hunt.cs_null_response; threshold:type limit, track by_src, seconds 60, count 1; classtype:trojan-activity; sid:2610520; rev:1;)
alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"TGI HUNT Entrust Entelligence Security Provider (Flowbits Set)"; flow:established,to_server; content:"Entrust Entelligence Security Provider"; http_user_agent; flowbits:set,hunt.entrust_entelligence; flowbits:noalert; threshold:type limit, track by_src, seconds 60, count 1; reference:url,www.entrustdatacard.com/products/pki/entrust-entelligence-security-provider; classtype:trojan-activity; sid:2610522; rev:1;)
alert http $EXTERNAL_NET any -> $HOME_NET any (msg:"TGI HUNT Possible Cobalt Strike Extra Whitespace HTTP Response"; flow:established,to_client; content:"HTTP/1.1|20|200|20|OK|20 0d 0a|Content-Type|3a|"; flowbits:isnotset,hunt.entrust_entelligence; content:!"WEBrick"; http_header; reference:url,github.com/fox-it/cobaltstrike-extraneous-space; threshold:type limit, track by_src, seconds 60, count 1; classtype:trojan-activity; sid:2610524; rev:3;)
alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"TGI HUNT Cobalt Strike C2 Meterpreter Profile Artifact"; flow:established,to_server; content:"UMJjAiNUUtvNww0lBj9tzWegwphuIn6hNP9eeIDfOrcHJ3nozYFPT-Jl7WsmbmjZnQXUesoJkcJkpdYEdqgQFE6QZgjWVsLSSDonL28DYDVJ"; reference:url,github.com/rsmudge/Malleable-C2-Profiles/blob/master/APT/meterpreter.profile; classtype:trojan-activity; sid:2610526; rev:1;)
alert tls any any -> any [465,25,587] (msg:"TGI HUNT Suspicious Null in TLS SNI"; tls_sni; content:"|00|"; flow:established,to_server; ssl_state:client_hello; classtype:attempted-admin; sid:2610528; rev:1;)
alert dns any any -> any any (msg:"TGI HUNT honeytokens.org in DNS"; flow:established; dns_query; content:"honeytokens.org"; endswith; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2610530; rev:1;)
alert http any any -> any any (msg:"TGI HUNT honeytokens.org in HTTP Host"; flow:established; content:"honeytokens.org"; http_host; endswith; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2610532; rev:1;)
alert tls any any -> any any (msg:"TGI HUNT honeytokens.org in SNI"; flow:established,to_server; tls_sni; content:"honeytokens.org"; endswith; classtype:bad-unknown; sid:2610534;)
alert tcp any any -> $HOME_NET any (msg:"TGI HUNT PS Execution Policy Registry Key Name in B64"; content:"SEtFWV9MT0NBTF9NQUNISU5FXFNvZnR3YXJlXFBvbGljaWVzXE1pY3Jvc29mdFxXaW5kb3dzXFBvd2VyU2hlbGxc"; classtype:attempted-user; sid:2610536; rev:1;)
alert tcp any any -> $HOME_NET any (msg:"TGI HUNT PS Execution Policy Registry Key Name in B64"; content:"hLRVlfTE9DQUxfTUFDSElORVxTb2Z0d2FyZVxQb2xpY2llc1xNaWNyb3NvZnRcV2luZG93c1xQb3dlclNoZWxsX"; classtype:attempted-user; sid:2610538; rev:1;)
alert tcp any any -> $HOME_NET any (msg:"TGI HUNT PS Execution Policy Registry Key Name in B64"; content:"IS0VZX0xPQ0FMX01BQ0hJTkVcU29mdHdhcmVcUG9saWNpZXNcTWljcm9zb2Z0XFdpbmRvd3NcUG93ZXJTaGVsbF"; classtype:attempted-user; sid:2610540; rev:1;)
alert http $EXTERNAL_NET any -> $HOME_NET any (msg:"TGI HUNT gitrepo HTTP Probe"; flow:established,to_server; content:"/.git/HEAD"; http_uri; endswith; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2610542; rev:1;)
# Credit to Didier Stevens for all "DS" rules
alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"TGI HUNT DS Metasploit Meterpreter HTTP Checkin"; flow:to_server,established; content:"RECV"; http_client_body; depth:4; fast_pattern; isdataat:!0,relative; urilen:23<>24,norm; content:"POST"; http_method; pcre:"/^\/[a-z0-9]{4,5}_[a-z0-9]{16}\/$/Ui"; classtype:trojan-activity; reference:url,blog.didierstevens.com/2015/05/11/detecting-network-traffic-from-metasploits-meterpreter-reverse-http-module/; sid:2610546; rev:1;)
alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"TGI HUNT DS Metasploit User Agent String"; flow:to_server,established; content:"Mozilla/4.0 (compatible\; MSIE 6.1\; Windows NT)|0d 0a|"; http_user_agent; classtype:trojan-activity; reference:url,blog.didierstevens.com/2015/03/16/quickpost-metasploit-user-agent-strings/; sid:2610548; rev:1;)
alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"TGI HUNT DS Metasploit User Agent String"; flow:to_server,established; content:"Mozilla/4.0 (compatible\; MSIE 7.0\; Windows NT 6.0\; Trident/4.0\; SIMBAR={7DB0F6DE-8DE7-4841-9084-28FA914B0F2E}\; SLCC1\; .N|0d 0a|"; http_user_agent; classtype:trojan-activity; reference:url,blog.didierstevens.com/2015/03/16/quickpost-metasploit-user-agent-strings/; sid:2610550; rev:1;)
alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"TGI HUNT DS Metasploit User Agent String"; flow:to_server,established; content:"Mozilla/4.0 (compatible\; Metasploit RSPEC)|0d 0a|"; http_user_agent; classtype:trojan-activity; reference:url,blog.didierstevens.com/2015/03/16/quickpost-metasploit-user-agent-strings/; sid:2610552; rev:1;)
alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"TGI HUNT DS Metasploit User Agent String"; flow:to_server,established; content:"Mozilla/5.0 (compatible\; Googlebot/2.1\; +http://www.google.com/bot.html)|0d 0a|"; http_user_agent; classtype:trojan-activity; reference:url,blog.didierstevens.com/2015/03/16/quickpost-metasploit-user-agent-strings/; sid:2610554; rev:1;)
alert tls any any -> any any (msg:"TGI HUNT Dynamic DNS Domain in SNI"; flow:established,to_server; tls_sni; content:"duckdns.org"; endswith; classtype:bad-unknown; sid:2610556;)
alert tls $EXTERNAL_NET any -> $HOME_NET any (msg:"TGI HUNT Dynamic DNS Domain in Cert Subject"; flow:established,to_client; tls_cert_subject; content:"duckdns.org"; nocase; endswith; sid:2610558; rev:1;)

alert smtp any any -> $HOME_NET any (msg:"TGI HUNT SMB URI in Inbound SMTP"; flow:established; content:"smb://"; sid:2610562; rev:1;)

#alert smtp any any -> $HOME_NET any (msg:"TGI HUNT Office Doc Inbound"; flow:established; content:"0M8R4KGxGuE"; sid:2610566; rev:1;)

alert smtp any any -> $HOME_NET any (msg:"TGI HUNT Office Doc With Macro Inbound (VBAProject)"; flow:established; file_data; content:"VBAProject"; nocase; sid:2610570; rev:1;)
alert smtp any any -> $HOME_NET any (msg:"TGI HUNT Office Doc With Macro Inbound (ActiveMime)"; flow:established; file_data; content:"ActiveMime"; nocase; sid:2610572; rev:1;)
alert smtp any any -> $HOME_NET any (msg:"TGI HUNT Office Doc With Macro Inbound (_VBA_PROJECT_CUR)"; flow:established; file_data; content:"_VBA_PROJECT_CUR"; nocase; sid:2610574; rev:1;)
alert smtp any any -> $HOME_NET any (msg:"TGI HUNT Office Doc With Macro Inbound (Attribute VB_)"; flow:established; file_data; content:"Attribute VB_"; nocase; sid:2610576; rev:1;)

alert smb any any -> $HOME_NET any (msg:"TGI HUNT SMB Administrator Brute Force"; flow:to_server,established; content:"NTLMSSP|00|"; content:"A|00|d|00|m|00|i|00|n|00|i|00|s|00|t|00|r|00|a|00|t|00|o|00|r"; distance:0; threshold:type both, track by_src, seconds 60, count 5; classtype:bad-unknown; sid:2610580; rev:1;)

alert tcp any any -> $HOME_NET any (msg:"TGI HUNT Possiblly Malicious SP Name"; content:"sp_dropextendedproc"; flow:established; classtype:attempted-user; sid:2610584; rev:1;)

alert tcp any any -> $HOME_NET any (msg:"TGI HUNT Possiblly Malicious SP Name"; content:"sp_dropextendedproc"; flow:established; classtype:attempted-user; sid:2610588; rev:1;)

alert tcp any any -> $HOME_NET any (msg:"TGI HUNT Possiblly Malicious PyExe Import Name (impacket)"; flow:established; content:"impacket("; classtype:attempted-user; sid:2610592; rev:1;)

alert http any any -> any any (msg:"TGI HUNT CS4 Default User-Agent"; flow:established; content:"Mozilla/5.0 (compatible|3b| MSIE 9.0|3b| Windows NT 6.1|3b| Trident/5.0|3b| BOIE9|3b|ENAU)"; http_user_agent; endswith; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2610596; rev:1;)

alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"TGI HUNT Possible Excel Template Injection"; flow:to_server,established; content:".dotm?raw=true"; http_uri; fast_pattern; reference:url,twitter.com/jstrosch/status/1267471477458288642; classtype:trojan-activity; sid:2610600; rev:1;)

alert http $EXTERNAL_NET any -> $HOME_NET any (msg:"TGI HUNT Unencrypted HTTP Authorization Header Inbound"; flow:established,to_server; http.header; content:"Authorization|3a 20|Bearer"; sid:2610604; rev:1;)

alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"TGI HUNT Unencrypted HTTP Authorization Header Outbound"; flow:established,to_server; http.header; content:"Authorization|3a 20|Bearer"; sid:2610608; rev:1;)

alert ftp any any -> any any (msg:"TGI HUNT Possible FTP Exfil Flowbit Set"; flow:established,to_server; content:"/incoming/"; flowbits:set,ftp_exfil; flowbits:noalert; classtype:bad-unknown; sid:2610612; rev:1;)

alert ftp any any -> any any (msg:"TGI HUNT Possible FTP Exfil"; flow:established,to_server; content:"STOR"; flowbits:isset,ftp_exfil; classtype:bad-unknown; sid:2610616; rev:1;)

alert http $EXTERNAL_NET any -> $HOME_NET any (msg:"TGI HUNT Phishing Simulation HTTP Header Inbound"; flow:established,to_client; http.header; content:"Server|3a 20|ThreatSim-Web-Server|0d 0a|"; sid:2610620; rev:1;)

alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"TGI HUNT HTTP POST to Frequently Fronted Domain (CloudFront)"; flow:established,to_server; content:"POST"; http_method; content:".cloudfront.net"; http_host; fast_pattern; classtype:trojan-activity; sid:2610624; rev:1;)

alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"TGI HUNT HTTP POST to Frequently Fronted Domain (Azure)"; flow:established,to_server; content:"POST"; http_method; content:".azureedge.net"; http_host; fast_pattern; classtype:trojan-activity; sid:2610628; rev:1;)

alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"TGI HUNT HTTP POST to Frequently Fronted Domain (AWS)"; flow:established,to_server; content:"POST"; http_method; content:".awsstatic.com"; http_host; fast_pattern; classtype:trojan-activity; sid:2610632; rev:1;)

alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"TGI HUNT HTTP Request to 127.0.0.1"; flow:established,to_server; content:"127.0.0.1"; http_host; fast_pattern; classtype:trojan-activity; sid:2610636; rev:1;)

alert tcp any any -> $HOME_NET 23 (msg:"TGI HUNT Sudo Command in Telnet Traffic"; flow:established,to_server; content:"sudo|20|"; nocase; fast_pattern; pcre:"/\bsudo\b/i"; classtype:bad-unknown; sid:2610640; rev:1;)

alert http any any -> any any (msg:"TGI HUNT Suspicious Content Type"; flow:established,to_client; http_content_type; content:"application/x-sh"; endswith; reference:url,gist.github.com/travisbgreen/a24c4ea2e11cb53b03b9b327bf07cf89; classtype:bad-unknown; sid:2610644; rev:1;)

alert tls any any -> any any (msg:"TGI HUNT TLS Suspicious String in TLS Subject (metasploit)"; flow:established,to_client; content:"metasploit"; nocase; classtype:bad-unknown; sid:2610648; rev:1;)

alert http $HOME_NET any -> any any (msg:"TGI HUNT Possible Hafnium Webshell Access"; flow:established; http.uri; content:"/aspnet_client/"; fast_pattern; content:".asp"; classtype:bad-unknown; sid:2610652; rev:1;)

alert http $HOME_NET any -> any any (msg:"TGI HUNT eval( in HTTP URI"; flow:established; http.uri; content:"eval("; fast_pattern; classtype:bad-unknown; sid:2610656; rev:1;)

alert http $HOME_NET any -> any any (msg:"TGI HUNT eval( in HTTP Client Body"; flow:established; http.request_body; content:"eval("; fast_pattern; classtype:bad-unknown; sid:2610660; rev:1;)

#alert http $HOME_NET any -> any any (msg:"TGI HUNT eval( in HTTP Server Body"; flow:established; http.response_body; content:"eval("; fast_pattern; classtype:bad-unknown; sid:2610664; rev:1;)

alert tcp $EXTERNAL_NET any -> any any (msg:"TGI HUNT MS Copyright Banner Inbound"; flow:established; content:"Copyright |28|C|29|"; content:"Microsoft Corp"; distance:0; app-layer-protocol:!http; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2610668; rev:1;)

alert tcp any any -> $EXTERNAL_NET any (msg:"TGI HUNT MS Copyright Banner Outbound"; flow:established; content:"Copyright |28|C|29|"; content:"Microsoft Corp"; distance:0; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2610672; rev:1;)

alert http any any -> $HOME_NET any (msg:"TGI HUNT Exe File Served by Python SimpleHTTP Server"; flow:established,from_server; http.server; content:"SimpleHTTP/"; file_data; content:"MZ"; within:2; content:"PE|00 00|"; distance:0; classtype:attempted-admin; sid:2610676; rev:1;)

alert smb any any -> $HOME_NET any (msg:"TGI HUNT Suspicious ntds.dit Filename in SMB (ASCII)"; flow:established; content:"ntds.dit"; reference:url,stealthbits.com/blog/extracting-password-hashes-from-the-ntds-dit-file; classtype:bad-unknown; sid:2610680; rev:1;)

alert smb any any -> $HOME_NET any (msg:"TGI HUNT Suspicious ntds.dit Filename in SMB (UTF-16LE)"; flow:established; content:"n|00|t|00|d|00|s|00|.|00|d|00|i|00|t"; reference:url,stealthbits.com/blog/extracting-password-hashes-from-the-ntds-dit-file; classtype:bad-unknown; sid:2610684; rev:1;)

alert tcp any any -> $HOME_NET any (msg:"TGI HUNT ysoserial Payload Inbound"; flow:to_server,established; content:"ysoserial.payloads"; nocase; reference:url,github.com/foxglovesec/JavaUnserializeExploits; classtype:attempted-admin; sid:2610688; rev:1;)

alert http any any -> [$HOME_NET,$HTTP_SERVERS] any (msg:"TGI HUNT Unsafe Java Runtime Method Inbound"; flow:established,to_server; content:"getRuntime"; nocase; fast_pattern; content:"exec"; nocase; distance:0; pcre:"/\x2e\s*getRuntime\s*\x28\s*\x29\s*\.\s*exec\s*\x28/i"; reference:cve,2019-7238; reference:url,github.com/mpgn/CVE-2019-7238; classtype:attempted-admin; sid:2610692; rev:1;)

alert http $HOME_NET any -> any any (msg:"TGI HUNT Malicious Powershell String in HTTP"; flow:established; content:"JABzAD0AT"; fast_pattern; classtype:bad-unknown; sid:2610696; rev:1;)

alert http $HOME_NET any -> any any (msg:"TGI HUNT Malicious admin:admin B64 String in HTTP"; flow:established; content:"YWRtaW46YWRtaW4"; fast_pattern; classtype:bad-unknown; sid:2610700; rev:1;)

alert http $HOME_NET any -> any any (msg:"TGI HUNT Malicious ysoserial String in HTTP"; flow:established; content:"3RhY2tNYXBUYW"; fast_pattern; classtype:bad-unknown; sid:2610704; rev:1;)

alert http $HOME_NET any -> any any (msg:"TGI HUNT Malicious ysoserial String in HTTP"; flow:established; content:"M1MDQzMjg0NTY"; fast_pattern; classtype:bad-unknown; sid:2610708; rev:1;)

alert http $HOME_NET any -> any any (msg:"TGI HUNT Malicious ysoserial String in HTTP"; flow:established; content:"czsMADIAMwoAKwA0AQ"; fast_pattern; classtype:bad-unknown; sid:2610712; rev:1;)

alert http $HOME_NET any -> any any (msg:"TGI HUNT Malicious ysoserial String in HTTP"; flow:established; content:"AHhzcgARamF2YS51dGlsLkh"; fast_pattern; classtype:bad-unknown; sid:2610716; rev:1;)

alert http $HOME_NET any -> any any (msg:"TGI HUNT Malicious JexRemoteTools.jar String in HTTP"; flow:established; content:"JexReverse.class"; fast_pattern; classtype:bad-unknown; sid:2610720; rev:1;)

alert http $EXTERNAL_NET any -> $HOME_NET any (msg:"TGI HUNT (testing) Possible Cobalt Strike HTTP Response"; flow:established,to_client; content:"HTTP/1.1|20|404|20|Not Found|0d 0a|Date|3a 20|"; startswith; content:"|20|GMT|0d 0a|Content-Type|3a 20|text/plain|0d 0a|Content-Length|3a 20|0|0d 0a 0d 0a|"; distance:0; endswith; content:!"Server|3a 20|"; threshold:type limit, track by_src, seconds 60, count 1; classtype:trojan-activity; sid:2610724; rev:3;)

alert http $HOME_NET any -> any any (msg:"TGI HUNT Malicious Vulnscan String in HTTP"; flow:established; content:"cHJpbnQobWQ1KDMxMzM3KSk7"; fast_pattern; classtype:bad-unknown; sid:2610728; rev:1;)

alert http any any -> any any (msg:"TGI HUNT Suspicious HTTP Server Request (localhost)"; flow:to_server,established; http.host; content:"localhost"; bsize:9; http.request_body; content:!"TaniumSOAP"; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2610732; rev:1;)

alert http $HOME_NET any -> any any (msg:"TGI HUNT Malicious Host Artifact String in HTTP (base64 Microsoft Windows)"; flow:established; content:"TWljcm9zb2Z0IFdpbmRvd3Mg"; fast_pattern; classtype:bad-unknown; sid:2610736; rev:1;)

alert http $HOME_NET any -> any any (msg:"TGI HUNT Suspicious String in HTTP (base64 admin:admin)"; flow:established; content:"YWRtaW46YWRtaW4="; fast_pattern; classtype:bad-unknown; sid:2610740; rev:1;)

alert tls $EXTERNAL_NET any -> $HOME_NET any (msg:"TGI HUNT SSL/TLS Certificate Observed (cobaltstrike tls.serial)"; flow:established,to_client; tls.cert_serial; content:"08:bb:00:ee"; endswith; classtype:bad-unknown; sid:2610744; rev:1;)

alert tls $EXTERNAL_NET any -> $HOME_NET any (msg:"TGI HUNT SSL/TLS Certificate Observed (cobaltstrike tls.subject)"; flow:established,to_client; tls.cert_subject; content:"cobaltstrike"; nocase; classtype:bad-unknown; sid:2610748; rev:1;)

alert tls $EXTERNAL_NET any -> $HOME_NET any (msg:"TGI HUNT SSL/TLS Certificate Observed (cobaltstrike tls.issuer)"; flow:established,to_client; tls.cert_issuer; content:"cobaltstrike"; nocase; classtype:bad-unknown; sid:2610752; rev:1;)

alert http $EXTERNAL_NET any -> $HOME_NET any (msg:"TGI HUNT Serialized Java Object Inbound"; flow:established,to_server; http.request_body; content:"|ac ed 00 05|"; classtype:bad-unknown; sid:2610756; rev:1;)

alert http any any -> any any (msg:"TGI HUNT Suspicious String in HTTP (Shadowcopy UTF16-LE)"; flow:established; content:"FMAaABhAGQAbwB3AGMAbwBwAHkA"; fast_pattern; classtype:bad-unknown; sid:2610760; rev:1;)

alert http any any -> any any (msg:"TGI HUNT Suspicious String in HTTP (Get-WmiObject UTF16-LE)"; flow:established; content:"RwBlAHQALQBXAG0AaQBPAGIAagBlAGMAdAA"; fast_pattern; classtype:bad-unknown; sid:2610764; rev:1;)

alert http any any -> any any (msg:"TGI HUNT b64 exe in HTTP (UTF8)"; flow:established; content:"TVqQAAMAAAAEAAAA//8AAL"; fast_pattern; classtype:bad-unknown; sid:2610768; rev:1;)

alert http any any -> any any (msg:"TGI HUNT b64 exe in HTTP (UTF16-LE)"; flow:established; content:"T|00|V|00|q|00|Q|00|A|00|A|00|M|00|A|00|A|00|A|00|A|00|E|00|A|00|A|00|A|00|A|00|/|00|/|00|8|00|A|00|A|00|L"; fast_pattern; classtype:bad-unknown; sid:2610772; rev:1;)

alert tcp any any -> any any (msg:"TGI HUNT b64 exe in TCP (UTF8)"; flow:established; content:"TVqQAAMAAAAEAAAA//8AAL"; fast_pattern; classtype:bad-unknown; sid:2610776; rev:1;)

alert tcp any any -> any any (msg:"TGI HUNT b64 exe in TCP (UTF16-LE)"; flow:established; content:"T|00|V|00|q|00|Q|00|A|00|A|00|M|00|A|00|A|00|A|00|A|00|E|00|A|00|A|00|A|00|A|00|/|00|/|00|8|00|A|00|A|00|L"; fast_pattern; classtype:bad-unknown; sid:2610780; rev:1;)

alert tcp any any -> any any (msg:"TGI HUNT T3 Java Serialized Object Header Observed"; flow:established; content:"|74 33 20 31 32 2e 32 2e 31 0a 41 53 3a 32 35 35|"; fast_pattern; classtype:bad-unknown; sid:2610784; rev:1;)

alert tcp $EXTERNAL_NET any -> any any (msg:"TGI HUNT Java Serialized Object Magic Bytes Observed Inbound"; flow:established; content:"|ac ed 00|"; content:"|6a 61 76 61 2e 6c 61 6e 67 2e|"; fast_pattern; classtype:bad-unknown; sid:2610788; rev:1;)

alert tcp any any -> any any (msg:"TGI HUNT Java Serialized Object Common Shell Strings Observed"; flow:established; content:"|ac ed 00|"; content:"org.apache.commons.collections"; fast_pattern; classtype:bad-unknown; sid:2610792; rev:1;)

alert tcp any any -> any any (msg:"TGI HUNT DHT BitTorrent Test sig"; flow:established; content:"|4b 37 59 c9 86 0f 12 50 00 00 00 01|"; depth:12; fast_pattern; classtype:bad-unknown; sid:2610796; rev:1;)

alert tcp any any -> any any (msg:"TGI HUNT log4j with Base64"; flow:established; content:"jndi|3a|"; fast_pattern; content:"Base64"; nocase; classtype:bad-unknown; sid:2610800; rev:1;)

alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"TGI HUNT Curl to Bare IP Address"; flow:established,to_server; http.user_agent; content:"curl/"; startswith; nocase; fast_pattern; http.host; pcre:"/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/"; classtype:bad-unknown; sid:2610804; rev:1;)

alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"TGI HUNT Wget User-Agent to Bare IP Address"; flow:established,to_server; http.user_agent; content:"Wget/"; startswith; nocase; fast_pattern; http.host; pcre:"/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/"; classtype:bad-unknown; sid:2610808; rev:1;)

alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"TGI HUNT Python User-Agent to Bare IP Address"; flow:established,to_server; http.user_agent; content:"Python"; nocase; fast_pattern; http.host; pcre:"/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/"; classtype:bad-unknown; sid:2610810; rev:1;)

alert dns any any -> any any (msg:"TGI HUNT dnscat in DNS Query"; flow:established; dns_query; content:"dnscat"; threshold:type limit, track by_src, seconds 60, count 1; reference:url,github.com/iagox86/dnscat2; classtype:bad-unknown; sid:2610812; rev:1;)

alert tcp any any -> any any (msg:"TGI HUNT PE File b64 and compressed"; flow:established,to_client; content:"7b0HYBxJliUmL23Ke39K9UrX"; threshold:type limit, track by_src, seconds 60, count 1; reference:url,github.com/lukebaggett/dnscat2-powershell/blob/master/dnscat2.ps1; classtype:bad-unknown; sid:2610814; rev:1;)

#alert http $EXTERNAL_NET any -> $HOME_NET any (msg:"TGI HUNT Possible Vulntest Inbound"; flow:established,to_server; http.uri; content:"touch"; pcre:"/(?:\x60|\x24|\x3b)/Ui"; classtype:bad-unknown; sid:2610816; rev:1;)

alert http $EXTERNAL_NET any -> $HOME_NET any (msg:"TGI HUNT Possible Vulntest Inbound"; flow:established,to_server; http.user_agent; content:"GIS - AppSec Team"; classtype:bad-unknown; sid:2610818; rev:1;)

alert http $EXTERNAL_NET any -> $HOME_NET any (msg:"TGI HUNT Excel XLL PE Artifact Inbound (MODDNA)"; flow:established,to_client; content:"MODDNA"; classtype:bad-unknown; sid:2610820; rev:1;)

alert http $EXTERNAL_NET any -> $HOME_NET any (msg:"TGI HUNT Excel XLL PE Artifact Inbound (xlAutoOpen)"; flow:established,to_client; content:"xlAutoOpen"; classtype:bad-unknown; sid:2610822; rev:1;)

alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"TGI HUNT HTTP POST to Frequently Fronted Domain (fastly)"; flow:established,to_server; content:"POST"; http_method; content:".fastly.net"; http_host; fast_pattern; classtype:trojan-activity; sid:2610824; rev:1;)

alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"TGI HUNT WAF MITM of HTTPS"; flow:established,to_server; http.header; content:"X-forwarded-proto"; nocase; pcre:"/^[^\r\n]*https/Ri"; classtype:misc-activity; sid:2610826; rev:1;)

alert http $HOME_NET any -> any any (msg:"TGI HUNT Possible Log4shell Obfuscation Technique"; flow:established; http.uri; content:"${"; fast_pattern; pcre:"/j[ndi]*\${(?:(?:low|upp)er|(?:k8|sy)s|date|main|env|web|:):/i"; reference:url,twitter.com/ymzkei5/status/1469765165348704256; classtype:bad-unknown; sid:2610828; rev:1;)

alert http $EXTERNAL_NET any -> $HOME_NET any (msg:"TGI HUNT Powershell Defender Exclusion Inbound (Set-MpPreference)"; flow:established,to_client; content:"Set-MpPreference"; nocase; classtype:bad-unknown; sid:2610830; rev:1;)

alert http $EXTERNAL_NET any -> $HOME_NET any (msg:"TGI HUNT Powershell Defender Exclusion Inbound (Add-MpPreference)"; flow:established,to_client; content:"Add-MpPreference"; nocase; classtype:bad-unknown; sid:2610832; rev:1;)

alert http $EXTERNAL_NET any -> $HOME_NET any (msg:"TGI HUNT Suspicious String Inbound as B64 (bitcoin)"; flow:established,to_client; content:"Yml0Y29pb"; classtype:bad-unknown; sid:2610834; rev:1;)

alert http $EXTERNAL_NET any -> $HOME_NET any (msg:"TGI HUNT Suspicious String Inbound as B64 (bitcoin)"; flow:established,to_client; content:"JpdGNvaW"; classtype:bad-unknown; sid:2610836; rev:1;)

alert http $EXTERNAL_NET any -> $HOME_NET any (msg:"TGI HUNT Suspicious String Inbound as B64 (bitcoin)"; flow:established,to_client; content:"JpdGNvaW"; classtype:bad-unknown; sid:2610838; rev:1;)

# alert ip [64.39.96.0/20] any -> $HOME_NET any (msg:"TGI HUNT Qualys PCI Compliance Scanning Address Inbound"; flow:established,to_server; classtype:bad-unknown; sid:2610840; rev:1;)

alert tcp any any -> any any (msg:"TGI HUNT Bare LDAP Query for Domain Computers (BlackByte syntax)"; flow:established; content:"(&(objectClass=computer))"; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2610842; rev:1;)

alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"TGI HUNT Mythic Example C2 Profile Artifacts"; flow:established,to_server; http.uri; content:"/data"; endswith; http.user_agent; content:"Mozilla/5.0 (Windows NT 6.3|3b| Trident/7.0|3b| rv:11.0) like Gecko"; classtype:bad-unknown; sid:2610844; rev:1;)

alert http $EXTERNAL_NET any -> $HOME_NET any (msg:"TGI HUNT Suspicious String Inbound as B64 (admin:)"; flow:established; content:"YWRtaW46"; classtype:bad-unknown; sid:2610845; rev:1;)

alert http $EXTERNAL_NET any -> $HOME_NET any (msg:"TGI HUNT Suspicious Strings Inbound (pty implant)"; flow:established; content:"import pty"; content:"pty.spawn"; distance:0; classtype:bad-unknown; sid:2610846; rev:1;)

alert http $EXTERNAL_NET any -> $HOME_NET any (msg:"TGI HUNT Suspicious Strings Inbound (RealCMD webshell)"; flow:established; content:"runCmd"; content:"RealCMD"; content:"buildJson"; content:"Encrypt"; classtype:bad-unknown; sid:2610847; rev:1;)

alert http any any -> any any (msg:"TGI HUNT Suspicious String in HTTP POST Body (interact .sh)"; flow:established,to_server; http.request_body; content:".interact.sh"; pcre:"/\.interact\.sh\b/i"; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; reference:url,unit42.paloaltonetworks.com/exploits-interactsh/; sid:2610848; rev:1;)

alert http any any -> any any (msg:"TGI HUNT Suspicious String in HTTP POST Body (uname)"; flow:established,to_server; http.request_body; content:"uname"; pcre:"/\buname\b/"; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; reference:url,unit42.paloaltonetworks.com/exploits-interactsh/; sid:2610849; rev:1;)

alert http any any -> any any (msg:"TGI HUNT Suspicious String in HTTP POST Body (wget)"; flow:established,to_server; http.request_body; content:"wget"; pcre:"/\bwget\b/"; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; reference:url,unit42.paloaltonetworks.com/exploits-interactsh/; sid:2610850; rev:1;)

alert http any any -> any any (msg:"TGI HUNT Suspicious String in HTTP POST Body (curl)"; flow:established,to_server; http.request_body; content:"curl"; pcre:"/\bcurl\b/"; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; reference:url,unit42.paloaltonetworks.com/exploits-interactsh/; sid:2610851; rev:1;)

alert tcp any any -> any any (msg:"LOCAL DOS SYN packet flood inbound, Potential DOS"; flow:to_server; flags: S,12; threshold: type both, track by_dst, count 5000, seconds 5; classtype:misc-activity; sid:5;)
alert tcp any any -> any any (msg:"LOCAL DOS SYN packet flood outbound, Potential DOS"; flow:to_server; flags: S,12; threshold: type both, track by_dst, count 5000, seconds 5; classtype:misc-activity; sid:6;)


#alert http any any -> any any (msg:"ET TROJAN Possible MD5 in URI";flow: established, to_server; urilen: 33; http.uri; pcre:"/^\/([A-F0-9]{32})/i" ; classtype:trojan-activity; sid:1; rev:3;)
